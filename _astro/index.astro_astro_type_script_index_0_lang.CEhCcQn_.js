const Q=function*(s,t="f",e=0){const n=s.length-1;let l=t==="f"?-1:n+1;for(e!==null&&(t==="f"?l=e-1:l=e+1);;)t==="f"?l!==n?l++:(t="r",l--):l!==0?l--:(t="f",l++),yield{el:s[l],col:l}},U=function*(s,t,e){let n=1,l=1,o=t?t-1:-1,c=e?e-1:-1;const u=s.length-1,m=s[0]&&s[0].length-1||0;for(;;)(n+o>u||n+o<0)&&(n*=-1),(l+c>m||l+c<0)&&(l*=-1),o=o+n,c=c+l,yield{el:s?.[o]?.[c]||0,row:o,col:c}},T=function*(s,t="f",e=0){let n=e?e-1:-1;const l=t||"f",o=s.length-1;for(;;)l==="f"?(n===o&&(n=-1),n++):(n<=0&&(n=o+1),n--),yield{el:s[n],col:n}},$=(s,t,e)=>({row:t,col:e,val:s[t][e]}),j=s=>s.map((t,e)=>t.map((n,l)=>[e,l])).flat(),H=(s,t,e)=>j(s).filter(n=>t-n[0]===e-n[1]).map(n=>$(s,n[0],n[1])),W=(s,t,e)=>j(s).filter(n=>{if(t===n[0]&&e===n[1])return!0;const l=e-n[1],o=t-n[0];return l<0||o<0?Math.min(l,o)===Math.max(l,o)*-1:!1}).map(n=>$(s,n[0],n[1])),S=(s,t,e)=>{const n=t==="w"?e.x:e.y,l=t==="w"?e.width:e.height,o=t==="w"?e.cellWidth:e.cellHeight,c=t==="w"?e.colCount:e.rowCount;return s===0?0+n:s*((l-o)/(c-1))+n},Z=(s,t,e)=>s>=0&&s<e.colCount&&t>=0&&t<e.rowCount,a=(s,t,e)=>{if(!Z(s,t,e))return null;const n=S(s,"w",e),l=S(t,"h",e);return{x:n,y:l,t:l,l:n,b:l+e.cellHeight,r:n+e.cellWidth,w:e.cellWidth,h:e.cellHeight,cx:n+e.cellWidth/2,cy:l+e.cellHeight/2,ci:s,ri:t,...tt(s,t,e)}},tt=(s,t,e)=>({_u:n=>{const l=a(s,t-1,e);return l||(n==="cycle"?v({ci:s,ri:t},"u",e):a(s,t,e))},_lu:n=>{const l=a(s-1,t-1,e);return l||(n==="cycle"?v({ci:s,ri:t},"lu",e):a(s,t,e))},_ru:n=>{const l=a(s+1,t-1,e);return l||(n==="cycle"?v({ci:s,ri:t},"ru",e):a(s,t,e))},_d:n=>{const l=a(s,t+1,e);return l||(n==="cycle"?v({ci:s,ri:t},"d",e):a(s,t,e))},_ld:n=>{const l=a(s-1,t+1,e);return l||(n==="cycle"?v({ci:s,ri:t},"ld",e):a(s,t,e))},_rd:n=>{const l=a(s+1,t+1,e);return l||(n==="cycle"?v({ci:s,ri:t},"rd",e):a(s,t,e))},_r:n=>{const l=a(s+1,t,e);return l||(n==="cycle"?v({ci:s,ri:t},"r",e):a(s,t,e))},_l:n=>{const l=a(s-1,t,e);return l||(n==="cycle"?v({ci:s,ri:t},"l",e):a(s,t,e))}}),v=function(s,t,e){let n=[],l="",o=0;const{ci:c,ri:u}=s,m=t==="u"||t==="d",w=t==="l"||t==="r",y=!m&&!w;return m&&(n=E(c,e),o=u,t==="u"&&(l="r"),t==="d"&&(l="f")),w&&(n=R(u,e),o=c,t==="l"&&(l="r"),t==="r"&&(o=c+1,l="f")),y&&(t==="lu"||t==="rd"?n=H(G(e),u,c).map(i=>i.val):n=W(G(e),u,c).map(i=>i.val).reverse(),o=n.findIndex(i=>i?.ci===c)+1,l=t.startsWith("r")?"f":"r"),T(n,l,o).next().value.el},E=(s,t)=>Array.from({length:t.rowCount}).map((e,n)=>a(s,n,t)),R=(s,t)=>Array.from({length:t.colCount}).map((e,n)=>a(n,s,t)),k=s=>Array.from({length:s.colCount}).map((t,e)=>E(e,s)),G=s=>Array.from({length:s.rowCount}).map((t,e)=>R(e,s)),et=s=>k(s).flatMap(t=>t),nt=s=>({ci1:t,ri1:e,ci2:n,ri2:l})=>{const o=a(t,e,s),c=a(n,l,s);if(o&&c)return q(s)(o,c)},q=s=>(t,e)=>{const n=t.ci<=e.ci?t:e,l=t.ci<=e.ci?e:t,o=t.ri<=e.ri?t:e,c=t.ri<=e.ri?e:t,u=c.ci!==o.ci?l.r-n.l:s.cellWidth,m=c.ri!==o.ri?c.b-o.t:s.cellHeight,w=Array.from({length:l.ci-n.ci+1}),y=Array.from({length:c.ri-o.ri+1}),i=w.map((g,N)=>y.map((B,D)=>a(n.ci+N,o.ri+D,s)));return{x:n.x,y:o.y,w:u,h:m,t:o.t,l:n.l,r:l.r,b:c.b,cx:(n.l+u)/2,cy:(o.t+m)/2,cells:i}},st=s=>t=>{const e=R(t,s);if(e[0]){const n=e[0].y,l=e[0].x,o=e[0].h,c=e[0].cy;return{cells:e,x:l,y:n,w:s.width,h:o,cx:s.width/2+s.x,cy:c,t:n,l,r:s.width+s.x,b:n+o,ri:t}}else throw new Error("no cell at position 0")},lt=s=>t=>{const e=E(t,s);if(e[0]){const n=e[0].x,l=e[0].y,o=e[0].w,c=s.height,u=e[0].cx;return{cells:e,x:n,y:l,w:o,h:c,t:0+s.y,l:n,r:n+o,b:s.height+s.y,cx:u,cy:s.height/2+s.y,ci:t}}else throw new Error("no cell at position 0")};class ot{constructor({width:t=0,height:e=0,rows:n=0,cols:l=0,cellWidth:o=null,cellHeight:c=null,x:u=0,y:m=0}){this.settings={width:Number(t),height:Number(e),rowCount:Number(n),colCount:Number(l),cellWidth:o||t/l,cellHeight:c||e/n,x:Number(u),y:Number(m)},this.col=lt(this.settings),this.row=st(this.settings),this.diagonal=(w,y)=>H(this.rows,y,w).map(i=>i.val),this.antidiagonal=(w,y)=>W(this.rows,y,w).map(i=>i.val).reverse(),this.area=nt(this.settings),this.areaByCell=q(this.settings)}get cells(){return k(this.settings)}get cols(){return k(this.settings)}get rows(){return G(this.settings)}get flatCells(){return et(this.settings)}cell(t,e){return a(t,e,this.settings)}rowCells(t){return R(t,this.settings)}colCells(t){return E(t,this.settings)}scanCells(t=this.flatCells,e="f",n=null){return Q(t,e,n)}cycleCells(t=this.flatCells,e="f",n=null){return T(t,e,n)}scanRow(t,e="f",n=null){const l=this.rowCells(t);return this.scanCells(l,e,n)}scanDiagonal(t,e,n="f",l=null){const o=H(this.rows,e,t).map(c=>c.val);return this.scanCells(o,n,l)}scanAntidiagonal(t,e,n="f",l=null){const o=W(this.rows,e,t).map(c=>c.val);return n==="r"&&o.reverse(),this.scanCells(o,n,l)}scanCol(t,e="f",n=null){const l=this.colCells(t);return this.scanCells(l,e,n)}cycleRow(t,e="f",n=null){return this.cycleCells(this.rowCells(t),e,n)}cycleCol(t,e="f",n=null){return this.cycleCells(this.colCells(t),e,n)}cycleDiagonal(t,e,n="f",l=null){return this.cycleCells(H(this.rows,e,t).map(o=>o.val),n,l)}cycleAntidiagonal(t,e,n="f",l=null){return this.cycleCells(W(this.rows,e,t).map(o=>o.val).reverse(),n,l)}bounce(t=this.cells,e,n,l,o){return U(t,e,n)}get width(){return this.settings.width}get x(){return this.settings.x}get height(){return this.settings.height}get y(){return this.settings.y}get rowCount(){return this.settings.rowCount}get colCount(){return this.settings.colCount}get cellWidth(){return this.settings.cellWidth}get cellHeight(){return this.settings.cellHeight}}const _=document.querySelector.bind(document),z=document.createElement.bind(document),C=z("canvas"),f=C.getContext("2d");C.id="c";let O=0,F=0,A=!1;const ct=s=>{const t=z("video");return t.id="player",t.muted=!0,t.setAttribute("loop","true"),t.style.display="none",t.innerHTML+=`<source src="${s}" type="video/mp4" />`,t},rt=()=>{const s=ct("/assets/exp/video/ddd.mp4"),t=_("#container");t&&(t.appendChild(s),t.appendChild(C),C.addEventListener("mousemove",e=>{const n=C.getBoundingClientRect();O=e.clientX-n.left,F=e.clientY-n.top,A=!0}),C.addEventListener("mouseleave",()=>{A=!1}),s.addEventListener("loadedmetadata",function(){setInterval(at,10)},!1),s.play())},at=()=>{const s=_("#player");if(!(s instanceof HTMLVideoElement)||!(C instanceof HTMLCanvasElement))return;var t=s.videoWidth,e=s.videoHeight,n=5,l=Math.floor(t/n),o=Math.floor(e/n);const c=_("#buffer-h").valueAsNumber||0,u=_("#buffer-v").valueAsNumber||0;C.width=800,C.height=480;const m=new ot({width:t,height:e,rows:n,cols:n,cellSize:l}),w=l*n+c*(n-1)+c/2,y=(C.width-w)/2,i=o*n+u*(n-1)+u/2,g=(C.height-i)/2,N=m.flatCells.map(r=>({...r,x:r.x+y,y:r.y+g})),B=l*n+c*(n-1),D=o*n+u*(n-1);let x=-1,d=-1,V=!1;if(A){const r=O-y,p=F-g;r>=0&&r<=B&&p>=0&&p<=D&&(c===0&&u===0?V=!0:(x=Math.floor(r/(l+c)),d=Math.floor(p/(o+u)),x=Math.min(Math.max(x,0),n-1),d=Math.min(Math.max(d,0),n-1)))}const b=[];if(N.forEach((r,p)=>{if(f){const M=r.x-y,X=r.y-g,h=r.x+c*r.ci,P=r.y+u*r.ri,L=r.w,Y=r.h;f.filter="grayscale(100%)",(()=>{if(!A)return!1;if(V)return!0;if(d===-1||x===-1)return!1;const I=r.ri===d&&r.ci===x,J=c===0&&r.ri===d,K=u===0&&r.ci===x;return I||J||K})()&&(f.filter="none",b.push({x:h,y:P,w:L,h:Y})),f.drawImage(s,M,X,L,Y,h,P,L,Y),f.filter="none"}}),f&&b.length>0){const r=Math.min(...b.map(h=>h.x)),p=Math.min(...b.map(h=>h.y)),M=Math.max(...b.map(h=>h.x+h.w)),X=Math.max(...b.map(h=>h.y+h.h));f.beginPath(),f.rect(r-3,p-3,M-r+6,X-p+6),f.strokeStyle="#e81",f.lineWidth=3,f.stroke(),f.closePath()}};rt();
