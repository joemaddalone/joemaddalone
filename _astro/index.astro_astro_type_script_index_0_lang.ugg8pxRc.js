const $=function*(s,t="f",e=0){const n=s.length-1;let l=t==="f"?-1:n+1;for(e!==null&&(t==="f"?l=e-1:l=e+1);;)t==="f"?l!==n?l++:(t="r",l--):l!==0?l--:(t="f",l++),yield{el:s[l],col:l}},j=function*(s,t,e){let n=1,l=1,o=t?t-1:-1,c=e?e-1:-1;const u=s.length-1,h=s[0]&&s[0].length-1||0;for(;;)(n+o>u||n+o<0)&&(n*=-1),(l+c>h||l+c<0)&&(l*=-1),o=o+n,c=c+l,yield{el:s?.[o]?.[c]||0,row:o,col:c}},R=function*(s,t="f",e=0){let n=e?e-1:-1;const l=t||"f",o=s.length-1;for(;;)l==="f"?(n===o&&(n=-1),n++):(n<=0&&(n=o+1),n--),yield{el:s[n],col:n}},L=(s,t,e)=>({row:t,col:e,val:s[t][e]}),k=s=>s.map((t,e)=>t.map((n,l)=>[e,l])).flat(),w=(s,t,e)=>k(s).filter(n=>t-n[0]===e-n[1]).map(n=>L(s,n[0],n[1])),p=(s,t,e)=>k(s).filter(n=>{if(t===n[0]&&e===n[1])return!0;const l=e-n[1],o=t-n[0];return l<0||o<0?Math.min(l,o)===Math.max(l,o)*-1:!1}).map(n=>L(s,n[0],n[1])),E=(s,t,e)=>{const n=t==="w"?e.x:e.y,l=t==="w"?e.width:e.height,o=t==="w"?e.cellWidth:e.cellHeight,c=t==="w"?e.colCount:e.rowCount;return s===0?0+n:s*((l-o)/(c-1))+n},V=(s,t,e)=>s>=0&&s<e.colCount&&t>=0&&t<e.rowCount,r=(s,t,e)=>{if(!V(s,t,e))return null;const n=E(s,"w",e),l=E(t,"h",e);return{x:n,y:l,t:l,l:n,b:l+e.cellHeight,r:n+e.cellWidth,w:e.cellWidth,h:e.cellHeight,cx:n+e.cellWidth/2,cy:l+e.cellHeight/2,ci:s,ri:t,...X(s,t,e)}},X=(s,t,e)=>({_u:n=>{const l=r(s,t-1,e);return l||(n==="cycle"?C({ci:s,ri:t},"u",e):r(s,t,e))},_lu:n=>{const l=r(s-1,t-1,e);return l||(n==="cycle"?C({ci:s,ri:t},"lu",e):r(s,t,e))},_ru:n=>{const l=r(s+1,t-1,e);return l||(n==="cycle"?C({ci:s,ri:t},"ru",e):r(s,t,e))},_d:n=>{const l=r(s,t+1,e);return l||(n==="cycle"?C({ci:s,ri:t},"d",e):r(s,t,e))},_ld:n=>{const l=r(s-1,t+1,e);return l||(n==="cycle"?C({ci:s,ri:t},"ld",e):r(s,t,e))},_rd:n=>{const l=r(s+1,t+1,e);return l||(n==="cycle"?C({ci:s,ri:t},"rd",e):r(s,t,e))},_r:n=>{const l=r(s+1,t,e);return l||(n==="cycle"?C({ci:s,ri:t},"r",e):r(s,t,e))},_l:n=>{const l=r(s-1,t,e);return l||(n==="cycle"?C({ci:s,ri:t},"l",e):r(s,t,e))}}),C=function(s,t,e){let n=[],l="",o=0;const{ci:c,ri:u}=s,h=t==="u"||t==="d",a=t==="l"||t==="r",y=!h&&!a;return h&&(n=v(c,e),o=u,t==="u"&&(l="r"),t==="d"&&(l="f")),a&&(n=x(u,e),o=c,t==="l"&&(l="r"),t==="r"&&(o=c+1,l="f")),y&&(t==="lu"||t==="rd"?n=w(W(e),u,c).map(i=>i.val):n=p(W(e),u,c).map(i=>i.val).reverse(),o=n.findIndex(i=>i?.ci===c)+1,l=t.startsWith("r")?"f":"r"),R(n,l,o).next().value.el},v=(s,t)=>Array.from({length:t.rowCount}).map((e,n)=>r(s,n,t)),x=(s,t)=>Array.from({length:t.colCount}).map((e,n)=>r(n,s,t)),A=s=>Array.from({length:s.colCount}).map((t,e)=>v(e,s)),W=s=>Array.from({length:s.rowCount}).map((t,e)=>x(e,s)),q=s=>A(s).flatMap(t=>t),z=s=>({ci1:t,ri1:e,ci2:n,ri2:l})=>{const o=r(t,e,s),c=r(n,l,s);if(o&&c)return B(s)(o,c)},B=s=>(t,e)=>{const n=t.ci<=e.ci?t:e,l=t.ci<=e.ci?e:t,o=t.ri<=e.ri?t:e,c=t.ri<=e.ri?e:t,u=c.ci!==o.ci?l.r-n.l:s.cellWidth,h=c.ri!==o.ri?c.b-o.t:s.cellHeight,a=Array.from({length:l.ci-n.ci+1}),y=Array.from({length:c.ri-o.ri+1}),i=a.map((b,g)=>y.map((H,M)=>r(n.ci+g,o.ri+M,s)));return{x:n.x,y:o.y,w:u,h,t:o.t,l:n.l,r:l.r,b:c.b,cx:(n.l+u)/2,cy:(o.t+h)/2,cells:i}},P=s=>t=>{const e=x(t,s);if(e[0]){const n=e[0].y,l=e[0].x,o=e[0].h,c=e[0].cy;return{cells:e,x:l,y:n,w:s.width,h:o,cx:s.width/2+s.x,cy:c,t:n,l,r:s.width+s.x,b:n+o,ri:t}}else throw new Error("no cell at position 0")},Y=s=>t=>{const e=v(t,s);if(e[0]){const n=e[0].x,l=e[0].y,o=e[0].w,c=s.height,u=e[0].cx;return{cells:e,x:n,y:l,w:o,h:c,t:0+s.y,l:n,r:n+o,b:s.height+s.y,cx:u,cy:s.height/2+s.y,ci:t}}else throw new Error("no cell at position 0")};class F{constructor({width:t=0,height:e=0,rows:n=0,cols:l=0,cellWidth:o=null,cellHeight:c=null,x:u=0,y:h=0}){this.settings={width:Number(t),height:Number(e),rowCount:Number(n),colCount:Number(l),cellWidth:o||t/l,cellHeight:c||e/n,x:Number(u),y:Number(h)},this.col=Y(this.settings),this.row=P(this.settings),this.diagonal=(a,y)=>w(this.rows,y,a).map(i=>i.val),this.antidiagonal=(a,y)=>p(this.rows,y,a).map(i=>i.val).reverse(),this.area=z(this.settings),this.areaByCell=B(this.settings)}get cells(){return A(this.settings)}get cols(){return A(this.settings)}get rows(){return W(this.settings)}get flatCells(){return q(this.settings)}cell(t,e){return r(t,e,this.settings)}rowCells(t){return x(t,this.settings)}colCells(t){return v(t,this.settings)}scanCells(t=this.flatCells,e="f",n=null){return $(t,e,n)}cycleCells(t=this.flatCells,e="f",n=null){return R(t,e,n)}scanRow(t,e="f",n=null){const l=this.rowCells(t);return this.scanCells(l,e,n)}scanDiagonal(t,e,n="f",l=null){const o=w(this.rows,e,t).map(c=>c.val);return this.scanCells(o,n,l)}scanAntidiagonal(t,e,n="f",l=null){const o=p(this.rows,e,t).map(c=>c.val);return n==="r"&&o.reverse(),this.scanCells(o,n,l)}scanCol(t,e="f",n=null){const l=this.colCells(t);return this.scanCells(l,e,n)}cycleRow(t,e="f",n=null){return this.cycleCells(this.rowCells(t),e,n)}cycleCol(t,e="f",n=null){return this.cycleCells(this.colCells(t),e,n)}cycleDiagonal(t,e,n="f",l=null){return this.cycleCells(w(this.rows,e,t).map(o=>o.val),n,l)}cycleAntidiagonal(t,e,n="f",l=null){return this.cycleCells(p(this.rows,e,t).map(o=>o.val).reverse(),n,l)}bounce(t=this.cells,e,n,l,o){return j(t,e,n)}get width(){return this.settings.width}get x(){return this.settings.x}get height(){return this.settings.height}get y(){return this.settings.y}get rowCount(){return this.settings.rowCount}get colCount(){return this.settings.colCount}get cellWidth(){return this.settings.cellWidth}get cellHeight(){return this.settings.cellHeight}}const m=document.querySelector.bind(document),G=document.createElement.bind(document),I=s=>{const t=G("video");return t.id="player",t.muted=!0,t.setAttribute("loop","true"),t.style.display="none",t.innerHTML+=`<source src="${s}" type="video/mp4" />`,t},J=()=>{const s=I("/assets/exp/video/ccc.mp4"),t=m("#container");if(!t)return;t.appendChild(s);const e=G("canvas");e.id="c",t.appendChild(e),s.addEventListener("loadedmetadata",function(){setInterval(K,10)},!1),s.play()},K=()=>{const s=m("#player"),t=m("#c");if(!(s instanceof HTMLVideoElement)||!(t instanceof HTMLCanvasElement))return;var e=s.videoWidth,n=s.videoHeight,l=5,o=Math.floor(e/l),c=Math.floor(n/l);const u=m("#buffer-h").valueAsNumber||0,h=m("#buffer-v").valueAsNumber||0,a=t.getContext("2d");t.width=800,t.height=480;const y=new F({width:e,height:n,rows:l,cols:l,cellSize:o}),i=o*l+u*(l-1)+u/2,b=(t.width-i)/2,g=c*l+h*(l-1)+h/2,H=(t.height-g)/2;y.flatCells.map(f=>({...f,x:f.x+b,y:f.y+H})).forEach((f,O)=>{if(a){const S=f.x-b,T=f.y-H,N=f.x+u*f.ci,D=f.y+h*f.ri,_=f.w,d=f.h;a.fillStyle="rgba(0, 0, 0, 0.25)",a.fillRect(N+3,D+3,_,d),a.drawImage(s,S,T,_,d,N,D,_,d)}})};J();
