const et=function*(l,t="f",e=0){const n=l.length-1;let s=t==="f"?-1:n+1;for(e!==null&&(t==="f"?s=e-1:s=e+1);;)t==="f"?s!==n?s++:(t="r",s--):s!==0?s--:(t="f",s++),yield{el:l[s],col:s}},nt=function*(l,t,e){let n=1,s=1,o=t?t-1:-1,c=e?e-1:-1;const u=l.length-1,y=l[0]&&l[0].length-1||0;for(;;)(n+o>u||n+o<0)&&(n*=-1),(s+c>y||s+c<0)&&(s*=-1),o=o+n,c=c+s,yield{el:l?.[o]?.[c]||0,row:o,col:c}},j=function*(l,t="f",e=0){let n=e?e-1:-1;const s=t||"f",o=l.length-1;for(;;)s==="f"?(n===o&&(n=-1),n++):(n<=0&&(n=o+1),n--),yield{el:l[n],col:n}},J=(l,t,e)=>({row:t,col:e,val:l[t][e]}),K=l=>l.map((t,e)=>t.map((n,s)=>[e,s])).flat(),B=(l,t,e)=>K(l).filter(n=>t-n[0]===e-n[1]).map(n=>J(l,n[0],n[1])),L=(l,t,e)=>K(l).filter(n=>{if(t===n[0]&&e===n[1])return!0;const s=e-n[1],o=t-n[0];return s<0||o<0?Math.min(s,o)===Math.max(s,o)*-1:!1}).map(n=>J(l,n[0],n[1])),O=(l,t,e)=>{const n=t==="w"?e.x:e.y,s=t==="w"?e.width:e.height,o=t==="w"?e.cellWidth:e.cellHeight,c=t==="w"?e.colCount:e.rowCount;return l===0?0+n:l*((s-o)/(c-1))+n},lt=(l,t,e)=>l>=0&&l<e.colCount&&t>=0&&t<e.rowCount,i=(l,t,e)=>{if(!lt(l,t,e))return null;const n=O(l,"w",e),s=O(t,"h",e);return{x:n,y:s,t:s,l:n,b:s+e.cellHeight,r:n+e.cellWidth,w:e.cellWidth,h:e.cellHeight,cx:n+e.cellWidth/2,cy:s+e.cellHeight/2,ci:l,ri:t,...st(l,t,e)}},st=(l,t,e)=>({_u:n=>{const s=i(l,t-1,e);return s||(n==="cycle"?x({ci:l,ri:t},"u",e):i(l,t,e))},_lu:n=>{const s=i(l-1,t-1,e);return s||(n==="cycle"?x({ci:l,ri:t},"lu",e):i(l,t,e))},_ru:n=>{const s=i(l+1,t-1,e);return s||(n==="cycle"?x({ci:l,ri:t},"ru",e):i(l,t,e))},_d:n=>{const s=i(l,t+1,e);return s||(n==="cycle"?x({ci:l,ri:t},"d",e):i(l,t,e))},_ld:n=>{const s=i(l-1,t+1,e);return s||(n==="cycle"?x({ci:l,ri:t},"ld",e):i(l,t,e))},_rd:n=>{const s=i(l+1,t+1,e);return s||(n==="cycle"?x({ci:l,ri:t},"rd",e):i(l,t,e))},_r:n=>{const s=i(l+1,t,e);return s||(n==="cycle"?x({ci:l,ri:t},"r",e):i(l,t,e))},_l:n=>{const s=i(l-1,t,e);return s||(n==="cycle"?x({ci:l,ri:t},"l",e):i(l,t,e))}}),x=function(l,t,e){let n=[],s="",o=0;const{ci:c,ri:u}=l,y=t==="u"||t==="d",w=t==="l"||t==="r",C=!y&&!w;return y&&(n=P(c,e),o=u,t==="u"&&(s="r"),t==="d"&&(s="f")),w&&(n=S(u,e),o=c,t==="l"&&(s="r"),t==="r"&&(o=c+1,s="f")),C&&(t==="lu"||t==="rd"?n=B(z(e),u,c).map(a=>a.val):n=L(z(e),u,c).map(a=>a.val).reverse(),o=n.findIndex(a=>a?.ci===c)+1,s=t.startsWith("r")?"f":"r"),j(n,s,o).next().value.el},P=(l,t)=>Array.from({length:t.rowCount}).map((e,n)=>i(l,n,t)),S=(l,t)=>Array.from({length:t.colCount}).map((e,n)=>i(n,l,t)),$=l=>Array.from({length:l.colCount}).map((t,e)=>P(e,l)),z=l=>Array.from({length:l.rowCount}).map((t,e)=>S(e,l)),ot=l=>$(l).flatMap(t=>t),ct=l=>({ci1:t,ri1:e,ci2:n,ri2:s})=>{const o=i(t,e,l),c=i(n,s,l);if(o&&c)return Q(l)(o,c)},Q=l=>(t,e)=>{const n=t.ci<=e.ci?t:e,s=t.ci<=e.ci?e:t,o=t.ri<=e.ri?t:e,c=t.ri<=e.ri?e:t,u=c.ci!==o.ci?s.r-n.l:l.cellWidth,y=c.ri!==o.ri?c.b-o.t:l.cellHeight,w=Array.from({length:s.ci-n.ci+1}),C=Array.from({length:c.ri-o.ri+1}),a=w.map((_,A)=>C.map((h,r)=>i(n.ci+A,o.ri+r,l)));return{x:n.x,y:o.y,w:u,h:y,t:o.t,l:n.l,r:s.r,b:c.b,cx:(n.l+u)/2,cy:(o.t+y)/2,cells:a}},rt=l=>t=>{const e=S(t,l);if(e[0]){const n=e[0].y,s=e[0].x,o=e[0].h,c=e[0].cy;return{cells:e,x:s,y:n,w:l.width,h:o,cx:l.width/2+l.x,cy:c,t:n,l:s,r:l.width+l.x,b:n+o,ri:t}}else throw new Error("no cell at position 0")},it=l=>t=>{const e=P(t,l);if(e[0]){const n=e[0].x,s=e[0].y,o=e[0].w,c=l.height,u=e[0].cx;return{cells:e,x:n,y:s,w:o,h:c,t:0+l.y,l:n,r:n+o,b:l.height+l.y,cx:u,cy:l.height/2+l.y,ci:t}}else throw new Error("no cell at position 0")};class ut{constructor({width:t=0,height:e=0,rows:n=0,cols:s=0,cellWidth:o=null,cellHeight:c=null,x:u=0,y=0}){this.settings={width:Number(t),height:Number(e),rowCount:Number(n),colCount:Number(s),cellWidth:o||t/s,cellHeight:c||e/n,x:Number(u),y:Number(y)},this.col=it(this.settings),this.row=rt(this.settings),this.diagonal=(w,C)=>B(this.rows,C,w).map(a=>a.val),this.antidiagonal=(w,C)=>L(this.rows,C,w).map(a=>a.val).reverse(),this.area=ct(this.settings),this.areaByCell=Q(this.settings)}get cells(){return $(this.settings)}get cols(){return $(this.settings)}get rows(){return z(this.settings)}get flatCells(){return ot(this.settings)}cell(t,e){return i(t,e,this.settings)}rowCells(t){return S(t,this.settings)}colCells(t){return P(t,this.settings)}scanCells(t=this.flatCells,e="f",n=null){return et(t,e,n)}cycleCells(t=this.flatCells,e="f",n=null){return j(t,e,n)}scanRow(t,e="f",n=null){const s=this.rowCells(t);return this.scanCells(s,e,n)}scanDiagonal(t,e,n="f",s=null){const o=B(this.rows,e,t).map(c=>c.val);return this.scanCells(o,n,s)}scanAntidiagonal(t,e,n="f",s=null){const o=L(this.rows,e,t).map(c=>c.val);return n==="r"&&o.reverse(),this.scanCells(o,n,s)}scanCol(t,e="f",n=null){const s=this.colCells(t);return this.scanCells(s,e,n)}cycleRow(t,e="f",n=null){return this.cycleCells(this.rowCells(t),e,n)}cycleCol(t,e="f",n=null){return this.cycleCells(this.colCells(t),e,n)}cycleDiagonal(t,e,n="f",s=null){return this.cycleCells(B(this.rows,e,t).map(o=>o.val),n,s)}cycleAntidiagonal(t,e,n="f",s=null){return this.cycleCells(L(this.rows,e,t).map(o=>o.val).reverse(),n,s)}bounce(t=this.cells,e,n,s,o){return nt(t,e,n)}get width(){return this.settings.width}get x(){return this.settings.x}get height(){return this.settings.height}get y(){return this.settings.y}get rowCount(){return this.settings.rowCount}get colCount(){return this.settings.colCount}get cellWidth(){return this.settings.cellWidth}get cellHeight(){return this.settings.cellHeight}}const at=document.querySelector.bind(document),U=document.createElement.bind(document),d=U("canvas");d.id="c";const f=d.getContext("2d");let Z=0,tt=0,G=!1,p=0,v=0;const m=5;let R=0,Y=0,H=[],I=null;const X=document.getElementById("buffer-h"),q=document.getElementById("buffer-v");X&&(p=X.valueAsNumber||0,X.addEventListener("input",()=>{p=X.valueAsNumber||0}));q&&(v=q.valueAsNumber||0,q.addEventListener("input",()=>{v=q.valueAsNumber||0}));const ht=l=>{const t=U("video");return t.id="player",t.muted=!0,t.setAttribute("loop","true"),t.setAttribute("playsinline","true"),t.setAttribute("autoplay","true"),t.style.display="none",t.innerHTML=`<source src="${l}" type="video/mp4" />`,t},ft=()=>{const l=ht("/assets/exp/video/ddd.mp4"),t=at("#container");!t||!f||(t.appendChild(l),t.appendChild(d),I=l,d.addEventListener("mousemove",e=>{const n=d.getBoundingClientRect();Z=e.clientX-n.left,tt=e.clientY-n.top,G=!0}),d.addEventListener("mouseleave",()=>{G=!1}),l.addEventListener("loadedmetadata",()=>{d.width=800,d.height=480;const e=l.videoWidth,n=l.videoHeight;if(R=Math.floor(e/m),Y=Math.floor(n/m),H=new ut({width:e,height:n,rows:m,cols:m,cellSize:R}).flatCells,typeof l.requestVideoFrameCallback=="function"){const c=()=>{T(),l.requestVideoFrameCallback(c)};l.requestVideoFrameCallback(c)}else{const c=()=>{T(),requestAnimationFrame(c)};requestAnimationFrame(c)}},{once:!0}),l.play())},T=()=>{if(!f||!I)return;const l=R*m+p*(m-1)+p/2,t=(d.width-l)/2,e=Y*m+v*(m-1)+v/2,n=(d.height-e)/2,s=R*m+p*(m-1),o=Y*m+v*(m-1);let c=-1,u=-1,y=!1;if(G){const h=Z-t,r=tt-n;h>=0&&h<=s&&r>=0&&r<=o&&(p===0&&v===0?y=!0:(c=Math.min(Math.max(Math.floor(h/(R+p)),0),m-1),u=Math.min(Math.max(Math.floor(r/(Y+v)),0),m-1)))}if(f.clearRect(0,0,d.width,d.height),!y){f.filter="grayscale(1)";for(let h=0;h<H.length;h++){const r=H[h],W=r.x,M=r.y,E=r.x+t+p*r.ci,k=r.y+n+v*r.ri,b=r.w,g=r.h;f.drawImage(I,W,M,b,g,E,k,b,g)}}let w=!1,C=1/0,a=1/0,_=-1/0,A=-1/0;if(y){f.filter="none";for(let h=0;h<H.length;h++){const r=H[h],W=r.x,M=r.y,E=r.x+t+p*r.ci,k=r.y+n+v*r.ri,b=r.w,g=r.h;f.drawImage(I,W,M,b,g,E,k,b,g)}w=!0,C=t,a=n,_=t+s,A=n+o}else if(G&&u!==-1&&c!==-1){f.filter="none";for(let h=0;h<H.length;h++){const r=H[h],W=r.ri===u&&r.ci===c,M=p===0&&r.ri===u,E=v===0&&r.ci===c;if(!(W||M||E))continue;const b=r.x,g=r.y,N=r.x+t+p*r.ci,V=r.y+n+v*r.ri,F=r.w,D=r.h;f.drawImage(I,b,g,F,D,N,V,F,D),w=!0,N<C&&(C=N),V<a&&(a=V),N+F>_&&(_=N+F),V+D>A&&(A=V+D)}}w&&(f.beginPath(),f.rect(C-3,a-3,_-C+6,A-a+6),f.strokeStyle="#e81",f.lineWidth=3,f.stroke(),f.closePath()),f.filter="none"};ft();
