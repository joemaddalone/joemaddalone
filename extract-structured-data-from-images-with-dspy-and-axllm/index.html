<!DOCTYPE html><html lang="en"> <head><meta charset="utf-8"><link rel="icon" type="image/x-icon" href="/assets/favicon.ico"><meta name="viewport" content="width=device-width"><meta name="generator" content="Astro v5.12.5"><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="apple-touch-icon" sizes="57x57" href="/assets/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png"><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link href="//unpkg.com/prismjs@1.20.0/themes/prism.css" rel="stylesheet"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.1/src/regular/style.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.1/src/fill/style.css"><title></title><link rel="stylesheet" href="/_astro/_slug_.C5iPGgXW.css"><style>lite-youtube>iframe{all:unset!important;width:100%!important;height:100%!important;position:absolute!important;inset:0!important;border:0!important}
</style><style>lite-youtube{background-color:#000;position:relative;display:block;contain:content;background-position:center center;background-size:cover;cursor:pointer;max-width:720px}lite-youtube:before{content:attr(data-title);display:block;position:absolute;top:0;background-image:linear-gradient(180deg,#000000ab,#0000008a 14%,#00000026 54%,#0000000d 72%,#0000 94%);height:99px;width:100%;font-family:YouTube Noto,Roboto,Arial,Helvetica,sans-serif;color:#eee;text-shadow:0 0 2px rgba(0,0,0,.5);font-size:18px;padding:25px 20px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;box-sizing:border-box}lite-youtube:hover:before{color:#fff}lite-youtube:after{content:"";display:block;padding-bottom:56.25%}lite-youtube>iframe{width:100%;height:100%;position:absolute;top:0;left:0;border:0}lite-youtube>.lty-playbtn{display:block;width:100%;height:100%;background:no-repeat center/68px 48px;background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 68 48"><path d="M66.52 7.74c-.78-2.93-2.49-5.41-5.42-6.19C55.79.13 34 0 34 0S12.21.13 6.9 1.55c-2.93.78-4.63 3.26-5.42 6.19C.06 13.05 0 24 0 24s.06 10.95 1.48 16.26c.78 2.93 2.49 5.41 5.42 6.19C12.21 47.87 34 48 34 48s21.79-.13 27.1-1.55c2.93-.78 4.64-3.26 5.42-6.19C67.94 34.95 68 24 68 24s-.06-10.95-1.48-16.26z" fill="red"/><path d="M45 24 27 14v20" fill="white"/></svg>');position:absolute;cursor:pointer;z-index:1;filter:grayscale(100%);transition:filter .1s cubic-bezier(0,0,.2,1);border:0}lite-youtube:hover>.lty-playbtn,lite-youtube .lty-playbtn:focus{filter:none}lite-youtube.lyt-activated{cursor:unset}lite-youtube.lyt-activated:before,lite-youtube.lyt-activated>.lty-playbtn{opacity:0;pointer-events:none}.lyt-visually-hidden{clip:rect(0 0 0 0);clip-path:inset(50%);height:1px;overflow:hidden;position:absolute;white-space:nowrap;width:1px}
</style></head> <body> <div class="sticky top-0 z-50 bg-white/80 shadow-md"> <nav class="flex items-center justify-between text-black h-12"> <a class="mt1 ml-1" href="/"> <img src="/assets/favicon-32x32.png" width="32" height="32" alt=""> </a> </nav> </div>  <div class="content-container section-spacing"> <div class="prose
	prose-invert
  prose-h1:font-bold prose-h1:text-xl
	prose-body:text-black prose-body:text-base
	prose-headings:text-black
	prose-p:text-black
	prose-code:text-black
	prose-code:bg-inherit
	prose-code:font-thin
	prose-code:text-xs
	prose-code:italic
	prose-code:before:content-none
	prose-code:after:content-none
	prose-ul:list-disc prose-ul:pl-4
	prose-strong:text-black
	prose-ruby:text-black
	prose-li:text-black">   <meta charset="utf-8"/>
<hgroup><h1>Extract structured data from images with DSPy and ax-llm</h1><p>Letâ€™s get structured data from an image.</p></hgroup>
<div class="pt-6"><lite-youtube videoid="67faupn3G4g" style="background-image: url('https://i.ytimg.com/vi/67faupn3G4g/hqdefault.jpg');"> <a href="https://youtube.com/watch?v=67faupn3G4g" class="lty-playbtn"> <span class="lyt-visually-hidden">Play</span> </a> </lite-youtube> <script type="module">class i extends HTMLElement{connectedCallback(){this.videoId=this.getAttribute("videoid");let e=this.querySelector(".lty-playbtn");if(this.playLabel=e&&e.textContent.trim()||this.getAttribute("playlabel")||"Play",this.dataset.title=this.getAttribute("title")||"",this.style.backgroundImage||(this.style.backgroundImage=`url("https://i.ytimg.com/vi/${this.videoId}/hqdefault.jpg")`,this.upgradePosterImage()),e||(e=document.createElement("button"),e.type="button",e.classList.add("lty-playbtn"),this.append(e)),!e.textContent){const t=document.createElement("span");t.className="lyt-visually-hidden",t.textContent=this.playLabel,e.append(t)}this.addNoscriptIframe(),e.nodeName==="A"&&(e.removeAttribute("href"),e.setAttribute("tabindex","0"),e.setAttribute("role","button"),e.addEventListener("keydown",t=>{(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),this.activate())})),this.addEventListener("pointerover",i.warmConnections,{once:!0}),this.addEventListener("focusin",i.warmConnections,{once:!0}),this.addEventListener("click",this.activate),this.needsYTApi=this.hasAttribute("js-api")||navigator.vendor.includes("Apple")||navigator.userAgent.includes("Mobi")}static addPrefetch(e,t,a){const r=document.createElement("link");r.rel=e,r.href=t,a&&(r.as=a),document.head.append(r)}static warmConnections(){i.preconnected||(i.addPrefetch("preconnect","https://www.youtube-nocookie.com"),i.addPrefetch("preconnect","https://www.google.com"),i.addPrefetch("preconnect","https://googleads.g.doubleclick.net"),i.addPrefetch("preconnect","https://static.doubleclick.net"),i.preconnected=!0)}fetchYTPlayerApi(){window.YT||window.YT&&window.YT.Player||(this.ytApiPromise=new Promise((e,t)=>{var a=document.createElement("script");a.src="https://www.youtube.com/iframe_api",a.async=!0,a.onload=r=>{YT.ready(e)},a.onerror=t,this.append(a)}))}async getYTPlayer(){return this.playerPromise||await this.activate(),this.playerPromise}async addYTPlayerIframe(){this.fetchYTPlayerApi(),await this.ytApiPromise;const e=document.createElement("div");this.append(e);const t=Object.fromEntries(this.getParams().entries());this.playerPromise=new Promise(a=>{let r=new YT.Player(e,{width:"100%",videoId:this.videoId,playerVars:t,events:{onReady:n=>{n.target.playVideo(),a(r)}}})})}addNoscriptIframe(){const e=this.createBasicIframe(),t=document.createElement("noscript");t.innerHTML=e.outerHTML,this.append(t)}getParams(){const e=new URLSearchParams(this.getAttribute("params")||[]);return e.append("autoplay","1"),e.append("playsinline","1"),e}async activate(){if(this.classList.contains("lyt-activated"))return;if(this.classList.add("lyt-activated"),this.needsYTApi)return this.addYTPlayerIframe(this.getParams());const e=this.createBasicIframe();this.append(e),e.focus()}createBasicIframe(){const e=document.createElement("iframe");return e.width=560,e.height=315,e.title=this.playLabel,e.allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture",e.allowFullscreen=!0,e.src=`https://www.youtube-nocookie.com/embed/${encodeURIComponent(this.videoId)}?${this.getParams().toString()}`,e}upgradePosterImage(){setTimeout(()=>{const e=`https://i.ytimg.com/vi_webp/${this.videoId}/sddefault.webp`,t=new Image;t.fetchPriority="low",t.referrerpolicy="origin",t.src=e,t.onload=a=>{a.target.naturalHeight==90&&a.target.naturalWidth==120||(this.style.backgroundImage=`url("${e}")`)}},100)}}customElements.define("lite-youtube",i);</script> </div>
<h2 id="image">Image</h2>
<p>Here is an example of an image I want to extract structured data from.</p>
<p><img src="/_astro/IMG_5060.BCvVdy57_Z1S9j1R.webp" alt="Sonny Boy" loading="lazy" decoding="async" fetchpriority="auto" width="3024" height="4032"></p>
<h2 id="first-attempt">First Attempt</h2>
<div class="expressive-code"><link rel="stylesheet" href="/_astro/ec.4dupk.css"/><script type="module" src="/_astro/ec.p1z7b.js"></script><figure class="frame has-title"><figcaption class="header"><span class="title">image.ts</span></figcaption><pre data-language="ts"><code><div class="ec-line"><div class="code"><span style="--0:#A2447B">import</span><span style="--0:#565869"> </span><span style="--0:#646670">{</span><span style="--0:#565869"> ai</span><span style="--0:#646670">,</span><span style="--0:#565869"> ax </span><span style="--0:#646670">}</span><span style="--0:#565869"> </span><span style="--0:#A2447B">from</span><span style="--0:#565869"> </span><span style="--0:#646670">&quot;</span><span style="--0:#816100">@ax-llm/ax</span><span style="--0:#646670">&quot;</span><span style="--0:#646670">;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#A2447B">import</span><span style="--0:#565869"> </span><span style="--0:#A2447B">*</span><span style="--0:#565869"> </span><span style="--0:#A2447B">as</span><span style="--0:#565869"> fs </span><span style="--0:#A2447B">from</span><span style="--0:#565869"> </span><span style="--0:#646670">&quot;</span><span style="--0:#816100">fs</span><span style="--0:#646670">&quot;</span><span style="--0:#646670">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#A2447B">const</span><span style="--0:#565869"> llm </span><span style="--0:#646670">=</span><span style="--0:#565869"> </span><span style="--0:#066C9F">ai</span><span style="--0:#646670">({</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#11658F">name</span><span style="--0:#646670">:</span><span style="--0:#565869"> </span><span style="--0:#646670">&quot;</span><span style="--0:#816100">ollama</span><span style="--0:#646670">&quot;</span><span style="--0:#646670">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#11658F">apiKey</span><span style="--0:#646670">:</span><span style="--0:#565869"> </span><span style="--0:#646670">&quot;</span><span style="--0:#816100">ollama</span><span style="--0:#646670">&quot;</span><span style="--0:#646670">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#11658F">url</span><span style="--0:#646670">:</span><span style="--0:#565869"> </span><span style="--0:#646670">&quot;</span><span style="--0:#816100">http://localhost:11434/v1</span><span style="--0:#646670">&quot;</span><span style="--0:#646670">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#11658F">config</span><span style="--0:#646670">:</span><span style="--0:#565869"> </span><span style="--0:#646670">{</span><span style="--0:#565869"> </span><span style="--0:#11658F">model</span><span style="--0:#646670">:</span><span style="--0:#565869"> </span><span style="--0:#646670">&quot;</span><span style="--0:#816100">llava:latest</span><span style="--0:#646670">&quot;</span><span style="--0:#565869"> </span><span style="--0:#646670">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#646670">  </span></span><span style="--0:#646670">// or any other model that supports &quot;vision&quot;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#646670">});</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#A2447B">const</span><span style="--0:#565869"> analyzer </span><span style="--0:#646670">=</span><span style="--0:#565869"> </span><span style="--0:#066C9F">ax</span><span style="--0:#646670">(</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#646670">`</span><span style="--0:#816100">book:image -&gt; description:string &quot;what is in the image&quot;</span><span style="--0:#646670">`</span></div></div><div class="ec-line"><div class="code"><span style="--0:#646670">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#A2447B">const</span><span style="--0:#565869"> imageData </span><span style="--0:#646670">=</span><span style="--0:#565869"> fs</span><span style="--0:#646670">.</span><span style="--0:#066C9F">readFileSync</span><span style="--0:#646670">(</span><span style="--0:#646670">&quot;</span><span style="--0:#816100">./IMG_5060.jpg</span><span style="--0:#646670">&quot;</span><span style="--0:#646670">).</span><span style="--0:#066C9F">toString</span><span style="--0:#646670">(</span><span style="--0:#646670">&quot;</span><span style="--0:#816100">base64</span><span style="--0:#646670">&quot;</span><span style="--0:#646670">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#A2447B">const</span><span style="--0:#565869"> result </span><span style="--0:#646670">=</span><span style="--0:#565869"> </span><span style="--0:#A2447B">await</span><span style="--0:#565869"> analyzer</span><span style="--0:#646670">.</span><span style="--0:#066C9F">forward</span><span style="--0:#646670">(</span><span style="--0:#565869">llm </span><span style="--0:#646670">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#11658F">book</span><span style="--0:#646670">:</span><span style="--0:#565869"> </span><span style="--0:#646670">{</span><span style="--0:#565869"> </span><span style="--0:#11658F">mimeType</span><span style="--0:#646670">:</span><span style="--0:#565869"> </span><span style="--0:#646670">&#39;</span><span style="--0:#816100">image/jpeg</span><span style="--0:#646670">&#39;</span><span style="--0:#646670">,</span><span style="--0:#565869"> </span><span style="--0:#11658F">data</span><span style="--0:#646670">:</span><span style="--0:#565869"> imageData </span><span style="--0:#646670">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#646670">});</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#565869">console</span><span style="--0:#646670">.</span><span style="--0:#066C9F">log</span><span style="--0:#646670">(</span><span style="--0:#565869">result</span><span style="--0:#646670">);</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="import { ai, ax } from &#34;@ax-llm/ax&#34;;import * as fs from &#34;fs&#34;;const llm = ai({  name: &#34;ollama&#34;,  apiKey: &#34;ollama&#34;,  url: &#34;http://localhost:11434/v1&#34;,  config: { model: &#34;llava:latest&#34; }  // or any other model that supports &#34;vision&#34;});const analyzer = ax(  `book:image -> description:string &#34;what is in the image&#34;`);const imageData = fs.readFileSync(&#34;./IMG_5060.jpg&#34;).toString(&#34;base64&#34;);const result = await analyzer.forward(llm {  book: { mimeType: 'image/jpeg', data: imageData }});console.log(result);"><div></div></button></div></figure></div>
<p>And here is the result</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="json"><code><div class="ec-line"><div class="code"><span style="--0:#646670">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#B1403C">description</span><span style="--0:#646670">:</span><span style="--0:#565869"> </span><span style="--0:#646670">&quot;</span><span style="--0:#816100">The image shows a book on a shelf among other books.</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#816100">  </span></span><span style="--0:#816100">The book is titled </span><span style="--0:#806100">\&quot;</span><span style="--0:#816100">SONNY BOY</span><span style="--0:#806100">\&quot;</span><span style="--0:#816100"> by Al Pacino. It appears to be a</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#816100">  </span></span><span style="--0:#816100">paperback edition of the book, which is likely a biography or memoir</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#816100">  </span></span><span style="--0:#816100">given the author&#39;s name and the title that suggests it might be</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#816100">  </span></span><span style="--0:#816100">about his life or experiences. The cover of the book features an</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#816100">  </span></span><span style="--0:#816100">image of Al Pacino, who is known for his role as Sonny Boy in the</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#816100">  </span></span><span style="--0:#816100">film </span><span style="--0:#806100">\&quot;</span><span style="--0:#816100">The Godfather.</span><span style="--0:#806100">\&quot;</span><span style="--0:#816100"> The shelf also contains other books with</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#816100">  </span></span><span style="--0:#816100">various titles and authors, indicating a collection of reading</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#816100">  </span></span><span style="--0:#816100">materials.</span><span style="--0:#646670">&quot;</span><span style="--0:#646670">,</span></div></div><div class="ec-line"><div class="code"><span style="--0:#646670">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="{  description: &#34;The image shows a book on a shelf among other books.  The book is titled \&#34;SONNY BOY\&#34; by Al Pacino. It appears to be a  paperback edition of the book, which is likely a biography or memoir  given the author's name and the title that suggests it might be  about his life or experiences. The cover of the book features an  image of Al Pacino, who is known for his role as Sonny Boy in the  film \&#34;The Godfather.\&#34; The shelf also contains other books with  various titles and authors, indicating a collection of reading  materials.&#34;,}"><div></div></button></div></figure></div>
<p>This is close to what I want despite some egregious hallucinations (Al Pacino did not play Sonny Boy in The Godfather!), but what I really want is the title and author in a structured format.</p>
<h2 id="dspy-to-the-rescue">DSPy to the rescue</h2>
<div class="expressive-code"><figure class="frame has-title"><figcaption class="header"><span class="title">image.ts</span></figcaption><pre data-language="ts"><code><div class="ec-line"><div class="code"><span style="--0:#A2447B">import</span><span style="--0:#565869"> </span><span style="--0:#646670">{</span><span style="--0:#565869"> ai</span><span style="--0:#646670">,</span><span style="--0:#565869"> ax </span><span style="--0:#646670">}</span><span style="--0:#565869"> </span><span style="--0:#A2447B">from</span><span style="--0:#565869"> </span><span style="--0:#646670">&quot;</span><span style="--0:#816100">@ax-llm/ax</span><span style="--0:#646670">&quot;</span><span style="--0:#646670">;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#A2447B">import</span><span style="--0:#565869"> </span><span style="--0:#A2447B">*</span><span style="--0:#565869"> </span><span style="--0:#A2447B">as</span><span style="--0:#565869"> fs </span><span style="--0:#A2447B">from</span><span style="--0:#565869"> </span><span style="--0:#646670">&quot;</span><span style="--0:#816100">fs</span><span style="--0:#646670">&quot;</span><span style="--0:#646670">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#A2447B">const</span><span style="--0:#565869"> llm </span><span style="--0:#646670">=</span><span style="--0:#565869"> </span><span style="--0:#066C9F">ai</span><span style="--0:#646670">({</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#11658F">name</span><span style="--0:#646670">:</span><span style="--0:#565869"> </span><span style="--0:#646670">&quot;</span><span style="--0:#816100">ollama</span><span style="--0:#646670">&quot;</span><span style="--0:#646670">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#11658F">apiKey</span><span style="--0:#646670">:</span><span style="--0:#565869"> </span><span style="--0:#646670">&quot;</span><span style="--0:#816100">ollama</span><span style="--0:#646670">&quot;</span><span style="--0:#646670">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#11658F">url</span><span style="--0:#646670">:</span><span style="--0:#565869"> </span><span style="--0:#646670">&quot;</span><span style="--0:#816100">http://localhost:11434/v1</span><span style="--0:#646670">&quot;</span><span style="--0:#646670">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#11658F">config</span><span style="--0:#646670">:</span><span style="--0:#565869"> </span><span style="--0:#646670">{</span><span style="--0:#565869"> </span><span style="--0:#11658F">model</span><span style="--0:#646670">:</span><span style="--0:#565869"> </span><span style="--0:#646670">&quot;</span><span style="--0:#816100">llava:latest</span><span style="--0:#646670">&quot;</span><span style="--0:#565869"> </span><span style="--0:#646670">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#646670">  </span></span><span style="--0:#646670">// or any other model that supports &quot;vision&quot;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#646670">});</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line highlight del"><div class="code"><span style="--0:#813662">const</span><span style="--0:#4e505f"> analyzer </span><span style="--0:#4e5058">=</span><span style="--0:#4e505f"> </span><span style="--0:#05567f">ax</span><span style="--0:#4e5058">(</span></div></div><div class="ec-line highlight del"><div class="code"><span class="indent">  </span><span style="--0:#4e5058">`</span><span style="--0:#674d00">book:image -&gt; description:string &quot;what is in the image&quot;</span><span style="--0:#4e5058">`</span></div></div><div class="ec-line highlight del"><div class="code"><span style="--0:#4e5058">);</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#813662">const</span><span style="--0:#4e505f"> analyzer </span><span style="--0:#505159">=</span><span style="--0:#4e505f"> </span><span style="--0:#05567f">ax</span><span style="--0:#505159">(</span><span style="--0:#505159">`</span><span style="--0:#674d00">book:image -&gt; title:string, author:string</span><span style="--0:#505159">`</span><span style="--0:#505159">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#A2447B">const</span><span style="--0:#565869"> imageData </span><span style="--0:#646670">=</span><span style="--0:#565869"> fs</span><span style="--0:#646670">.</span><span style="--0:#066C9F">readFileSync</span><span style="--0:#646670">(</span><span style="--0:#646670">&quot;</span><span style="--0:#816100">./IMG_5060.jpg</span><span style="--0:#646670">&quot;</span><span style="--0:#646670">).</span><span style="--0:#066C9F">toString</span><span style="--0:#646670">(</span><span style="--0:#646670">&quot;</span><span style="--0:#816100">base64</span><span style="--0:#646670">&quot;</span><span style="--0:#646670">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#A2447B">const</span><span style="--0:#565869"> result </span><span style="--0:#646670">=</span><span style="--0:#565869"> </span><span style="--0:#A2447B">await</span><span style="--0:#565869"> analyzer</span><span style="--0:#646670">.</span><span style="--0:#066C9F">forward</span><span style="--0:#646670">(</span><span style="--0:#565869">llm </span><span style="--0:#646670">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#11658F">book</span><span style="--0:#646670">:</span><span style="--0:#565869"> </span><span style="--0:#646670">{</span><span style="--0:#565869"> </span><span style="--0:#11658F">mimeType</span><span style="--0:#646670">:</span><span style="--0:#565869"> </span><span style="--0:#646670">&#39;</span><span style="--0:#816100">image/jpeg</span><span style="--0:#646670">&#39;</span><span style="--0:#646670">,</span><span style="--0:#565869"> </span><span style="--0:#11658F">data</span><span style="--0:#646670">:</span><span style="--0:#565869"> imageData </span><span style="--0:#646670">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#646670">});</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#565869">console</span><span style="--0:#646670">.</span><span style="--0:#066C9F">log</span><span style="--0:#646670">(</span><span style="--0:#565869">result</span><span style="--0:#646670">);</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="import { ai, ax } from &#34;@ax-llm/ax&#34;;import * as fs from &#34;fs&#34;;const llm = ai({  name: &#34;ollama&#34;,  apiKey: &#34;ollama&#34;,  url: &#34;http://localhost:11434/v1&#34;,  config: { model: &#34;llava:latest&#34; }  // or any other model that supports &#34;vision&#34;});const analyzer = ax(  `book:image -> description:string &#34;what is in the image&#34;`);const analyzer = ax(`book:image -> title:string, author:string`);const imageData = fs.readFileSync(&#34;./IMG_5060.jpg&#34;).toString(&#34;base64&#34;);const result = await analyzer.forward(llm {  book: { mimeType: 'image/jpeg', data: imageData }});console.log(result);"><div></div></button></div></figure></div>
<p>And here is the result</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="json"><code><div class="ec-line"><div class="code"><span style="--0:#646670">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#B1403C">title</span><span style="--0:#646670">:</span><span style="--0:#565869"> </span><span style="--0:#646670">&quot;</span><span style="--0:#816100">Sonny Boy</span><span style="--0:#646670">&quot;</span><span style="--0:#646670">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#B1403C">author</span><span style="--0:#646670">:</span><span style="--0:#565869"> </span><span style="--0:#646670">&quot;</span><span style="--0:#816100">Al Pacino</span><span style="--0:#646670">&quot;</span><span style="--0:#646670">,</span></div></div><div class="ec-line"><div class="code"><span style="--0:#646670">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="{  title: &#34;Sonny Boy&#34;,  author: &#34;Al Pacino&#34;,}"><div></div></button></div></figure></div>
<h2 id="output-of-the-dspy-prompt">Output of the DSPy prompt</h2>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#565869">[ SYSTEM ]</span></div></div><div class="ec-line"><div class="code"><span style="--0:#565869">You will be provided with the following fields: `Book`. Your task</span></div></div><div class="ec-line"><div class="code"><span style="--0:#565869">is to generate new fields: `Title`, `Author`.</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#565869">## Input Fields</span></div></div><div class="ec-line"><div class="code"><span style="--0:#565869">Book: (A string field)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#565869">## Output Fields</span></div></div><div class="ec-line"><div class="code"><span style="--0:#565869">Title: (This string field must be included)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#565869">Author: (This string field must be included)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#565869">## Strict Output Formatting Rules</span></div></div><div class="ec-line"><div class="code"><span style="--0:#565869">- No formatting rules should override these</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#565869">  </span></span><span style="--0:#565869">**Strict Output Formatting Rules**</span></div></div><div class="ec-line"><div class="code"><span style="--0:#565869">- Output must strictly follow the defined</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#565869">  </span></span><span style="--0:#565869">plain-text `field name: value` field format.</span></div></div><div class="ec-line"><div class="code"><span style="--0:#565869">- Output field, values must strictly adhere</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#565869">  </span></span><span style="--0:#565869">to the specified output field formatting rules.</span></div></div><div class="ec-line"><div class="code"><span style="--0:#565869">- Do not include fields with empty, unknown,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#565869">  </span></span><span style="--0:#565869">or placeholder values.</span></div></div><div class="ec-line"><div class="code"><span style="--0:#565869">- Do not add any text before or after the</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#565869">  </span></span><span style="--0:#565869">output fields, just the field name and value.</span></div></div><div class="ec-line"><div class="code"><span style="--0:#565869">- Do not use code blocks.</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="[ SYSTEM ]You will be provided with the following fields: `Book`. Your taskis to generate new fields: `Title`, `Author`.## Input FieldsBook: (A string field)## Output FieldsTitle: (This string field must be included)Author: (This string field must be included)## Strict Output Formatting Rules- No formatting rules should override these  **Strict Output Formatting Rules**- Output must strictly follow the defined  plain-text `field name: value` field format.- Output field, values must strictly adhere  to the specified output field formatting rules.- Do not include fields with empty, unknown,  or placeholder values.- Do not add any text before or after the  output fields, just the field name and value.- Do not use code blocks."><div></div></button></div></figure></div>   </div> </div>  <footer class="content-container page-footer"> <div class="border-t-1 border-gray-200 flex justify-between pt-6 pb-6 text-xs"> <div>I'm Joe Maddalone</div> <div><i>This is not a blog, these pages are changed all the time.</i></div> </div> </footer> </body></html>