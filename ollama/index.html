<!DOCTYPE html><html lang="en"> <head><meta charset="utf-8"><link rel="icon" type="image/x-icon" href="/assets/favicon.ico"><meta name="viewport" content="width=device-width"><meta name="generator" content="Astro v5.12.5"><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="apple-touch-icon" sizes="57x57" href="/assets/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png"><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link href="//unpkg.com/prismjs@1.20.0/themes/prism.css" rel="stylesheet"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.1/src/regular/style.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.1/src/fill/style.css"><title></title><link rel="stylesheet" href="/_astro/_slug_.CJBRJVhP.css"></head> <body> <div class="sticky top-0 z-50 bg-white/80 shadow-md"> <nav class="flex items-center justify-between text-black h-12"> <a class="mt1 ml-1" href="/"> <img src="/assets/favicon-32x32.png" width="32" height="32" alt=""> </a> <div class="flex items-stretch h-full nav-links "> <a class="px-4 border-l-2 border-l-gray-200 hover:bg-gray-100 duration-200 flex items-center h-full overflow-hidden" href="/writes">write</a> <a class="px-4 border-l-2 border-l-gray-200 hover:bg-gray-100 duration-200 flex items-center h-full overflow-hidden" href="/experiments">experiment</a> <a class="px-4 border-l-2 border-l-gray-200 hover:bg-gray-100 duration-200 flex items-center h-full overflow-hidden" href="/resume">work</a> </div> </nav> </div>  <div class="content-container section-spacing"> <div class="prose
	prose-invert
  prose-h1:font-bold prose-h1:text-xl
	prose-body:text-black prose-body:text-base
	prose-headings:text-black
	prose-p:text-black
	prose-code:text-black
	prose-code:bg-inherit
	prose-code:font-thin
	prose-code:text-xs
	prose-code:italic
	prose-code:before:content-none
	prose-code:after:content-none
	prose-ul:list-disc prose-ul:pl-4
	prose-strong:text-black
	prose-ruby:text-black
	prose-li:text-black">   <hgroup>
	<h1>ollama</h1>
	<p>ollama + langchain</p>
</hgroup>
<h2 id="what-is-ollama">What is Ollama?</h2>
<p><a href="https://ollama.ai/">Ollama</a> is a tool for downloading and running large language models.  It’s like bittorrent for open source LLMs.</p>
<h2 id="what-is-langchain">What is LangChain?</h2>
<p>First, an LLM chain is the chaining of multiple LLM calls. We do this in order to deal with the constraint of limited context challenges when interacting with large volumes of information.</p>
<ul>
<li><strong>System prompt</strong>: “You are an assistant for question-answering tasks.  Use the following code sample to answer the question.  if you don’t know the answer, just say that you don’t know. Keep your answers concise.”</li>
<li><strong>Context</strong>: “Here is the code I’d like to discuss: …code…”</li>
<li><strong>Question</strong>: “How can I further optimize this code?”</li>
</ul>
<p>LLM Chains abstract away the complexity of multiple calls.  <a href="https://www.langchain.com/">LangChain</a> is an LLM Chain library we can use to produce our LLM Chain in order to provide context which, hopefully, results in less hallucinations.  LangChain also allows us to pair our LLM chain with document retrieval methods.  Pulling in PDFs or database records as context for our LLM chain is, put mildly, awesome.</p>
<h2 id="install-ollama">Install ollama</h2>
<div class="expressive-code"><link rel="stylesheet" href="/_astro/ec.4dupk.css"><script type="module" src="/_astro/ec.p1z7b.js"></script><figure class="frame is-terminal"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash"><code><div class="ec-line"><div class="code"><span style="--0:#066C9F">curl</span><span style="--0:#565869"> </span><span style="--0:#816100">https://ollama.ai/install.sh</span><span style="--0:#565869"> </span><span style="--0:#646670">|</span><span style="--0:#565869"> </span><span style="--0:#066C9F">sh</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="curl https://ollama.ai/install.sh | sh"><div></div></button></div></figure></div>
<h2 id="pull-a-model-or-two-or-three">Pull a model (or two, or three)</h2>
<div class="expressive-code"><figure class="frame is-terminal"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash"><code><div class="ec-line"><div class="code"><span style="--0:#066C9F">ollama</span><span style="--0:#565869"> </span><span style="--0:#816100">pull</span><span style="--0:#565869"> </span><span style="--0:#816100">llama2</span></div></div><div class="ec-line"><div class="code"><span style="--0:#066C9F">ollama</span><span style="--0:#565869"> </span><span style="--0:#816100">pull</span><span style="--0:#565869"> </span><span style="--0:#816100">codellama</span></div></div><div class="ec-line"><div class="code"><span style="--0:#066C9F">ollama</span><span style="--0:#565869"> </span><span style="--0:#816100">pull</span><span style="--0:#565869"> </span><span style="--0:#816100">mistral</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="ollama pull llama2ollama pull codellamaollama pull mistral"><div></div></button></div></figure></div>
<h2 id="start-ollama">Start ollama</h2>
<p>If you get a <em>port already in use</em> error, this is common on Linux immediately after installation.  It’s already running.</p>
<div class="expressive-code"><figure class="frame is-terminal"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash"><code><div class="ec-line"><div class="code"><span style="--0:#066C9F">ollama</span><span style="--0:#565869"> </span><span style="--0:#816100">serve</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="ollama serve"><div></div></button></div></figure></div>
<p>ollama is now available at <a href="http://localhost:11434">http://localhost:11434</a></p>
<div class="expressive-code"><figure class="frame is-terminal"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash"><code><div class="ec-line"><div class="code"><span style="--0:#066C9F">curl</span><span style="--0:#565869"> </span><span style="--0:#816100">http://localhost:11434</span></div></div><div class="ec-line"><div class="code"><span style="--0:#066C9F">Ollama</span><span style="--0:#565869"> </span><span style="--0:#816100">is</span><span style="--0:#565869"> </span><span style="--0:#816100">running</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#066C9F">curl</span><span style="--0:#565869"> </span><span style="--0:#816100">http://localhost:11434/api/tags</span></div></div><div class="ec-line"><div class="code"><span style="--0:#646670">{</span><span style="--0:#066C9F">"models"</span><span style="--0:#066C9F">:</span><span style="--0:#816100">[</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#646670">{</span><span style="--0:#066C9F">"name"</span><span style="--0:#066C9F">:</span><span style="--0:#066C9F">"codellama:latest"</span><span style="--0:#066C9F">,...},</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#646670">{</span><span style="--0:#066C9F">"name"</span><span style="--0:#066C9F">:</span><span style="--0:#066C9F">"llama2:latest"</span><span style="--0:#066C9F">,...},</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#646670">{</span><span style="--0:#066C9F">"name"</span><span style="--0:#066C9F">:</span><span style="--0:#066C9F">"mistral:latest"</span><span style="--0:#066C9F">,...}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#565869">]}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="curl http://localhost:11434Ollama is runningcurl http://localhost:11434/api/tags{&#x22;models&#x22;:[  {&#x22;name&#x22;:&#x22;codellama:latest&#x22;,...},  {&#x22;name&#x22;:&#x22;llama2:latest&#x22;,...},  {&#x22;name&#x22;:&#x22;mistral:latest&#x22;,...}]}"><div></div></button></div></figure></div>
<p>I personally run this on a custom port with</p>
<div class="expressive-code"><figure class="frame is-terminal"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash"><code><div class="ec-line"><div class="code"><span style="--0:#565869">OLLAMA_HOST</span><span style="--0:#646670">=</span><span style="--0:#816100">0.0.0.0:9494</span><span style="--0:#565869"> </span><span style="--0:#066C9F">ollama</span><span style="--0:#565869"> </span><span style="--0:#816100">serve</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="OLLAMA_HOST=0.0.0.0:9494 ollama serve"><div></div></button></div></figure></div>
<h2 id="setup-project">Setup project</h2>
<div class="expressive-code"><figure class="frame is-terminal"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash"><code><div class="ec-line"><div class="code"><span style="--0:#066C9F">mkdir</span><span style="--0:#565869"> </span><span style="--0:#816100">ai-local</span></div></div><div class="ec-line"><div class="code"><span style="--0:#066C9F">cd</span><span style="--0:#565869"> </span><span style="--0:#816100">ai-local</span></div></div><div class="ec-line"><div class="code"><span style="--0:#066C9F">npm</span><span style="--0:#565869"> </span><span style="--0:#816100">init</span><span style="--0:#565869"> </span><span style="--0:#1E753B">-y</span></div></div><div class="ec-line"><div class="code"><span style="--0:#066C9F">npm</span><span style="--0:#565869"> </span><span style="--0:#816100">i</span><span style="--0:#565869"> </span><span style="--0:#816100">langchain</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#646670"># add "type": "module" to package.json</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="mkdir ai-localcd ai-localnpm init -ynpm i langchain"><div></div></button></div></figure></div>
<h2 id="our-first-app-impossible-question">Our first app, impossible question</h2>
<div class="expressive-code"><figure class="frame has-title"><figcaption class="header"><span class="title">index.js</span></figcaption><pre data-language="js"><code><div class="ec-line"><div class="code"><span style="--0:#646670">// run: node index.js</span></div></div><div class="ec-line"><div class="code"><span style="--0:#A2447B">import</span><span style="--0:#565869"> </span><span style="--0:#646670">{</span><span style="--0:#565869"> Ollama </span><span style="--0:#646670">}</span><span style="--0:#565869"> </span><span style="--0:#A2447B">from</span><span style="--0:#565869"> </span><span style="--0:#646670">"</span><span style="--0:#816100">langchain/llms/ollama</span><span style="--0:#646670">"</span><span style="--0:#646670">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#A2447B">const</span><span style="--0:#565869"> ollama </span><span style="--0:#646670">=</span><span style="--0:#565869"> </span><span style="--0:#A2447B">new</span><span style="--0:#565869"> </span><span style="--0:#066C9F">Ollama</span><span style="--0:#646670">({</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#11658F">baseUrl</span><span style="--0:#646670">:</span><span style="--0:#565869"> </span><span style="--0:#646670">"</span><span style="--0:#816100">http://localhost:11434</span><span style="--0:#646670">"</span><span style="--0:#646670">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#11658F">model</span><span style="--0:#646670">:</span><span style="--0:#565869"> </span><span style="--0:#646670">"</span><span style="--0:#816100">mistral</span><span style="--0:#646670">"</span><span style="--0:#565869"> </span><span style="--0:#646670">// using the mistral LLM.</span></div></div><div class="ec-line"><div class="code"><span style="--0:#646670">});</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#A2447B">const</span><span style="--0:#565869"> question </span><span style="--0:#646670">=</span><span style="--0:#565869"> </span><span style="--0:#646670">"</span><span style="--0:#816100">What color is the house at 6353 Juan Tabo Blvd?</span><span style="--0:#646670">"</span></div></div><div class="ec-line"><div class="code"><span style="--0:#A2447B">const</span><span style="--0:#565869"> res </span><span style="--0:#646670">=</span><span style="--0:#565869"> </span><span style="--0:#A2447B">await</span><span style="--0:#565869"> ollama</span><span style="--0:#646670">.</span><span style="--0:#066C9F">call</span><span style="--0:#646670">();</span></div></div><div class="ec-line"><div class="code"><span style="--0:#565869">console</span><span style="--0:#646670">.</span><span style="--0:#066C9F">log</span><span style="--0:#646670">(</span><span style="--0:#565869">res</span><span style="--0:#646670">)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#646670">// alternatively we could capture the response as a stream.</span></div></div><div class="ec-line"><div class="code"><span style="--0:#646670">// const stream = await ollama.stream(question);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#646670">// for await (const chunk of stream) {</span></div></div><div class="ec-line"><div class="code"><span style="--0:#646670">//   process.stdout.write(chunk);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#646670">// }</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="// run: node index.jsimport { Ollama } from &#x22;langchain/llms/ollama&#x22;;const ollama = new Ollama({  baseUrl: &#x22;http://localhost:11434&#x22;,  model: &#x22;mistral&#x22; // using the mistral LLM.});const question = &#x22;What color is the house at 6353 Juan Tabo Blvd?&#x22;const res = await ollama.call();console.log(res)// alternatively we could capture the response as a stream.// const stream = await ollama.stream(question);// for await (const chunk of stream) {//   process.stdout.write(chunk);// }"><div></div></button></div></figure></div>
<p>This should result in something along the lines of:</p>
<div class="message success">
The color of the house at 6353 Juan Tabo Blvd ... would depend
on the specific property and its owners. There are no records to
indicate the color of this particular house...
</div>
<p>Obviously the the LLM does not know the color of the house.  Had we asked some more general question we would definitely get an answer, but I have purposely asked it something it does not know.</p>
<p>So let’s give it some context.</p>
<h2 id="chain-and-document-and-stuff">chain and Document and Stuff</h2>
<p>We covered what a <code>chain</code> is previously.  To <code>Stuff</code> a chain is exactly what it sounds like.  Fill it with stuff.  In this case stuff it with <code>Documents</code></p>
<div class="expressive-code"><figure class="frame has-title"><figcaption class="header"><span class="title">index.js</span></figcaption><pre data-language="js"><code><div class="ec-line"><div class="code"><span style="--0:#646670">// run: node index.js</span></div></div><div class="ec-line"><div class="code"><span style="--0:#A2447B">import</span><span style="--0:#565869"> </span><span style="--0:#646670">{</span><span style="--0:#565869"> Ollama </span><span style="--0:#646670">}</span><span style="--0:#565869"> </span><span style="--0:#A2447B">from</span><span style="--0:#565869"> </span><span style="--0:#646670">"</span><span style="--0:#816100">langchain/llms/ollama</span><span style="--0:#646670">"</span><span style="--0:#646670">;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#A2447B">import</span><span style="--0:#565869"> </span><span style="--0:#646670">{</span><span style="--0:#565869"> loadQAStuffChain </span><span style="--0:#646670">}</span><span style="--0:#565869"> </span><span style="--0:#A2447B">from</span><span style="--0:#565869"> </span><span style="--0:#646670">"</span><span style="--0:#816100">langchain/chains</span><span style="--0:#646670">"</span><span style="--0:#646670">;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#A2447B">import</span><span style="--0:#565869"> </span><span style="--0:#646670">{</span><span style="--0:#565869"> Document </span><span style="--0:#646670">}</span><span style="--0:#565869"> </span><span style="--0:#A2447B">from</span><span style="--0:#565869"> </span><span style="--0:#646670">"</span><span style="--0:#816100">langchain/document</span><span style="--0:#646670">"</span><span style="--0:#646670">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#A2447B">const</span><span style="--0:#565869"> ollama </span><span style="--0:#646670">=</span><span style="--0:#565869"> </span><span style="--0:#A2447B">new</span><span style="--0:#565869"> </span><span style="--0:#066C9F">Ollama</span><span style="--0:#646670">(</span><span style="--0:#646670">/*... same as before */</span><span style="--0:#646670">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#A2447B">const</span><span style="--0:#565869"> question </span><span style="--0:#646670">=</span><span style="--0:#565869"> </span><span style="--0:#646670">"</span><span style="--0:#816100">What color is the house at 6353 Juan Tabo Blvd?</span><span style="--0:#646670">"</span></div></div><div class="ec-line"><div class="code"><span style="--0:#A2447B">const</span><span style="--0:#565869"> chain </span><span style="--0:#646670">=</span><span style="--0:#565869"> </span><span style="--0:#066C9F">loadQAStuffChain</span><span style="--0:#646670">(</span><span style="--0:#565869">ollama</span><span style="--0:#646670">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#A2447B">const</span><span style="--0:#565869"> input_documents </span><span style="--0:#646670">=</span><span style="--0:#565869"> </span><span style="--0:#646670">[</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#A2447B">new</span><span style="--0:#565869"> </span><span style="--0:#066C9F">Document</span><span style="--0:#646670">({</span><span style="--0:#565869"> </span><span style="--0:#11658F">pageContent</span><span style="--0:#646670">:</span><span style="--0:#565869"> </span><span style="--0:#646670">"</span><span style="--0:#816100">The color of the house at 6353 Juan Tabo Blvd is blue</span><span style="--0:#646670">"</span><span style="--0:#565869"> </span><span style="--0:#646670">})</span></div></div><div class="ec-line"><div class="code"><span style="--0:#646670">];</span></div></div><div class="ec-line"><div class="code"><span style="--0:#A2447B">const</span><span style="--0:#565869"> res </span><span style="--0:#646670">=</span><span style="--0:#565869"> </span><span style="--0:#A2447B">await</span><span style="--0:#565869"> chain</span><span style="--0:#646670">.</span><span style="--0:#066C9F">call</span><span style="--0:#646670">({</span><span style="--0:#565869"> input_documents</span><span style="--0:#646670">,</span><span style="--0:#565869"> question</span><span style="--0:#646670">});</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#565869">console</span><span style="--0:#646670">.</span><span style="--0:#066C9F">log</span><span style="--0:#646670">(</span><span style="--0:#565869">res</span><span style="--0:#646670">.</span><span style="--0:#565869">text</span><span style="--0:#646670">)</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="// run: node index.jsimport { Ollama } from &#x22;langchain/llms/ollama&#x22;;import { loadQAStuffChain } from &#x22;langchain/chains&#x22;;import { Document } from &#x22;langchain/document&#x22;;const ollama = new Ollama(/*... same as before */);const question = &#x22;What color is the house at 6353 Juan Tabo Blvd?&#x22;const chain = loadQAStuffChain(ollama);const input_documents = [  new Document({ pageContent: &#x22;The color of the house at 6353 Juan Tabo Blvd is blue&#x22; })];const res = await chain.call({ input_documents, question});console.log(res.text)"><div></div></button></div></figure></div>
<h3 id="result">result:</h3>
<div class="message success">
The color of the house at 6353 Juan Tabo is blue.
</div>
<p>Much better.  And kind of exciting when you observe what actually happened.  We taught the model about something new.  We could have told it anything.  This example was a bit “call and response”.  Let’s see if it can infer information from slightly less direct context.</p>
<div class="expressive-code"><figure class="frame has-title"><figcaption class="header"><span class="title">index.js</span></figcaption><pre data-language="js"><code><div class="ec-line"><div class="code"><span style="--0:#646670">// run: node index.js</span></div></div><div class="ec-line"><div class="code"><span style="--0:#A2447B">import</span><span style="--0:#565869"> </span><span style="--0:#646670">{</span><span style="--0:#565869"> Ollama </span><span style="--0:#646670">}</span><span style="--0:#565869"> </span><span style="--0:#A2447B">from</span><span style="--0:#565869"> </span><span style="--0:#646670">"</span><span style="--0:#816100">langchain/llms/ollama</span><span style="--0:#646670">"</span><span style="--0:#646670">;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#A2447B">import</span><span style="--0:#565869"> </span><span style="--0:#646670">{</span><span style="--0:#565869"> loadQAStuffChain </span><span style="--0:#646670">}</span><span style="--0:#565869"> </span><span style="--0:#A2447B">from</span><span style="--0:#565869"> </span><span style="--0:#646670">"</span><span style="--0:#816100">langchain/chains</span><span style="--0:#646670">"</span><span style="--0:#646670">;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#A2447B">import</span><span style="--0:#565869"> </span><span style="--0:#646670">{</span><span style="--0:#565869"> Document </span><span style="--0:#646670">}</span><span style="--0:#565869"> </span><span style="--0:#A2447B">from</span><span style="--0:#565869"> </span><span style="--0:#646670">"</span><span style="--0:#816100">langchain/document</span><span style="--0:#646670">"</span><span style="--0:#646670">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#A2447B">const</span><span style="--0:#565869"> ollama </span><span style="--0:#646670">=</span><span style="--0:#565869"> </span><span style="--0:#A2447B">new</span><span style="--0:#565869"> </span><span style="--0:#066C9F">Ollama</span><span style="--0:#646670">(</span><span style="--0:#646670">/*... same as before */</span><span style="--0:#646670">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#A2447B">const</span><span style="--0:#565869"> question </span><span style="--0:#646670">=</span><span style="--0:#565869"> </span><span style="--0:#646670">"</span><span style="--0:#816100">What color is the house at 6353 Juan Tabo Blvd?</span><span style="--0:#646670">"</span></div></div><div class="ec-line"><div class="code"><span style="--0:#A2447B">const</span><span style="--0:#565869"> chain </span><span style="--0:#646670">=</span><span style="--0:#565869"> </span><span style="--0:#066C9F">loadQAStuffChain</span><span style="--0:#646670">(</span><span style="--0:#565869">ollama</span><span style="--0:#646670">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#A2447B">const</span><span style="--0:#565869"> docs </span><span style="--0:#646670">=</span><span style="--0:#565869"> </span><span style="--0:#646670">[</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#A2447B">new</span><span style="--0:#565869"> </span><span style="--0:#066C9F">Document</span><span style="--0:#646670">({</span><span style="--0:#565869"> </span><span style="--0:#11658F">pageContent</span><span style="--0:#646670">:</span><span style="--0:#565869"> </span><span style="--0:#646670">"</span><span style="--0:#816100">Houses on Juan Tabo Blvd are either red or blue</span><span style="--0:#646670">"</span><span style="--0:#565869"> </span><span style="--0:#646670">}),</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#A2447B">new</span><span style="--0:#565869"> </span><span style="--0:#066C9F">Document</span><span style="--0:#646670">({</span><span style="--0:#565869"> </span><span style="--0:#11658F">pageContent</span><span style="--0:#646670">:</span><span style="--0:#565869"> </span><span style="--0:#646670">"</span><span style="--0:#816100">0 through 9999 are valid addresses on Juan Tabo Blvd</span><span style="--0:#646670">"</span><span style="--0:#565869"> </span><span style="--0:#646670">}),</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#A2447B">new</span><span style="--0:#565869"> </span><span style="--0:#066C9F">Document</span><span style="--0:#646670">({</span><span style="--0:#565869"> </span><span style="--0:#11658F">pageContent</span><span style="--0:#646670">:</span><span style="--0:#565869"> </span><span style="--0:#646670">"</span><span style="--0:#816100">Houses on Juan Tabo Blvd with odd numbered addresses are red</span><span style="--0:#646670">"</span><span style="--0:#565869"> </span><span style="--0:#646670">}),</span></div></div><div class="ec-line"><div class="code"><span style="--0:#646670">];</span></div></div><div class="ec-line"><div class="code"><span style="--0:#A2447B">const</span><span style="--0:#565869"> res </span><span style="--0:#646670">=</span><span style="--0:#565869"> </span><span style="--0:#A2447B">await</span><span style="--0:#565869"> chain</span><span style="--0:#646670">.</span><span style="--0:#066C9F">call</span><span style="--0:#646670">({</span><span style="--0:#565869"> input_documents</span><span style="--0:#646670">,</span><span style="--0:#565869"> question</span><span style="--0:#646670">});</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#565869">console</span><span style="--0:#646670">.</span><span style="--0:#066C9F">log</span><span style="--0:#646670">(</span><span style="--0:#565869">res</span><span style="--0:#646670">.</span><span style="--0:#565869">text</span><span style="--0:#646670">)</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="// run: node index.jsimport { Ollama } from &#x22;langchain/llms/ollama&#x22;;import { loadQAStuffChain } from &#x22;langchain/chains&#x22;;import { Document } from &#x22;langchain/document&#x22;;const ollama = new Ollama(/*... same as before */);const question = &#x22;What color is the house at 6353 Juan Tabo Blvd?&#x22;const chain = loadQAStuffChain(ollama);const docs = [  new Document({ pageContent: &#x22;Houses on Juan Tabo Blvd are either red or blue&#x22; }),  new Document({ pageContent: &#x22;0 through 9999 are valid addresses on Juan Tabo Blvd&#x22; }),  new Document({ pageContent: &#x22;Houses on Juan Tabo Blvd with odd numbered addresses are red&#x22; }),];const res = await chain.call({ input_documents, question});console.log(res.text)"><div></div></button></div></figure></div>
<h3 id="result-1">result:</h3>
<div class="message success">
The house at 6353 on Juan Tabo Blvd has a red address because it is an odd number. According to the context given, houses on Juan Tabo Blvd with odd numbered addresses are red.
</div>
<h2 id="external-documents">External documents</h2>
<p>Here I have moved our context data into a single external text file.  We’ll use the TextLoader from LangChain to convert it into a Document.</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="md"><code><div class="ec-line"><div class="code"><span style="--0:#565869">// jauntabo.txt</span></div></div><div class="ec-line"><div class="code"><span style="--0:#565869">Houses on Juan Tabo Blvd are either red or blue.</span></div></div><div class="ec-line"><div class="code"><span style="--0:#565869">0 through 9999 are valid addresses on Juan Tabo Blvd.</span></div></div><div class="ec-line"><div class="code"><span style="--0:#565869">Houses on Juan Tabo Blvd with odd numbered addresses are red.</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="// jauntabo.txtHouses on Juan Tabo Blvd are either red or blue.0 through 9999 are valid addresses on Juan Tabo Blvd.Houses on Juan Tabo Blvd with odd numbered addresses are red."><div></div></button></div></figure></div>
<hr>
<div class="expressive-code"><figure class="frame has-title"><figcaption class="header"><span class="title">index.js</span></figcaption><pre data-language="js"><code><div class="ec-line"><div class="code"><span style="--0:#A2447B">import</span><span style="--0:#565869"> </span><span style="--0:#646670">{</span><span style="--0:#565869"> Ollama </span><span style="--0:#646670">}</span><span style="--0:#565869"> </span><span style="--0:#A2447B">from</span><span style="--0:#565869"> </span><span style="--0:#646670">"</span><span style="--0:#816100">langchain/llms/ollama</span><span style="--0:#646670">"</span><span style="--0:#646670">;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#A2447B">import</span><span style="--0:#565869"> </span><span style="--0:#646670">{</span><span style="--0:#565869"> loadQAStuffChain </span><span style="--0:#646670">}</span><span style="--0:#565869"> </span><span style="--0:#A2447B">from</span><span style="--0:#565869"> </span><span style="--0:#646670">"</span><span style="--0:#816100">langchain/chains</span><span style="--0:#646670">"</span><span style="--0:#646670">;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#A2447B">import</span><span style="--0:#565869"> </span><span style="--0:#646670">{</span><span style="--0:#565869"> Document </span><span style="--0:#646670">}</span><span style="--0:#565869"> </span><span style="--0:#A2447B">from</span><span style="--0:#565869"> </span><span style="--0:#646670">"</span><span style="--0:#816100">langchain/document</span><span style="--0:#646670">"</span><span style="--0:#646670">;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#A2447B">import</span><span style="--0:#565869"> </span><span style="--0:#646670">{</span><span style="--0:#565869"> TextLoader </span><span style="--0:#646670">}</span><span style="--0:#565869"> </span><span style="--0:#A2447B">from</span><span style="--0:#565869"> </span><span style="--0:#646670">"</span><span style="--0:#816100">langchain/document_loaders/fs/text</span><span style="--0:#646670">"</span><span style="--0:#646670">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#A2447B">const</span><span style="--0:#565869"> ollama </span><span style="--0:#646670">=</span><span style="--0:#565869"> </span><span style="--0:#A2447B">new</span><span style="--0:#565869"> </span><span style="--0:#066C9F">Ollama</span><span style="--0:#646670">(</span><span style="--0:#646670">/*... same as before */</span><span style="--0:#646670">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#A2447B">const</span><span style="--0:#565869"> question </span><span style="--0:#646670">=</span><span style="--0:#565869"> </span><span style="--0:#646670">"</span><span style="--0:#816100">What color is the house at 6353 on Juan Tabo Blvd?</span><span style="--0:#646670">"</span></div></div><div class="ec-line"><div class="code"><span style="--0:#A2447B">const</span><span style="--0:#565869"> chain </span><span style="--0:#646670">=</span><span style="--0:#565869"> </span><span style="--0:#066C9F">loadQAStuffChain</span><span style="--0:#646670">(</span><span style="--0:#565869">ollama</span><span style="--0:#646670">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#A2447B">const</span><span style="--0:#565869"> loader </span><span style="--0:#646670">=</span><span style="--0:#565869"> </span><span style="--0:#A2447B">new</span><span style="--0:#565869"> </span><span style="--0:#066C9F">TextLoader</span><span style="--0:#646670">(</span><span style="--0:#646670">"</span><span style="--0:#816100">./jauntabo.txt</span><span style="--0:#646670">"</span><span style="--0:#646670">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#A2447B">const</span><span style="--0:#565869"> input_documents </span><span style="--0:#646670">=</span><span style="--0:#565869"> </span><span style="--0:#A2447B">await</span><span style="--0:#565869"> loader</span><span style="--0:#646670">.</span><span style="--0:#066C9F">load</span><span style="--0:#646670">();</span></div></div><div class="ec-line"><div class="code"><span style="--0:#A2447B">const</span><span style="--0:#565869"> res </span><span style="--0:#646670">=</span><span style="--0:#565869"> </span><span style="--0:#A2447B">await</span><span style="--0:#565869"> chain</span><span style="--0:#646670">.</span><span style="--0:#066C9F">call</span><span style="--0:#646670">({</span><span style="--0:#565869"> input_documents</span><span style="--0:#646670">,</span><span style="--0:#565869"> question </span><span style="--0:#646670">});</span></div></div><div class="ec-line"><div class="code"><span style="--0:#565869">console</span><span style="--0:#646670">.</span><span style="--0:#066C9F">log</span><span style="--0:#646670">(</span><span style="--0:#565869">res</span><span style="--0:#646670">.</span><span style="--0:#565869">text</span><span style="--0:#646670">)</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="import { Ollama } from &#x22;langchain/llms/ollama&#x22;;import { loadQAStuffChain } from &#x22;langchain/chains&#x22;;import { Document } from &#x22;langchain/document&#x22;;import { TextLoader } from &#x22;langchain/document_loaders/fs/text&#x22;;const ollama = new Ollama(/*... same as before */);const question = &#x22;What color is the house at 6353 on Juan Tabo Blvd?&#x22;const chain = loadQAStuffChain(ollama);const loader = new TextLoader(&#x22;./jauntabo.txt&#x22;);const input_documents = await loader.load();const res = await chain.call({ input_documents, question });console.log(res.text)"><div></div></button></div></figure></div>
<h3 id="result-2">result</h3>
<div class="message success">
To determine the color of the house at 6353 Juan Tabo Blvd, we need to look at the address and see if it is an odd number. Since 6353 is an odd number, according to the information given, the house should be red. Therefore, the house at 6353 on Juan Tabo Blvd is red.
</div>
<h2 id="multiple-external-documents">Multiple external Documents</h2>
<p>Lastly, let’s have the code read a directory of external text documents.</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="md"><code><div class="ec-line"><div class="code"><span style="--0:#565869">--> /jauntabo/a.txt</span></div></div><div class="ec-line"><div class="code"><span style="--0:#565869">Houses on Juan Tabo Blvd are either red or blue.</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#565869">--> /jauntabo/b.txt</span></div></div><div class="ec-line"><div class="code"><span style="--0:#565869">0 through 9999 are valid addresses on Juan Tabo Blvd.</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#565869">--> /jauntabo/c.txt</span></div></div><div class="ec-line"><div class="code"><span style="--0:#565869">Houses on Juan Tabo Blvd with odd numbered addresses are red.</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#565869">--> /jauntabo/d.txt -- this is a new piece of context for the LLM!</span></div></div><div class="ec-line"><div class="code"><span style="--0:#565869">Houses on Juan Tabo Blvd with prime numbered addresses are blue.</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="--> /jauntabo/a.txtHouses on Juan Tabo Blvd are either red or blue.--> /jauntabo/b.txt0 through 9999 are valid addresses on Juan Tabo Blvd.--> /jauntabo/c.txtHouses on Juan Tabo Blvd with odd numbered addresses are red.--> /jauntabo/d.txt -- this is a new piece of context for the LLM!Houses on Juan Tabo Blvd with prime numbered addresses are blue."><div></div></button></div></figure></div>
<hr>
<div class="expressive-code"><figure class="frame has-title"><figcaption class="header"><span class="title">index.js</span></figcaption><pre data-language="js"><code><div class="ec-line"><div class="code"><span style="--0:#A2447B">import</span><span style="--0:#565869"> </span><span style="--0:#646670">{</span><span style="--0:#565869"> Ollama </span><span style="--0:#646670">}</span><span style="--0:#565869"> </span><span style="--0:#A2447B">from</span><span style="--0:#565869"> </span><span style="--0:#646670">"</span><span style="--0:#816100">langchain/llms/ollama</span><span style="--0:#646670">"</span><span style="--0:#646670">;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#A2447B">import</span><span style="--0:#565869"> </span><span style="--0:#646670">{</span><span style="--0:#565869"> loadQAStuffChain </span><span style="--0:#646670">}</span><span style="--0:#565869"> </span><span style="--0:#A2447B">from</span><span style="--0:#565869"> </span><span style="--0:#646670">"</span><span style="--0:#816100">langchain/chains</span><span style="--0:#646670">"</span><span style="--0:#646670">;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#A2447B">import</span><span style="--0:#565869"> </span><span style="--0:#646670">{</span><span style="--0:#565869"> Document </span><span style="--0:#646670">}</span><span style="--0:#565869"> </span><span style="--0:#A2447B">from</span><span style="--0:#565869"> </span><span style="--0:#646670">"</span><span style="--0:#816100">langchain/document</span><span style="--0:#646670">"</span><span style="--0:#646670">;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#A2447B">import</span><span style="--0:#565869"> </span><span style="--0:#646670">{</span><span style="--0:#565869"> TextLoader </span><span style="--0:#646670">}</span><span style="--0:#565869"> </span><span style="--0:#A2447B">from</span><span style="--0:#565869"> </span><span style="--0:#646670">"</span><span style="--0:#816100">langchain/document_loaders/fs/text</span><span style="--0:#646670">"</span><span style="--0:#646670">;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#A2447B">import</span><span style="--0:#565869"> </span><span style="--0:#646670">{</span><span style="--0:#565869"> DirectoryLoader </span><span style="--0:#646670">}</span><span style="--0:#565869"> </span><span style="--0:#A2447B">from</span><span style="--0:#565869"> </span><span style="--0:#646670">"</span><span style="--0:#816100">langchain/document_loaders/fs/directory</span><span style="--0:#646670">"</span><span style="--0:#646670">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#A2447B">const</span><span style="--0:#565869"> ollama </span><span style="--0:#646670">=</span><span style="--0:#565869"> </span><span style="--0:#A2447B">new</span><span style="--0:#565869"> </span><span style="--0:#066C9F">Ollama</span><span style="--0:#646670">(</span><span style="--0:#646670">/*... same as before */</span><span style="--0:#646670">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#A2447B">const</span><span style="--0:#565869"> question </span><span style="--0:#646670">=</span><span style="--0:#565869"> </span><span style="--0:#646670">"</span><span style="--0:#816100">What color is the house at 1901 on Juan Tabo Blvd?</span><span style="--0:#646670">"</span><span style="--0:#646670">;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#A2447B">const</span><span style="--0:#565869"> chain </span><span style="--0:#646670">=</span><span style="--0:#565869"> </span><span style="--0:#066C9F">loadQAStuffChain</span><span style="--0:#646670">(</span><span style="--0:#565869">ollama</span><span style="--0:#646670">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#A2447B">const</span><span style="--0:#565869"> loader </span><span style="--0:#646670">=</span><span style="--0:#565869"> </span><span style="--0:#A2447B">new</span><span style="--0:#565869"> </span><span style="--0:#066C9F">DirectoryLoader</span><span style="--0:#646670">(</span><span style="--0:#646670">"</span><span style="--0:#816100">jauntabo</span><span style="--0:#646670">"</span><span style="--0:#646670">,</span><span style="--0:#565869"> </span><span style="--0:#646670">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#646670">"</span><span style="--0:#11658F">.txt</span><span style="--0:#646670">"</span><span style="--0:#646670">:</span><span style="--0:#565869"> </span><span style="--0:#646670">(</span><span style="--0:#565869">path</span><span style="--0:#646670">)</span><span style="--0:#565869"> </span><span style="--0:#646670">=></span><span style="--0:#565869"> </span><span style="--0:#A2447B">new</span><span style="--0:#565869"> </span><span style="--0:#066C9F">TextLoader</span><span style="--0:#646670">(</span><span style="--0:#565869">path</span><span style="--0:#646670">)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#646670">});</span></div></div><div class="ec-line"><div class="code"><span style="--0:#A2447B">const</span><span style="--0:#565869"> input_documents </span><span style="--0:#646670">=</span><span style="--0:#565869"> </span><span style="--0:#A2447B">await</span><span style="--0:#565869"> loader</span><span style="--0:#646670">.</span><span style="--0:#066C9F">load</span><span style="--0:#646670">();</span></div></div><div class="ec-line"><div class="code"><span style="--0:#A2447B">const</span><span style="--0:#565869"> res </span><span style="--0:#646670">=</span><span style="--0:#565869"> </span><span style="--0:#A2447B">await</span><span style="--0:#565869"> chain</span><span style="--0:#646670">.</span><span style="--0:#066C9F">call</span><span style="--0:#646670">({</span><span style="--0:#565869"> input_documents</span><span style="--0:#646670">,</span><span style="--0:#565869"> question </span><span style="--0:#646670">});</span></div></div><div class="ec-line"><div class="code"><span style="--0:#565869">console</span><span style="--0:#646670">.</span><span style="--0:#066C9F">log</span><span style="--0:#646670">(</span><span style="--0:#565869">res</span><span style="--0:#646670">.</span><span style="--0:#565869">text</span><span style="--0:#646670">);</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="import { Ollama } from &#x22;langchain/llms/ollama&#x22;;import { loadQAStuffChain } from &#x22;langchain/chains&#x22;;import { Document } from &#x22;langchain/document&#x22;;import { TextLoader } from &#x22;langchain/document_loaders/fs/text&#x22;;import { DirectoryLoader } from &#x22;langchain/document_loaders/fs/directory&#x22;;const ollama = new Ollama(/*... same as before */);const question = &#x22;What color is the house at 1901 on Juan Tabo Blvd?&#x22;;const chain = loadQAStuffChain(ollama);const loader = new DirectoryLoader(&#x22;jauntabo&#x22;, {  &#x22;.txt&#x22;: (path) => new TextLoader(path)});const input_documents = await loader.load();const res = await chain.call({ input_documents, question });console.log(res.text);"><div></div></button></div></figure></div>
<h3 id="result-3">result</h3>
<div class="message success">
The house at 1901 on Juan Tabo Blvd is blue.
</div>   </div> </div>  <footer class="content-container page-footer"> <div class="border-t-1 border-gray-200 flex justify-between pt-6 pb-6 text-xs"> <div>I'm Joe Maddalone</div> <div><i>This is not a blog, these pages are changed all the time.</i></div> </div> </footer> </body></html>