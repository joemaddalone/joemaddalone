<!DOCTYPE html><html lang="en"> <head><meta charset="utf-8"><link rel="icon" type="image/x-icon" href="/assets/favicon.ico"><meta name="viewport" content="width=device-width"><meta name="generator" content="Astro v5.12.5"><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="apple-touch-icon" sizes="57x57" href="/assets/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png"><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/tachyons/4.11.1/tachyons.min.css" integrity="sha512-d0v474klOFSF7qD9WDvyRxAvXaWSxCHDZdnBSZQjo8BpVr6vpjwAgqetpqkKP38DzlOzdVPaLVnzzW1Ba8wB9w==" crossorigin="anonymous"><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.5.0/semantic.min.css"><link href="//unpkg.com/prismjs@1.20.0/themes/prism.css" rel="stylesheet"><title></title><style>.nav-links{width:100%;top:5rem;left:48px;background-color:#ff9776;display:none;margin:0}.nav-links a{display:block;text-align:center;padding:10px 0;text-decoration:none;font-size:1.2rem;font-weight:700;text-transform:uppercase}.nav-links a:hover,.nav-links a:focus{background-color:#ff9776}.expanded{display:unset}@media screen and (min-width: 636px){.nav-links{margin-left:5em;display:block;position:static;width:auto;background:none}.nav-links a{display:inline-block;padding:15px 20px}}html.dark{background-color:#0d0950;color:#fff}.dark .nav-links a{color:#fff}:root{--black: #000;--near-black: #111;--dark-gray: #333;--mid-gray: #555;--gray: #777;--silver: #999;--light-silver: #aaa;--moon-gray: #ccc;--light-gray: #eee;--near-white: #f8f8f8;--white: #fff;--transparent: transparent;--black-90: rgba(0, 0, 0, .9);--black-80: rgba(0, 0, 0, .8);--black-70: rgba(0, 0, 0, .7);--black-60: rgba(0, 0, 0, .6);--black-50: rgba(0, 0, 0, .5);--black-40: rgba(0, 0, 0, .4);--black-30: rgba(0, 0, 0, .3);--black-20: rgba(0, 0, 0, .2);--black-10: rgba(0, 0, 0, .1);--black-05: rgba(0, 0, 0, .05);--black-025: rgba(0, 0, 0, .025);--black-0125: rgba(0, 0, 0, .0125);--white-90: rgba(255, 255, 255, .9);--white-80: rgba(255, 255, 255, .8);--white-70: rgba(255, 255, 255, .7);--white-60: rgba(255, 255, 255, .6);--white-50: rgba(255, 255, 255, .5);--white-40: rgba(255, 255, 255, .4);--white-30: rgba(255, 255, 255, .3);--white-20: rgba(255, 255, 255, .2);--white-10: rgba(255, 255, 255, .1);--white-05: rgba(255, 255, 255, .05);--white-025: rgba(255, 255, 255, .025);--white-0125: rgba(255, 255, 255, .0125);--dark-red: #e7040f;--red: #ff4136;--light-red: #ff725c;--orange: #ff6300;--gold: #ffb700;--yellow: #ffd700;--light-yellow: #fbf1a9;--purple: #5e2ca5;--light-purple: #a463f2;--dark-purple: rebeccapurple;--dark-pink: #d5008f;--hot-pink: #ff41b4;--pink: #ff80cc;--light-pink: #ffa3d7;--dark-green: #137752;--green: #19a974;--light-green: #9eebcf;--navy: #001b44;--dark-blue: #00449e;--blue: #357edd;--light-blue: #96ccff;--lightest-blue: #cdecff;--washed-blue: #f6fffe;--washed-green: #e8fdf5;--washed-yellow: #fffceb;--washed-red: #ffdfdf}body,html{background-color:#eee;font-size:18px}header{font-size:75%;padding:25px 10px;margin:0 auto;max-width:800px;color:#222}header b{color:#222}footer{padding:15px 8px;font-size:75%;margin:20px auto;max-width:800px;border-top:1px dashed #222}.standard-article{margin:0 auto;padding:10px;max-width:800px;color:#222}.standard-article a{text-decoration:none}.standard-article a:hover{text-decoration:underline}.standard-article p{line-height:1.7;display:block}.standard-article pre{margin-bottom:15px;padding:1em;border-radius:.5em}.standard-article pre code{font-size:.8rem}.standard-article blockquote p{color:var(--black-60)}.standard-article hgroup{padding-left:16px;margin-bottom:16px;border-left:15px solid #222}.standard-article hgroup h1{margin-bottom:0}.standard-article hgroup p{margin:0;font-style:italic;color:#666}.postlist{margin:0;padding:4px}.postlist .postlist-item{display:flex;flex-direction:column;list-style-type:none;margin-top:15px}.postlist .postlist-item .postlist-date{font-size:1rem;padding-bottom:5px}.yt-embed{height:50vw;margin:1rem 0;max-height:25rem;width:100%}.resume-header{font-size:75%;padding:25px 10px;margin:0 auto;max-width:900px;color:#222}.resume-container{margin:0 auto;padding:10px;max-width:900px;color:#222}
</style></head> <body> <header class="flex items-center justify-between bb"> <b><a href="/writes/">I write stuff. sometimes.</a></b> <a href="/"> <img src="/assets/favicon-32x32.png" width="32" height="32" alt=""> </a> </header>  <div class="standard-article">  <hgroup>
	<h1>ollama</h1>
	<p>ollama + langchain</p>
</hgroup>
<h2 id="what-is-ollama">What is Ollama?</h2>
<p><a href="https://ollama.ai/">Ollama</a> is a tool for downloading and running large language models.  It’s like bittorrent for open source LLMs.</p>
<h2 id="what-is-langchain">What is LangChain?</h2>
<p>First, an LLM chain is the chaining of multiple LLM calls. We do this in order to deal with the constraint of limited context challenges when interacting with large volumes of information.</p>
<ul>
<li><strong>System prompt</strong>: “You are an assistant for question-answering tasks.  Use the following code sample to answer the question.  if you don’t know the answer, just say that you don’t know. Keep your answers concise.”</li>
<li><strong>Context</strong>: “Here is the code I’d like to discuss: …code…”</li>
<li><strong>Question</strong>: “How can I further optimize this code?”</li>
</ul>
<p>LLM Chains abstract away the complexity of multiple calls.  <a href="https://www.langchain.com/">LangChain</a> is an LLM Chain library we can use to produce our LLM Chain in order to provide context which, hopefully, results in less hallucinations.  LangChain also allows us to pair our LLM chain with document retrieval methods.  Pulling in PDFs or database records as context for our LLM chain is, put mildly, awesome.</p>
<h2 id="install-ollama">Install ollama</h2>
<pre class="astro-code snazzy-light" style="background-color:#FAFBFC;color:#565869; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#09A1ED">curl</span><span style="color:#CF9C00"> https://ollama.ai/install.sh</span><span style="color:#ADB1C2"> |</span><span style="color:#09A1ED"> sh</span></span></code></pre>
<h2 id="pull-a-model-or-two-or-three">Pull a model (or two, or three)</h2>
<pre class="astro-code snazzy-light" style="background-color:#FAFBFC;color:#565869; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#09A1ED">ollama</span><span style="color:#CF9C00"> pull</span><span style="color:#CF9C00"> llama2</span></span>
<span class="line"><span style="color:#09A1ED">ollama</span><span style="color:#CF9C00"> pull</span><span style="color:#CF9C00"> codellama</span></span>
<span class="line"><span style="color:#09A1ED">ollama</span><span style="color:#CF9C00"> pull</span><span style="color:#CF9C00"> mistral</span></span></code></pre>
<h2 id="start-ollama">Start ollama</h2>
<p>If you get a <em>port already in use</em> error, this is common on Linux immediately after installation.  It’s already running.</p>
<pre class="astro-code snazzy-light" style="background-color:#FAFBFC;color:#565869; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#09A1ED">ollama</span><span style="color:#CF9C00"> serve</span></span></code></pre>
<p>ollama is now available at <a href="http://localhost:11434">http://localhost:11434</a></p>
<pre class="astro-code snazzy-light" style="background-color:#FAFBFC;color:#565869; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#09A1ED">curl</span><span style="color:#CF9C00"> http://localhost:11434</span></span>
<span class="line"><span style="color:#09A1ED">Ollama</span><span style="color:#CF9C00"> is</span><span style="color:#CF9C00"> running</span></span>
<span class="line"></span>
<span class="line"><span style="color:#09A1ED">curl</span><span style="color:#CF9C00"> http://localhost:11434/api/tags</span></span>
<span class="line"><span style="color:#ADB1C2">{</span><span style="color:#09A1ED">"models"</span><span style="color:#09A1ED">:</span><span style="color:#CF9C00">[</span></span>
<span class="line"><span style="color:#ADB1C2">	{</span><span style="color:#09A1ED">"name"</span><span style="color:#09A1ED">:</span><span style="color:#09A1ED">"codellama:latest"</span><span style="color:#09A1ED">,...},</span></span>
<span class="line"><span style="color:#ADB1C2">	{</span><span style="color:#09A1ED">"name"</span><span style="color:#09A1ED">:</span><span style="color:#09A1ED">"llama2:latest"</span><span style="color:#09A1ED">,...},</span></span>
<span class="line"><span style="color:#ADB1C2">	{</span><span style="color:#09A1ED">"name"</span><span style="color:#09A1ED">:</span><span style="color:#09A1ED">"mistral:latest"</span><span style="color:#09A1ED">,...}</span></span>
<span class="line"><span style="color:#565869">]}</span></span></code></pre>
<p>I personally run this on a custom port with</p>
<pre class="astro-code snazzy-light" style="background-color:#FAFBFC;color:#565869; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#565869">OLLAMA_HOST</span><span style="color:#ADB1C2">=</span><span style="color:#CF9C00">0.0.0.0:9494</span><span style="color:#09A1ED"> ollama</span><span style="color:#CF9C00"> serve</span></span></code></pre>
<h2 id="setup-project">Setup project</h2>
<pre class="astro-code snazzy-light" style="background-color:#FAFBFC;color:#565869; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#09A1ED">mkdir</span><span style="color:#CF9C00"> ai-local</span></span>
<span class="line"><span style="color:#09A1ED">cd</span><span style="color:#CF9C00"> ai-local</span></span>
<span class="line"><span style="color:#09A1ED">npm</span><span style="color:#CF9C00"> init</span><span style="color:#2DAE58"> -y</span></span>
<span class="line"><span style="color:#09A1ED">npm</span><span style="color:#CF9C00"> i</span><span style="color:#CF9C00"> langchain</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ADB1C2"># add "type": "module" to package.json</span></span>
<span class="line"></span></code></pre>
<h2 id="our-first-app-impossible-question">Our first app, impossible question</h2>
<pre class="astro-code snazzy-light" style="background-color:#FAFBFC;color:#565869; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#ADB1C2">// index.js</span></span>
<span class="line"><span style="color:#ADB1C2">// run: node index.js</span></span>
<span class="line"><span style="color:#F767BB">import</span><span style="color:#ADB1C2"> {</span><span style="color:#565869"> Ollama </span><span style="color:#ADB1C2">}</span><span style="color:#F767BB"> from</span><span style="color:#ADB1C2"> "</span><span style="color:#CF9C00">langchain/llms/ollama</span><span style="color:#ADB1C2">"</span><span style="color:#ADB1C2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F767BB">const</span><span style="color:#565869"> ollama </span><span style="color:#ADB1C2">=</span><span style="color:#F767BB"> new</span><span style="color:#09A1ED"> Ollama</span><span style="color:#ADB1C2">({</span></span>
<span class="line"><span style="color:#11658F">  baseUrl</span><span style="color:#ADB1C2">:</span><span style="color:#ADB1C2"> "</span><span style="color:#CF9C00">http://localhost:11434</span><span style="color:#ADB1C2">"</span><span style="color:#ADB1C2">,</span></span>
<span class="line"><span style="color:#11658F">  model</span><span style="color:#ADB1C2">:</span><span style="color:#ADB1C2"> "</span><span style="color:#CF9C00">mistral</span><span style="color:#ADB1C2">"</span><span style="color:#ADB1C2"> // using the mistral LLM.</span></span>
<span class="line"><span style="color:#ADB1C2">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F767BB">const</span><span style="color:#565869"> question </span><span style="color:#ADB1C2">=</span><span style="color:#ADB1C2"> "</span><span style="color:#CF9C00">What color is the house at 6353 Juan Tabo Blvd?</span><span style="color:#ADB1C2">"</span></span>
<span class="line"><span style="color:#F767BB">const</span><span style="color:#565869"> res </span><span style="color:#ADB1C2">=</span><span style="color:#F767BB"> await</span><span style="color:#565869"> ollama</span><span style="color:#ADB1C2">.</span><span style="color:#09A1ED">call</span><span style="color:#ADB1C2">();</span></span>
<span class="line"><span style="color:#565869">console</span><span style="color:#ADB1C2">.</span><span style="color:#09A1ED">log</span><span style="color:#ADB1C2">(</span><span style="color:#565869">res</span><span style="color:#ADB1C2">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ADB1C2">// alternatively we could capture the response as a stream.</span></span>
<span class="line"><span style="color:#ADB1C2">// const stream = await ollama.stream(question);</span></span>
<span class="line"><span style="color:#ADB1C2">// for await (const chunk of stream) {</span></span>
<span class="line"><span style="color:#ADB1C2">// 	process.stdout.write(chunk);</span></span>
<span class="line"><span style="color:#ADB1C2">// }</span></span></code></pre>
<p>This should result in something along the lines of:</p>
<div class="ui ignored info message">
<p>The color of the house at 6353 Juan Tabo Blvd … would depend
on the specific property and its owners. There are no records to
indicate the color of this particular house…</p>
</div>
Obviously the the LLM does not know the color of the house.  Had we asked some more general question we would definitely get an answer, but I have purposely asked it something it does not know.
<p>So let’s give it some context.</p>
<h2 id="chain-and-document-and-stuff">chain and Document and Stuff</h2>
<p>We covered what a <code>chain</code> is previously.  To <code>Stuff</code> a chain is exactly what it sounds like.  Fill it with stuff.  In this case stuff it with <code>Documents</code></p>
<pre class="astro-code snazzy-light" style="background-color:#FAFBFC;color:#565869; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#ADB1C2">// index.js</span></span>
<span class="line"><span style="color:#ADB1C2">// run: node index.js</span></span>
<span class="line"><span style="color:#F767BB">import</span><span style="color:#ADB1C2"> {</span><span style="color:#565869"> Ollama </span><span style="color:#ADB1C2">}</span><span style="color:#F767BB"> from</span><span style="color:#ADB1C2"> "</span><span style="color:#CF9C00">langchain/llms/ollama</span><span style="color:#ADB1C2">"</span><span style="color:#ADB1C2">;</span></span>
<span class="line"><span style="color:#F767BB">import</span><span style="color:#ADB1C2"> {</span><span style="color:#565869"> loadQAStuffChain </span><span style="color:#ADB1C2">}</span><span style="color:#F767BB"> from</span><span style="color:#ADB1C2"> "</span><span style="color:#CF9C00">langchain/chains</span><span style="color:#ADB1C2">"</span><span style="color:#ADB1C2">;</span></span>
<span class="line"><span style="color:#F767BB">import</span><span style="color:#ADB1C2"> {</span><span style="color:#565869"> Document </span><span style="color:#ADB1C2">}</span><span style="color:#F767BB"> from</span><span style="color:#ADB1C2"> "</span><span style="color:#CF9C00">langchain/document</span><span style="color:#ADB1C2">"</span><span style="color:#ADB1C2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F767BB">const</span><span style="color:#565869"> ollama </span><span style="color:#ADB1C2">=</span><span style="color:#F767BB"> new</span><span style="color:#09A1ED"> Ollama</span><span style="color:#ADB1C2">(</span><span style="color:#ADB1C2">/*... same as before */</span><span style="color:#ADB1C2">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F767BB">const</span><span style="color:#565869"> question </span><span style="color:#ADB1C2">=</span><span style="color:#ADB1C2"> "</span><span style="color:#CF9C00">What color is the house at 6353 Juan Tabo Blvd?</span><span style="color:#ADB1C2">"</span></span>
<span class="line"><span style="color:#F767BB">const</span><span style="color:#565869"> chain </span><span style="color:#ADB1C2">=</span><span style="color:#09A1ED"> loadQAStuffChain</span><span style="color:#ADB1C2">(</span><span style="color:#565869">ollama</span><span style="color:#ADB1C2">);</span></span>
<span class="line"><span style="color:#F767BB">const</span><span style="color:#565869"> input_documents </span><span style="color:#ADB1C2">=</span><span style="color:#ADB1C2"> [</span></span>
<span class="line"><span style="color:#F767BB">	new</span><span style="color:#09A1ED"> Document</span><span style="color:#ADB1C2">({</span><span style="color:#11658F"> pageContent</span><span style="color:#ADB1C2">:</span><span style="color:#ADB1C2"> "</span><span style="color:#CF9C00">The color of the house at 6353 Juan Tabo Blvd is blue</span><span style="color:#ADB1C2">"</span><span style="color:#ADB1C2"> })</span></span>
<span class="line"><span style="color:#ADB1C2">];</span></span>
<span class="line"><span style="color:#F767BB">const</span><span style="color:#565869"> res </span><span style="color:#ADB1C2">=</span><span style="color:#F767BB"> await</span><span style="color:#565869"> chain</span><span style="color:#ADB1C2">.</span><span style="color:#09A1ED">call</span><span style="color:#ADB1C2">({</span><span style="color:#565869"> input_documents</span><span style="color:#ADB1C2">,</span><span style="color:#565869"> question</span><span style="color:#ADB1C2">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#565869">console</span><span style="color:#ADB1C2">.</span><span style="color:#09A1ED">log</span><span style="color:#ADB1C2">(</span><span style="color:#565869">res</span><span style="color:#ADB1C2">.</span><span style="color:#565869">text</span><span style="color:#ADB1C2">)</span></span></code></pre>
<h3 id="result">result:</h3>
<div class="ui ignored info message">
The color of the house at 6353 Juan Tabo is blue.
</div>
<p>Much better.  And kind of exciting when you observe what actually happened.  We taught the model about something new.  We could have told it anything.  This example was a bit “call and response”.  Let’s see if it can infer information from slightly less direct context.</p>
<pre class="astro-code snazzy-light" style="background-color:#FAFBFC;color:#565869; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#ADB1C2">// index.js</span></span>
<span class="line"><span style="color:#ADB1C2">// run: node index.js</span></span>
<span class="line"><span style="color:#F767BB">import</span><span style="color:#ADB1C2"> {</span><span style="color:#565869"> Ollama </span><span style="color:#ADB1C2">}</span><span style="color:#F767BB"> from</span><span style="color:#ADB1C2"> "</span><span style="color:#CF9C00">langchain/llms/ollama</span><span style="color:#ADB1C2">"</span><span style="color:#ADB1C2">;</span></span>
<span class="line"><span style="color:#F767BB">import</span><span style="color:#ADB1C2"> {</span><span style="color:#565869"> loadQAStuffChain </span><span style="color:#ADB1C2">}</span><span style="color:#F767BB"> from</span><span style="color:#ADB1C2"> "</span><span style="color:#CF9C00">langchain/chains</span><span style="color:#ADB1C2">"</span><span style="color:#ADB1C2">;</span></span>
<span class="line"><span style="color:#F767BB">import</span><span style="color:#ADB1C2"> {</span><span style="color:#565869"> Document </span><span style="color:#ADB1C2">}</span><span style="color:#F767BB"> from</span><span style="color:#ADB1C2"> "</span><span style="color:#CF9C00">langchain/document</span><span style="color:#ADB1C2">"</span><span style="color:#ADB1C2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F767BB">const</span><span style="color:#565869"> ollama </span><span style="color:#ADB1C2">=</span><span style="color:#F767BB"> new</span><span style="color:#09A1ED"> Ollama</span><span style="color:#ADB1C2">(</span><span style="color:#ADB1C2">/*... same as before */</span><span style="color:#ADB1C2">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F767BB">const</span><span style="color:#565869"> question </span><span style="color:#ADB1C2">=</span><span style="color:#ADB1C2"> "</span><span style="color:#CF9C00">What color is the house at 6353 Juan Tabo Blvd?</span><span style="color:#ADB1C2">"</span></span>
<span class="line"><span style="color:#F767BB">const</span><span style="color:#565869"> chain </span><span style="color:#ADB1C2">=</span><span style="color:#09A1ED"> loadQAStuffChain</span><span style="color:#ADB1C2">(</span><span style="color:#565869">ollama</span><span style="color:#ADB1C2">);</span></span>
<span class="line"><span style="color:#F767BB">const</span><span style="color:#565869"> docs </span><span style="color:#ADB1C2">=</span><span style="color:#ADB1C2"> [</span></span>
<span class="line"><span style="color:#F767BB">  new</span><span style="color:#09A1ED"> Document</span><span style="color:#ADB1C2">({</span><span style="color:#11658F"> pageContent</span><span style="color:#ADB1C2">:</span><span style="color:#ADB1C2"> "</span><span style="color:#CF9C00">Houses on Juan Tabo Blvd are either red or blue</span><span style="color:#ADB1C2">"</span><span style="color:#ADB1C2"> }),</span></span>
<span class="line"><span style="color:#F767BB">  new</span><span style="color:#09A1ED"> Document</span><span style="color:#ADB1C2">({</span><span style="color:#11658F"> pageContent</span><span style="color:#ADB1C2">:</span><span style="color:#ADB1C2"> "</span><span style="color:#CF9C00">0 through 9999 are valid addresses on Juan Tabo Blvd</span><span style="color:#ADB1C2">"</span><span style="color:#ADB1C2"> }),</span></span>
<span class="line"><span style="color:#F767BB">  new</span><span style="color:#09A1ED"> Document</span><span style="color:#ADB1C2">({</span><span style="color:#11658F"> pageContent</span><span style="color:#ADB1C2">:</span><span style="color:#ADB1C2"> "</span><span style="color:#CF9C00">Houses on Juan Tabo Blvd with odd numbered addresses are red</span><span style="color:#ADB1C2">"</span><span style="color:#ADB1C2"> }),</span></span>
<span class="line"><span style="color:#ADB1C2">];</span></span>
<span class="line"><span style="color:#F767BB">const</span><span style="color:#565869"> res </span><span style="color:#ADB1C2">=</span><span style="color:#F767BB"> await</span><span style="color:#565869"> chain</span><span style="color:#ADB1C2">.</span><span style="color:#09A1ED">call</span><span style="color:#ADB1C2">({</span><span style="color:#565869"> input_documents</span><span style="color:#ADB1C2">,</span><span style="color:#565869"> question</span><span style="color:#ADB1C2">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#565869">console</span><span style="color:#ADB1C2">.</span><span style="color:#09A1ED">log</span><span style="color:#ADB1C2">(</span><span style="color:#565869">res</span><span style="color:#ADB1C2">.</span><span style="color:#565869">text</span><span style="color:#ADB1C2">)</span></span></code></pre>
<h3 id="result-1">result:</h3>
<div class="ui ignored info message">
<p>The house at 6353 on Juan Tabo Blvd has a red address because it is an odd number. According to the context given, houses on Juan Tabo Blvd with odd numbered addresses are red.</p>
</div>
<h2 id="external-documents">External documents</h2>
<p>Here I have moved our context data into a single external text file.  We’ll use the TextLoader from LangChain to convert it into a Document.</p>
<pre class="astro-code snazzy-light" style="background-color:#FAFBFC;color:#565869; overflow-x: auto;" tabindex="0" data-language="md"><code><span class="line"><span style="color:#565869">// jauntabo.txt</span></span>
<span class="line"><span style="color:#565869">Houses on Juan Tabo Blvd are either red or blue.</span></span>
<span class="line"><span style="color:#565869">0 through 9999 are valid addresses on Juan Tabo Blvd.</span></span>
<span class="line"><span style="color:#565869">Houses on Juan Tabo Blvd with odd numbered addresses are red.</span></span></code></pre>
<pre class="astro-code snazzy-light" style="background-color:#FAFBFC;color:#565869; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#F767BB">import</span><span style="color:#ADB1C2"> {</span><span style="color:#565869"> Ollama </span><span style="color:#ADB1C2">}</span><span style="color:#F767BB"> from</span><span style="color:#ADB1C2"> "</span><span style="color:#CF9C00">langchain/llms/ollama</span><span style="color:#ADB1C2">"</span><span style="color:#ADB1C2">;</span></span>
<span class="line"><span style="color:#F767BB">import</span><span style="color:#ADB1C2"> {</span><span style="color:#565869"> loadQAStuffChain </span><span style="color:#ADB1C2">}</span><span style="color:#F767BB"> from</span><span style="color:#ADB1C2"> "</span><span style="color:#CF9C00">langchain/chains</span><span style="color:#ADB1C2">"</span><span style="color:#ADB1C2">;</span></span>
<span class="line"><span style="color:#F767BB">import</span><span style="color:#ADB1C2"> {</span><span style="color:#565869"> Document </span><span style="color:#ADB1C2">}</span><span style="color:#F767BB"> from</span><span style="color:#ADB1C2"> "</span><span style="color:#CF9C00">langchain/document</span><span style="color:#ADB1C2">"</span><span style="color:#ADB1C2">;</span></span>
<span class="line"><span style="color:#F767BB">import</span><span style="color:#ADB1C2"> {</span><span style="color:#565869"> TextLoader </span><span style="color:#ADB1C2">}</span><span style="color:#F767BB"> from</span><span style="color:#ADB1C2"> "</span><span style="color:#CF9C00">langchain/document_loaders/fs/text</span><span style="color:#ADB1C2">"</span><span style="color:#ADB1C2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F767BB">const</span><span style="color:#565869"> ollama </span><span style="color:#ADB1C2">=</span><span style="color:#F767BB"> new</span><span style="color:#09A1ED"> Ollama</span><span style="color:#ADB1C2">(</span><span style="color:#ADB1C2">/*... same as before */</span><span style="color:#ADB1C2">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F767BB">const</span><span style="color:#565869"> question </span><span style="color:#ADB1C2">=</span><span style="color:#ADB1C2"> "</span><span style="color:#CF9C00">What color is the house at 6353 on Juan Tabo Blvd?</span><span style="color:#ADB1C2">"</span></span>
<span class="line"><span style="color:#F767BB">const</span><span style="color:#565869"> chain </span><span style="color:#ADB1C2">=</span><span style="color:#09A1ED"> loadQAStuffChain</span><span style="color:#ADB1C2">(</span><span style="color:#565869">ollama</span><span style="color:#ADB1C2">);</span></span>
<span class="line"><span style="color:#F767BB">const</span><span style="color:#565869"> loader </span><span style="color:#ADB1C2">=</span><span style="color:#F767BB"> new</span><span style="color:#09A1ED"> TextLoader</span><span style="color:#ADB1C2">(</span><span style="color:#ADB1C2">"</span><span style="color:#CF9C00">./jauntabo.txt</span><span style="color:#ADB1C2">"</span><span style="color:#ADB1C2">);</span></span>
<span class="line"><span style="color:#F767BB">const</span><span style="color:#565869"> input_documents </span><span style="color:#ADB1C2">=</span><span style="color:#F767BB"> await</span><span style="color:#565869"> loader</span><span style="color:#ADB1C2">.</span><span style="color:#09A1ED">load</span><span style="color:#ADB1C2">();</span></span>
<span class="line"><span style="color:#F767BB">const</span><span style="color:#565869"> res </span><span style="color:#ADB1C2">=</span><span style="color:#F767BB"> await</span><span style="color:#565869"> chain</span><span style="color:#ADB1C2">.</span><span style="color:#09A1ED">call</span><span style="color:#ADB1C2">({</span><span style="color:#565869"> input_documents</span><span style="color:#ADB1C2">,</span><span style="color:#565869"> question </span><span style="color:#ADB1C2">});</span></span>
<span class="line"><span style="color:#565869">console</span><span style="color:#ADB1C2">.</span><span style="color:#09A1ED">log</span><span style="color:#ADB1C2">(</span><span style="color:#565869">res</span><span style="color:#ADB1C2">.</span><span style="color:#565869">text</span><span style="color:#ADB1C2">)</span></span></code></pre>
<h3 id="result-2">result</h3>
<div class="ui ignored info message">
<p>To determine the color of the house at 6353 Juan Tabo Blvd, we need to look at the address and see if it is an odd number. Since 6353 is an odd number, according to the information given, the house should be red. Therefore, the house at 6353 on Juan Tabo Blvd is red.</p>
</div>
<h2 id="multiple-external-documents">Multiple external Documents</h2>
<p>Lastly, let’s have the code read a directory of external text documents.</p>
<pre class="astro-code snazzy-light" style="background-color:#FAFBFC;color:#565869; overflow-x: auto;" tabindex="0" data-language="md"><code><span class="line"><span style="color:#565869">--> /jauntabo/a.txt</span></span>
<span class="line"><span style="color:#565869">Houses on Juan Tabo Blvd are either red or blue.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#565869">--> /jauntabo/b.txt</span></span>
<span class="line"><span style="color:#565869">0 through 9999 are valid addresses on Juan Tabo Blvd.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#565869">--> /jauntabo/c.txt</span></span>
<span class="line"><span style="color:#565869">Houses on Juan Tabo Blvd with odd numbered addresses are red.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#565869">--> /jauntabo/d.txt -- this is a new piece of context for the LLM!</span></span>
<span class="line"><span style="color:#565869">Houses on Juan Tabo Blvd with prime numbered addresses are blue.</span></span></code></pre>
<pre class="astro-code snazzy-light" style="background-color:#FAFBFC;color:#565869; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#F767BB">import</span><span style="color:#ADB1C2"> {</span><span style="color:#565869"> Ollama </span><span style="color:#ADB1C2">}</span><span style="color:#F767BB"> from</span><span style="color:#ADB1C2"> "</span><span style="color:#CF9C00">langchain/llms/ollama</span><span style="color:#ADB1C2">"</span><span style="color:#ADB1C2">;</span></span>
<span class="line"><span style="color:#F767BB">import</span><span style="color:#ADB1C2"> {</span><span style="color:#565869"> loadQAStuffChain </span><span style="color:#ADB1C2">}</span><span style="color:#F767BB"> from</span><span style="color:#ADB1C2"> "</span><span style="color:#CF9C00">langchain/chains</span><span style="color:#ADB1C2">"</span><span style="color:#ADB1C2">;</span></span>
<span class="line"><span style="color:#F767BB">import</span><span style="color:#ADB1C2"> {</span><span style="color:#565869"> Document </span><span style="color:#ADB1C2">}</span><span style="color:#F767BB"> from</span><span style="color:#ADB1C2"> "</span><span style="color:#CF9C00">langchain/document</span><span style="color:#ADB1C2">"</span><span style="color:#ADB1C2">;</span></span>
<span class="line"><span style="color:#F767BB">import</span><span style="color:#ADB1C2"> {</span><span style="color:#565869"> TextLoader </span><span style="color:#ADB1C2">}</span><span style="color:#F767BB"> from</span><span style="color:#ADB1C2"> "</span><span style="color:#CF9C00">langchain/document_loaders/fs/text</span><span style="color:#ADB1C2">"</span><span style="color:#ADB1C2">;</span></span>
<span class="line"><span style="color:#F767BB">import</span><span style="color:#ADB1C2"> {</span><span style="color:#565869"> DirectoryLoader </span><span style="color:#ADB1C2">}</span><span style="color:#F767BB"> from</span><span style="color:#ADB1C2"> "</span><span style="color:#CF9C00">langchain/document_loaders/fs/directory</span><span style="color:#ADB1C2">"</span><span style="color:#ADB1C2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F767BB">const</span><span style="color:#565869"> ollama </span><span style="color:#ADB1C2">=</span><span style="color:#F767BB"> new</span><span style="color:#09A1ED"> Ollama</span><span style="color:#ADB1C2">(</span><span style="color:#ADB1C2">/*... same as before */</span><span style="color:#ADB1C2">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F767BB">const</span><span style="color:#565869"> question </span><span style="color:#ADB1C2">=</span><span style="color:#ADB1C2"> "</span><span style="color:#CF9C00">What color is the house at 1901 on Juan Tabo Blvd?</span><span style="color:#ADB1C2">"</span><span style="color:#ADB1C2">;</span></span>
<span class="line"><span style="color:#F767BB">const</span><span style="color:#565869"> chain </span><span style="color:#ADB1C2">=</span><span style="color:#09A1ED"> loadQAStuffChain</span><span style="color:#ADB1C2">(</span><span style="color:#565869">ollama</span><span style="color:#ADB1C2">);</span></span>
<span class="line"><span style="color:#F767BB">const</span><span style="color:#565869"> loader </span><span style="color:#ADB1C2">=</span><span style="color:#F767BB"> new</span><span style="color:#09A1ED"> DirectoryLoader</span><span style="color:#ADB1C2">(</span><span style="color:#ADB1C2">"</span><span style="color:#CF9C00">jauntabo</span><span style="color:#ADB1C2">"</span><span style="color:#ADB1C2">,</span><span style="color:#ADB1C2"> {</span></span>
<span class="line"><span style="color:#ADB1C2">  "</span><span style="color:#11658F">.txt</span><span style="color:#ADB1C2">"</span><span style="color:#ADB1C2">:</span><span style="color:#ADB1C2"> (</span><span style="color:#565869">path</span><span style="color:#ADB1C2">)</span><span style="color:#ADB1C2"> =></span><span style="color:#F767BB"> new</span><span style="color:#09A1ED"> TextLoader</span><span style="color:#ADB1C2">(</span><span style="color:#565869">path</span><span style="color:#ADB1C2">)</span></span>
<span class="line"><span style="color:#ADB1C2">});</span></span>
<span class="line"><span style="color:#F767BB">const</span><span style="color:#565869"> input_documents </span><span style="color:#ADB1C2">=</span><span style="color:#F767BB"> await</span><span style="color:#565869"> loader</span><span style="color:#ADB1C2">.</span><span style="color:#09A1ED">load</span><span style="color:#ADB1C2">();</span></span>
<span class="line"><span style="color:#F767BB">const</span><span style="color:#565869"> res </span><span style="color:#ADB1C2">=</span><span style="color:#F767BB"> await</span><span style="color:#565869"> chain</span><span style="color:#ADB1C2">.</span><span style="color:#09A1ED">call</span><span style="color:#ADB1C2">({</span><span style="color:#565869"> input_documents</span><span style="color:#ADB1C2">,</span><span style="color:#565869"> question </span><span style="color:#ADB1C2">});</span></span>
<span class="line"><span style="color:#565869">console</span><span style="color:#ADB1C2">.</span><span style="color:#09A1ED">log</span><span style="color:#ADB1C2">(</span><span style="color:#565869">res</span><span style="color:#ADB1C2">.</span><span style="color:#565869">text</span><span style="color:#ADB1C2">);</span></span></code></pre>
<h3 id="result-3">result</h3>
<div class="ui ignored info message">
<p>The house at 1901 on Juan Tabo Blvd is blue.</p>
</div>  </div>  <footer class="flex justify-between"> <div>I'm Joe Maddalone</div> <div><i>This is not a blog, these pages are changed all the time.</i></div> </footer> </body></html>