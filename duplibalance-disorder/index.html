<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="apple-touch-icon" sizes="57x57" href="/assets/apple-icon-57x57.034c3e17.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/apple-icon-60x60.d1b335d8.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/apple-icon-72x72.639c03b3.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/apple-icon-76x76.d1818067.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/apple-icon-114x114.07a3b4e8.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/apple-icon-120x120.ac9883bb.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/apple-icon-144x144.9f8d2b36.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/apple-icon-152x152.77f1b6fb.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-icon-180x180.b2a7fc8d.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/android-icon-192x192.2a711125.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.71f7d1c5.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/favicon-96x96.498e56db.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.5a17786a.png"><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tachyons/4.11.1/tachyons.min.css" integrity="sha512-d0v474klOFSF7qD9WDvyRxAvXaWSxCHDZdnBSZQjo8BpVr6vpjwAgqetpqkKP38DzlOzdVPaLVnzzW1Ba8wB9w==" crossorigin="anonymous"><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.5.0/semantic.min.css"><link href="https://unpkg.com/prismjs@1.20.0/themes/prism.css" rel="stylesheet"><title>DupliBalance Disorder | joe talks too much</title><meta name="description" content="Dumb app + automation I did today"><meta name="robots" content="index,follow"><meta name="author" content="Joe Maddalone"><link rel="canonical" href="https://joemaddalone.com/duplibalance-disorder/"><meta property="og:title" content="DupliBalance Disorder | joe talks too much"><meta property="og:type" content="article"><meta property="og:url" content="https://joemaddalone.com/duplibalance-disorder/"><meta property="og:description" content="Dumb app + automation I did today"><meta property="og:image" content="https://joemaddalone.com/assets/android-icon-192x192.png"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@joemaddalone"><meta name="twitter:url" content="https://joemaddalone.com/duplibalance-disorder/"><meta name="twitter:title" content="DupliBalance Disorder | joe talks too much"><meta name="twitter:description" content="Dumb app + automation I did today"><meta name="twitter:image" content="https://joemaddalone.com/assets/android-icon-192x192.png">  <link rel="stylesheet" href="/assets/index.2f1165de.css">
</head><body><header class="flex items-center justify-between bb"><b><a href="/writes/">I write stuff. sometimes.</a></b> <a href="/"><img src="/assets/favicon-32x32.71f7d1c5.png" width="32" height="32" alt=""></a></header><main class="standard-article"><hgroup><h1>DupliBalance Disorder</h1><p>Dumb app + automation I did today</p></hgroup><h2>I hate most financial snapshot apps... eventually.</h2><p>So, I started off using PersonalCapital, then it turned into Empower. After that, I switched to Mint, and now it's Credit Karma. The funny thing is, all these apps seem to suffer from what I call &quot;DupliBalance Disorder.&quot; You know, the classic scenario where you check your financial data, and suddenly, an account decides to clone itself, messing up all your totals. You try to fix it by kicking out the extra account, but whoops, it ends up deleting both. Add it back, and now you've got three.</p><p>Honestly, I don't need the whole everyday budgeting and tracking thing and other apps do a great job of that. I just wanted something that could give me real-time info on my money situation. I'm mostly looking for my bottom line. (cash + investments) - debt.</p><p>So...</p><h2>Access</h2><p>I signed up for <a href="https://plaid.com/pricing/">Plaid's free plan</a>. Then used <a href="https://github.com/kevinschaich/mintable">mintable</a> to easily get the keys I needed.</p><p>Now I have a <code>config</code> like this,</p><pre class="language-js"><code class="language-js"><span class="token punctuation">{</span><br>	<span class="token string">"plaid"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>		<span class="token string">"PLAID-CLIENT-ID"</span><span class="token operator">:</span> <span class="token string">"xoxoxoxoxoxoxoxoxo"</span><span class="token punctuation">,</span><br>		<span class="token string">"PLAID-SECRET"</span><span class="token operator">:</span> <span class="token string">"xoxoxoxoxoxoxoxoxo"</span><span class="token punctuation">,</span><br>		<span class="token string">"Plaid-Version"</span><span class="token operator">:</span> <span class="token string">"nnnn-nn-nn"</span><br>	<span class="token punctuation">}</span><span class="token punctuation">,</span><br>	<span class="token string">"accounts"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>		<span class="token string">"institution_1"</span><span class="token operator">:</span> <span class="token string">"access-development-xoxoxoxoxoxoxoxoxo"</span><span class="token punctuation">,</span><br>		<span class="token string">"institution_2"</span><span class="token operator">:</span> <span class="token string">"access-development-xoxoxoxoxoxoxoxoxo"</span><br>	<span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><h2>Plaid</h2><p>The plaid npm package is great, but I really only need to do a few things, so adding my own wrapper seemed like a good idea.</p><pre class="language-js"><code class="language-js"><span class="token comment">// api.mjs</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> Configuration<span class="token punctuation">,</span> PlaidApi<span class="token punctuation">,</span> PlaidEnvironments <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"plaid"</span><span class="token punctuation">;</span><br><br><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Api</span> <span class="token punctuation">{</span><br>  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>plaidClient <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>config <span class="token operator">=</span> config<span class="token punctuation">;</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">makeClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token function">makeClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>plaidClient<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token keyword">const</span> configuration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Configuration</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>        basePath<span class="token operator">:</span> PlaidEnvironments<span class="token punctuation">.</span>development<span class="token punctuation">,</span><br>        baseOptions<span class="token operator">:</span> <span class="token punctuation">{</span><br>          headers<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>config<span class="token punctuation">.</span>plaid <span class="token punctuation">}</span><span class="token punctuation">,</span><br>        <span class="token punctuation">}</span><span class="token punctuation">,</span><br>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>      <span class="token keyword">this</span><span class="token punctuation">.</span>plaidClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PlaidApi</span><span class="token punctuation">(</span>configuration<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token keyword">async</span> <span class="token function">balance</span><span class="token punctuation">(</span><span class="token parameter">access_token</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">try</span> <span class="token punctuation">{</span><br>      <span class="token keyword">const</span> accounts_response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>plaidClient<span class="token punctuation">.</span><span class="token function">accountsBalanceGet</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>        access_token<span class="token punctuation">,</span><br>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token keyword">return</span> accounts_response<span class="token punctuation">;</span><br>    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token comment">// console.error(error);</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token keyword">async</span> <span class="token function">balances</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>	<span class="token keyword">const</span> accounts <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>config<span class="token punctuation">.</span>accounts<br>    <span class="token keyword">const</span> accountBalances <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>accounts<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>      <span class="token keyword">const</span> acc <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">balance</span><span class="token punctuation">(</span>accounts<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token keyword">return</span> acc<span class="token punctuation">.</span>data<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token operator">...</span>a<span class="token punctuation">,</span> key <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">allSettled</span><span class="token punctuation">(</span>accountBalances<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token comment">// The part I really care about.</span><br>  <span class="token keyword">async</span> <span class="token function">formattedBalances</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>	<span class="token keyword">const</span> accountBalances <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">balances</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token keyword">const</span> payload <span class="token operator">=</span> accountBalances<br>	  <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">o</span><span class="token punctuation">)</span> <span class="token operator">=></span> o<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token string">"fulfilled"</span><span class="token punctuation">)</span><br>	  <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">o</span><span class="token punctuation">)</span> <span class="token operator">=></span> o<span class="token punctuation">.</span>value<span class="token punctuation">)</span><br>	  <span class="token punctuation">.</span><span class="token function">flat</span><span class="token punctuation">(</span><span class="token number">Infinity</span><span class="token punctuation">)</span><br>	  <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>		<span class="token keyword">return</span> <span class="token punctuation">{</span><br>		  title<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>a<span class="token punctuation">.</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> (</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>a<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span><br>		  value<span class="token operator">:</span> a<span class="token punctuation">.</span>balances<span class="token punctuation">.</span>available <span class="token operator">||</span> a<span class="token punctuation">.</span>balances<span class="token punctuation">.</span>current<span class="token punctuation">,</span><br>		<span class="token punctuation">}</span><span class="token punctuation">;</span><br>	  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token keyword">return</span> payload<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><h2>index.mjs so far...</h2><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> config <span class="token keyword">from</span> <span class="token string">'./config.mjs'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> Api <span class="token keyword">from</span> <span class="token string">'./api.mjs'</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> api <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Api</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> api<span class="token punctuation">.</span><span class="token function">formattedBalances</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span><br>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2>Result</h2><pre class="language-bash"><code class="language-bash"><span class="token punctuation">[</span><br>  <span class="token punctuation">{</span><br>    <span class="token string">"title"</span><span class="token builtin class-name">:</span> <span class="token string">"institution_1 (****nnnn)"</span>,<br>    <span class="token string">"value"</span><span class="token builtin class-name">:</span> <span class="token number">1.97</span><br>  <span class="token punctuation">}</span>,<br>  <span class="token punctuation">{</span><br>    <span class="token string">"title"</span><span class="token builtin class-name">:</span> <span class="token string">"institution_1 (**nnnn)"</span>,<br>    <span class="token string">"value"</span><span class="token builtin class-name">:</span> <span class="token number">2.69</span><br>  <span class="token punctuation">}</span>,<br>  <span class="token punctuation">{</span><br>    <span class="token string">"title"</span><span class="token builtin class-name">:</span> <span class="token string">"institution_2 (High Yield CD 12-Month)"</span>,<br>    <span class="token string">"value"</span><span class="token builtin class-name">:</span> <span class="token number">100</span><br>  <span class="token punctuation">}</span>,<br>  <span class="token punctuation">{</span><br>    <span class="token string">"title"</span><span class="token builtin class-name">:</span> <span class="token string">"institution_2 (Spending Account)"</span>,<br>    <span class="token string">"value"</span><span class="token builtin class-name">:</span> <span class="token number">50.46</span><br>  <span class="token punctuation">}</span>,<br>  <span class="token punctuation">{</span><br>    <span class="token string">"title"</span><span class="token builtin class-name">:</span> <span class="token string">"institution_2 (Savings Account)"</span>,<br>    <span class="token string">"value"</span><span class="token builtin class-name">:</span> <span class="token number">1500.58</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">]</span></code></pre><h2>Make things a tad bit prettier.</h2><p>Having the data in JSON is fine and all, but I kinda want something I can scan quickly as currency. A total would be nice too.</p><pre class="language-js"><code class="language-js"><span class="token comment">/// formatPlaid.mjs</span><br><span class="token keyword">const</span> <span class="token function-variable function">formatPlaid</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> formatter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intl<span class="token punctuation">.</span>NumberFormat</span><span class="token punctuation">(</span><span class="token string">'en-US'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><br>	style<span class="token operator">:</span> <span class="token string">'currency'</span><span class="token punctuation">,</span><br>	currency<span class="token operator">:</span> <span class="token string">'USD'</span><span class="token punctuation">,</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">const</span> fields <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">d</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span><br>	<span class="token operator">...</span>d<span class="token punctuation">,</span><br>	<span class="token string">'value'</span><span class="token operator">:</span> formatter<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">,</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  fields<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>	<span class="token string">'title'</span><span class="token operator">:</span> <span class="token string">'Total'</span><span class="token punctuation">,</span><br>	<span class="token string">'value'</span><span class="token operator">:</span> formatter<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=></span> a <span class="token operator">+</span> b<span class="token punctuation">.</span>value<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><br><br>  <span class="token keyword">return</span> fields<span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">export</span> <span class="token keyword">default</span> formatPlaid<span class="token punctuation">;</span></code></pre><h2>index.mjs so far...</h2><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> config <span class="token keyword">from</span> <span class="token string">'./config.mjs'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> Api <span class="token keyword">from</span> <span class="token string">'./api.mjs'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> formatPlaid <span class="token keyword">from</span> <span class="token string">'./formatPlaid.mjs'</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> api <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Api</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> api<span class="token punctuation">.</span><span class="token function">formattedBalances</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span><br>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">formatPlaid</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><h2>Result</h2><pre class="language-bash"><code class="language-bash"><span class="token punctuation">[</span><br>  <span class="token punctuation">{</span> title: <span class="token string">'institution_1 (****nnnn)'</span>, value: <span class="token string">'$1.97'</span> <span class="token punctuation">}</span>,<br>  <span class="token punctuation">{</span> title: <span class="token string">'institution_1 (**nnnn)'</span>, value: <span class="token string">'$2.69'</span> <span class="token punctuation">}</span>,<br>  <span class="token punctuation">{</span> title: <span class="token string">'institution_2 (High Yield CD 12-Month)'</span>, value: <span class="token string">'$100.00'</span> <span class="token punctuation">}</span>,<br>  <span class="token punctuation">{</span> title: <span class="token string">'institution_2 (Spending Account)'</span>, value: <span class="token string">'$50.46'</span> <span class="token punctuation">}</span>,<br>  <span class="token punctuation">{</span> title: <span class="token string">'institution_2 (Savings Account)'</span>, value: <span class="token string">'$1,500.58'</span> <span class="token punctuation">}</span>,<br>  <span class="token punctuation">{</span> title: <span class="token string">'Total'</span>, value: <span class="token string">'$1,655.70'</span> <span class="token punctuation">}</span><br><span class="token punctuation">]</span></code></pre><h2>Slack</h2><p>I wanted to send this to my own slack channel so I followed the code <a href="https://blog.nodeswat.com/simple-node-js-and-slack-webhook-integration-d87c95aa9600">explained here</a>.</p><p>And here we go...</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> https <span class="token keyword">from</span> <span class="token string">'https'</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> hookUrl <span class="token operator">=</span> <span class="token string">'https://hooks.slack.com/services/nnn/nnn/nnn'</span><span class="token punctuation">;</span><br><br><span class="token keyword">function</span> <span class="token function">sendSlackMessage</span><span class="token punctuation">(</span><span class="token parameter">fields</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> total <span class="token operator">=</span> fields<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>  <span class="token keyword">const</span> userAccountNotification <span class="token operator">=</span> <span class="token punctuation">{</span><br>	<span class="token string">'username'</span><span class="token operator">:</span> <span class="token string">'Fin notifier'</span><span class="token punctuation">,</span><br>	<span class="token string">'text'</span><span class="token operator">:</span> <span class="token string">'Here is your fin update'</span><span class="token punctuation">,</span><br>	<span class="token string">'attachments'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><br>	  <span class="token string">'color'</span><span class="token operator">:</span> <span class="token string">'#2eb886'</span><span class="token punctuation">,</span><br>	  <span class="token string">'fields'</span><span class="token operator">:</span> fields<br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span><br>    <span class="token string">'color'</span><span class="token operator">:</span> <span class="token string">'#ffff00'</span><span class="token punctuation">,</span><br>    <span class="token string">'fields'</span><span class="token operator">:</span> <span class="token punctuation">[</span>total<span class="token punctuation">]</span><br>  <span class="token punctuation">}</span><span class="token punctuation">]</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    <span class="token keyword">const</span> requestOptions <span class="token operator">=</span> <span class="token punctuation">{</span><br>  	  method<span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span><br>	  header<span class="token operator">:</span> <span class="token punctuation">{</span><br>  	    <span class="token string">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'application/json'</span><br>	  <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">const</span> req <span class="token operator">=</span> https<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span>hookUrl<span class="token punctuation">,</span> requestOptions<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>      <span class="token keyword">let</span> response <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span><br>      res<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span> response <span class="token operator">+=</span> d<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      res<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span> <span class="token function">resolve</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>      <span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    req<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>userAccountNotification<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    req<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">export</span> <span class="token keyword">default</span> sendSlackMessage<span class="token punctuation">;</span></code></pre><h2>index.mjs so far...</h2><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> config <span class="token keyword">from</span> <span class="token string">'./config.mjs'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> Api <span class="token keyword">from</span> <span class="token string">'./api.mjs'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> formatPlaid <span class="token keyword">from</span> <span class="token string">'./formatPlaid.mjs'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> sendSlackMessage <span class="token keyword">from</span> <span class="token string">'./sendSlack.mjs'</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> api <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Api</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> api<span class="token punctuation">.</span><span class="token function">formattedBalances</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">try</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> slackResponse <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">sendSlackMessage</span><span class="token punctuation">(</span><span class="token function">formatPlaid</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Message response'</span><span class="token punctuation">,</span> slackResponse<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'There was a error with the request'</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><h2>Result</h2><div class="ui large bordered image ma2"><img src="/assets/TPhZzemd-E-800.e37ec6fb.jpeg" width="800" height="521" alt="Plus Branding" loading="lazy" decoding="async"></div><h2>Next up</h2><p>I got this running on a cron schedule in <a href="https://github.com/OliveTin/OliveTin">OliveTin</a>. I explain it a bit <a href="/olivetin-node/">here</a>:</p></main><footer class="flex justify-between"><div>I'm Joe Maddalone</div><div><i>This is not a blog, these pages are changed all the time.</i></div></footer><style></style></body></html>