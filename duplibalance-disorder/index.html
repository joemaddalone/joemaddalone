<!DOCTYPE html><html lang="en"> <head><meta charset="utf-8"><link rel="icon" type="image/x-icon" href="/assets/favicon.ico"><meta name="viewport" content="width=device-width"><meta name="generator" content="Astro v5.12.5"><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="apple-touch-icon" sizes="57x57" href="/assets/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png"><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link href="//unpkg.com/prismjs@1.20.0/themes/prism.css" rel="stylesheet"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.1/src/regular/style.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.1/src/fill/style.css"><title></title><link rel="stylesheet" href="/_astro/_slug_.CVhxLwE3.css"></head> <body> <div class="sticky top-0 z-50 bg-white/80 shadow-md"> <nav class="flex items-center justify-between text-black h-12"> <a class="mt1 ml-1" href="/"> <img src="/assets/favicon-32x32.png" width="32" height="32" alt=""> </a> </nav> </div>  <div class="content-container section-spacing"> <div class="prose
	prose-invert
  prose-h1:font-bold prose-h1:text-xl
	prose-body:text-black prose-body:text-base
	prose-headings:text-black
	prose-p:text-black
	prose-code:text-black
	prose-code:bg-inherit
	prose-code:font-thin
	prose-code:text-xs
	prose-code:italic
	prose-code:before:content-none
	prose-code:after:content-none
	prose-ul:list-disc prose-ul:pl-4
	prose-strong:text-black
	prose-ruby:text-black
	prose-li:text-black">   <hgroup>
	<h1>DupliBalance Disorder</h1>
	<p>Dumb app + automation I did today</p>
</hgroup>
<p>I hate most financial snapshot apps… eventually.</p>
<p>So, I started off using PersonalCapital, then it turned into Empower. After that, I switched to Mint, and now it’s Credit Karma. The funny thing is, all these apps seem to suffer from what I call “DupliBalance Disorder.” You know, the classic scenario where you check your financial data, and suddenly, an account decides to clone itself, messing up all your totals. You try to fix it by kicking out the extra account, but whoops, it ends up deleting both. Add it back, and now you’ve got three.</p>
<p>Honestly, I don’t need the whole everyday budgeting and tracking thing and other apps do a great job of that. I just wanted something that could give me real-time info on my money situation. I’m mostly looking for my bottom line. (cash + investments) - debt.</p>
<p>So…</p>
<h2 id="access">Access</h2>
<p>I signed up for <a href="https://plaid.com/pricing/">Plaid’s free plan</a>.  Then used <a href="https://github.com/kevinschaich/mintable">mintable</a> to easily get the keys I needed.</p>
<p>Now I have a <code>config</code> like this,</p>
<div class="expressive-code"><link rel="stylesheet" href="/_astro/ec.4dupk.css"><script type="module" src="/_astro/ec.p1z7b.js"></script><figure class="frame"><figcaption class="header"></figcaption><pre data-language="js"><code><div class="ec-line"><div class="code"><span style="--0:#646670">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#646670">"</span><span style="--0:#816100">plaid</span><span style="--0:#646670">"</span><span style="--0:#565869">: </span><span style="--0:#646670">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#646670">"</span><span style="--0:#11658F">PLAID-CLIENT-ID</span><span style="--0:#646670">"</span><span style="--0:#646670">:</span><span style="--0:#565869"> </span><span style="--0:#646670">"</span><span style="--0:#816100">xoxoxoxoxoxoxoxoxo</span><span style="--0:#646670">"</span><span style="--0:#646670">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#646670">"</span><span style="--0:#11658F">PLAID-SECRET</span><span style="--0:#646670">"</span><span style="--0:#646670">:</span><span style="--0:#565869"> </span><span style="--0:#646670">"</span><span style="--0:#816100">xoxoxoxoxoxoxoxoxo</span><span style="--0:#646670">"</span><span style="--0:#646670">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#646670">"</span><span style="--0:#11658F">Plaid-Version</span><span style="--0:#646670">"</span><span style="--0:#646670">:</span><span style="--0:#565869"> </span><span style="--0:#646670">"</span><span style="--0:#816100">nnnn-nn-nn</span><span style="--0:#646670">"</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#646670">},</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#646670">"</span><span style="--0:#816100">accounts</span><span style="--0:#646670">"</span><span style="--0:#565869">: </span><span style="--0:#646670">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#646670">"</span><span style="--0:#11658F">institution_1</span><span style="--0:#646670">"</span><span style="--0:#646670">:</span><span style="--0:#565869"> </span><span style="--0:#646670">"</span><span style="--0:#816100">access-development-xoxoxoxoxoxoxoxoxo</span><span style="--0:#646670">"</span><span style="--0:#646670">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#646670">"</span><span style="--0:#11658F">institution_2</span><span style="--0:#646670">"</span><span style="--0:#646670">:</span><span style="--0:#565869"> </span><span style="--0:#646670">"</span><span style="--0:#816100">access-development-xoxoxoxoxoxoxoxoxo</span><span style="--0:#646670">"</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#646670">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#646670">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="{  &#x22;plaid&#x22;: {    &#x22;PLAID-CLIENT-ID&#x22;: &#x22;xoxoxoxoxoxoxoxoxo&#x22;,    &#x22;PLAID-SECRET&#x22;: &#x22;xoxoxoxoxoxoxoxoxo&#x22;,    &#x22;Plaid-Version&#x22;: &#x22;nnnn-nn-nn&#x22;  },  &#x22;accounts&#x22;: {    &#x22;institution_1&#x22;: &#x22;access-development-xoxoxoxoxoxoxoxoxo&#x22;,    &#x22;institution_2&#x22;: &#x22;access-development-xoxoxoxoxoxoxoxoxo&#x22;  }}"><div></div></button></div></figure></div>
<h2 id="plaid">Plaid</h2>
<p>The plaid npm package is great, but I really only need to do a few things, so adding my own wrapper seemed like a good idea.</p>
<div class="expressive-code"><figure class="frame has-title"><figcaption class="header"><span class="title">api.mjs</span></figcaption><pre data-language="js"><code><div class="ec-line"><div class="code"><span style="--0:#A2447B">import</span><span style="--0:#565869"> </span><span style="--0:#646670">{</span><span style="--0:#565869"> Configuration</span><span style="--0:#646670">,</span><span style="--0:#565869"> PlaidApi</span><span style="--0:#646670">,</span><span style="--0:#565869"> PlaidEnvironments </span><span style="--0:#646670">}</span><span style="--0:#565869"> </span><span style="--0:#A2447B">from</span><span style="--0:#565869"> </span><span style="--0:#646670">"</span><span style="--0:#816100">plaid</span><span style="--0:#646670">"</span><span style="--0:#646670">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#A2447B">export</span><span style="--0:#565869"> </span><span style="--0:#A2447B">default</span><span style="--0:#565869"> </span><span style="--0:#A2447B">class</span><span style="--0:#565869"> </span><span style="--0:#0C7270">Api</span><span style="--0:#565869"> </span><span style="--0:#646670">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#A2447B">constructor</span><span style="--0:#646670">(</span><span style="--0:#565869">config</span><span style="--0:#646670">)</span><span style="--0:#565869"> </span><span style="--0:#646670">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#0C7270">this</span><span style="--0:#646670">.</span><span style="--0:#565869">plaidClient </span><span style="--0:#646670">=</span><span style="--0:#565869"> </span><span style="--0:#1E753B">null</span><span style="--0:#646670">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#0C7270">this</span><span style="--0:#646670">.</span><span style="--0:#565869">config </span><span style="--0:#646670">=</span><span style="--0:#565869"> config</span><span style="--0:#646670">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#0C7270">this</span><span style="--0:#646670">.</span><span style="--0:#066C9F">makeClient</span><span style="--0:#646670">();</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#646670">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#066C9F">makeClient</span><span style="--0:#646670">()</span><span style="--0:#565869"> </span><span style="--0:#646670">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#A2447B">if</span><span style="--0:#565869"> </span><span style="--0:#646670">(!</span><span style="--0:#0C7270">this</span><span style="--0:#646670">.</span><span style="--0:#565869">plaidClient</span><span style="--0:#646670">)</span><span style="--0:#565869"> </span><span style="--0:#646670">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#A2447B">const</span><span style="--0:#565869"> configuration </span><span style="--0:#646670">=</span><span style="--0:#565869"> </span><span style="--0:#A2447B">new</span><span style="--0:#565869"> </span><span style="--0:#066C9F">Configuration</span><span style="--0:#646670">({</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#11658F">basePath</span><span style="--0:#646670">:</span><span style="--0:#565869"> PlaidEnvironments</span><span style="--0:#646670">.</span><span style="--0:#565869">development</span><span style="--0:#646670">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#11658F">baseOptions</span><span style="--0:#646670">:</span><span style="--0:#565869"> </span><span style="--0:#646670">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">          </span><span style="--0:#11658F">headers</span><span style="--0:#646670">:</span><span style="--0:#565869"> </span><span style="--0:#646670">{</span><span style="--0:#565869"> </span><span style="--0:#646670">...</span><span style="--0:#0C7270">this</span><span style="--0:#646670">.</span><span style="--0:#565869">config</span><span style="--0:#646670">.</span><span style="--0:#565869">plaid </span><span style="--0:#646670">},</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#646670">},</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#646670">});</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#0C7270">this</span><span style="--0:#646670">.</span><span style="--0:#565869">plaidClient </span><span style="--0:#646670">=</span><span style="--0:#565869"> </span><span style="--0:#A2447B">new</span><span style="--0:#565869"> </span><span style="--0:#066C9F">PlaidApi</span><span style="--0:#646670">(</span><span style="--0:#565869">configuration</span><span style="--0:#646670">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#646670">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#646670">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#A2447B">async</span><span style="--0:#565869"> </span><span style="--0:#066C9F">balance</span><span style="--0:#646670">(</span><span style="--0:#565869">access_token</span><span style="--0:#646670">)</span><span style="--0:#565869"> </span><span style="--0:#646670">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#A2447B">try</span><span style="--0:#565869"> </span><span style="--0:#646670">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#A2447B">const</span><span style="--0:#565869"> accounts_response </span><span style="--0:#646670">=</span><span style="--0:#565869"> </span><span style="--0:#A2447B">await</span><span style="--0:#565869"> </span><span style="--0:#0C7270">this</span><span style="--0:#646670">.</span><span style="--0:#565869">plaidClient</span><span style="--0:#646670">.</span><span style="--0:#066C9F">accountsBalanceGet</span><span style="--0:#646670">({</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#565869">        </span></span><span style="--0:#565869">access_token</span><span style="--0:#646670">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#646670">});</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#A2447B">return</span><span style="--0:#565869"> accounts_response</span><span style="--0:#646670">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#646670">}</span><span style="--0:#565869"> </span><span style="--0:#A2447B">catch</span><span style="--0:#565869"> </span><span style="--0:#646670">(</span><span style="--0:#565869">error</span><span style="--0:#646670">)</span><span style="--0:#565869"> </span><span style="--0:#646670">{</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#646670">      </span></span><span style="--0:#646670">// console.error(error);</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#646670">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#646670">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#A2447B">async</span><span style="--0:#565869"> </span><span style="--0:#066C9F">balances</span><span style="--0:#646670">()</span><span style="--0:#565869"> </span><span style="--0:#646670">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#A2447B">const</span><span style="--0:#565869"> accounts </span><span style="--0:#646670">=</span><span style="--0:#565869"> </span><span style="--0:#0C7270">this</span><span style="--0:#646670">.</span><span style="--0:#565869">config</span><span style="--0:#646670">.</span><span style="--0:#565869">accounts</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#A2447B">const</span><span style="--0:#565869"> accountBalances </span><span style="--0:#646670">=</span><span style="--0:#565869"> Object</span><span style="--0:#646670">.</span><span style="--0:#066C9F">keys</span><span style="--0:#646670">(</span><span style="--0:#565869">accounts</span><span style="--0:#646670">).</span><span style="--0:#066C9F">map</span><span style="--0:#646670">(</span><span style="--0:#A2447B">async</span><span style="--0:#565869"> </span><span style="--0:#646670">(</span><span style="--0:#565869">key</span><span style="--0:#646670">)</span><span style="--0:#565869"> </span><span style="--0:#646670">=></span><span style="--0:#565869"> </span><span style="--0:#646670">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#A2447B">const</span><span style="--0:#565869"> acc </span><span style="--0:#646670">=</span><span style="--0:#565869"> </span><span style="--0:#A2447B">await</span><span style="--0:#565869"> </span><span style="--0:#0C7270">this</span><span style="--0:#646670">.</span><span style="--0:#066C9F">balance</span><span style="--0:#646670">(</span><span style="--0:#565869">accounts</span><span style="--0:#646670">[</span><span style="--0:#565869">key</span><span style="--0:#646670">]);</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#A2447B">return</span><span style="--0:#565869"> acc</span><span style="--0:#646670">.</span><span style="--0:#565869">data</span><span style="--0:#646670">.</span><span style="--0:#565869">accounts</span><span style="--0:#646670">.</span><span style="--0:#066C9F">map</span><span style="--0:#646670">((</span><span style="--0:#565869">a</span><span style="--0:#646670">)</span><span style="--0:#565869"> </span><span style="--0:#646670">=></span><span style="--0:#565869"> </span><span style="--0:#646670">({</span><span style="--0:#565869"> </span><span style="--0:#646670">...</span><span style="--0:#565869">a</span><span style="--0:#646670">,</span><span style="--0:#565869"> key </span><span style="--0:#646670">}));</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#646670">});</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#A2447B">return</span><span style="--0:#565869"> </span><span style="--0:#0C7270">Promise</span><span style="--0:#646670">.</span><span style="--0:#066C9F">allSettled</span><span style="--0:#646670">(</span><span style="--0:#565869">accountBalances</span><span style="--0:#646670">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#646670">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#646670">  </span></span><span style="--0:#646670">// The part I really care about.</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#A2447B">async</span><span style="--0:#565869"> </span><span style="--0:#066C9F">formattedBalances</span><span style="--0:#646670">()</span><span style="--0:#565869"> </span><span style="--0:#646670">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#A2447B">const</span><span style="--0:#565869"> accountBalances </span><span style="--0:#646670">=</span><span style="--0:#565869"> </span><span style="--0:#A2447B">await</span><span style="--0:#565869"> </span><span style="--0:#0C7270">this</span><span style="--0:#646670">.</span><span style="--0:#066C9F">balances</span><span style="--0:#646670">();</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#A2447B">const</span><span style="--0:#565869"> payload </span><span style="--0:#646670">=</span><span style="--0:#565869"> accountBalances</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#646670">.</span><span style="--0:#066C9F">filter</span><span style="--0:#646670">((</span><span style="--0:#565869">o</span><span style="--0:#646670">)</span><span style="--0:#565869"> </span><span style="--0:#646670">=></span><span style="--0:#565869"> o</span><span style="--0:#646670">.</span><span style="--0:#565869">status </span><span style="--0:#646670">===</span><span style="--0:#565869"> </span><span style="--0:#646670">"</span><span style="--0:#816100">fulfilled</span><span style="--0:#646670">"</span><span style="--0:#646670">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#646670">.</span><span style="--0:#066C9F">map</span><span style="--0:#646670">((</span><span style="--0:#565869">o</span><span style="--0:#646670">)</span><span style="--0:#565869"> </span><span style="--0:#646670">=></span><span style="--0:#565869"> o</span><span style="--0:#646670">.</span><span style="--0:#565869">value</span><span style="--0:#646670">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#646670">.</span><span style="--0:#066C9F">flat</span><span style="--0:#646670">(</span><span style="--0:#1E753B">Infinity</span><span style="--0:#646670">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#646670">.</span><span style="--0:#066C9F">map</span><span style="--0:#646670">((</span><span style="--0:#565869">a</span><span style="--0:#646670">)</span><span style="--0:#565869"> </span><span style="--0:#646670">=></span><span style="--0:#565869"> </span><span style="--0:#646670">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#A2447B">return</span><span style="--0:#565869"> </span><span style="--0:#646670">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#11658F">title</span><span style="--0:#646670">:</span><span style="--0:#565869"> </span><span style="--0:#646670">`${</span><span style="--0:#565869">a</span><span style="--0:#646670">.</span><span style="--0:#565869">key</span><span style="--0:#646670">}</span><span style="--0:#816100"> (</span><span style="--0:#646670">${</span><span style="--0:#565869">a</span><span style="--0:#646670">.</span><span style="--0:#565869">name</span><span style="--0:#646670">}</span><span style="--0:#816100">)</span><span style="--0:#646670">`</span><span style="--0:#646670">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#11658F">value</span><span style="--0:#646670">:</span><span style="--0:#565869"> a</span><span style="--0:#646670">.</span><span style="--0:#565869">type </span><span style="--0:#646670">===</span><span style="--0:#565869"> </span><span style="--0:#646670">'</span><span style="--0:#816100">credit</span><span style="--0:#646670">'</span><span style="--0:#565869"> </span><span style="--0:#646670">?</span><span style="--0:#565869"> </span><span style="--0:#646670">~~</span><span style="--0:#565869">a</span><span style="--0:#646670">.</span><span style="--0:#565869">balances</span><span style="--0:#646670">.</span><span style="--0:#565869">current</span><span style="--0:#646670">*-</span><span style="--0:#B1403C">1</span><span style="--0:#565869"> </span><span style="--0:#646670">:</span><span style="--0:#565869"> a</span><span style="--0:#646670">.</span><span style="--0:#565869">balances</span><span style="--0:#646670">.</span><span style="--0:#565869">available </span><span style="--0:#646670">||</span><span style="--0:#565869"> a</span><span style="--0:#646670">.</span><span style="--0:#565869">balances</span><span style="--0:#646670">.</span><span style="--0:#565869">current</span><span style="--0:#646670">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#646670">};</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#646670">});</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#A2447B">return</span><span style="--0:#565869"> payload</span><span style="--0:#646670">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#646670">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#646670">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="import { Configuration, PlaidApi, PlaidEnvironments } from &#x22;plaid&#x22;;export default class Api {  constructor(config) {    this.plaidClient = null;    this.config = config;    this.makeClient();  }  makeClient() {    if (!this.plaidClient) {      const configuration = new Configuration({        basePath: PlaidEnvironments.development,        baseOptions: {          headers: { ...this.config.plaid },        },      });      this.plaidClient = new PlaidApi(configuration);    }  }  async balance(access_token) {    try {      const accounts_response = await this.plaidClient.accountsBalanceGet({        access_token,      });      return accounts_response;    } catch (error) {      // console.error(error);    }  }  async balances() {  const accounts = this.config.accounts    const accountBalances = Object.keys(accounts).map(async (key) => {      const acc = await this.balance(accounts[key]);      return acc.data.accounts.map((a) => ({ ...a, key }));    });    return Promise.allSettled(accountBalances);  }  // The part I really care about.  async formattedBalances() {  const accountBalances = await this.balances();  const payload = accountBalances    .filter((o) => o.status === &#x22;fulfilled&#x22;)    .map((o) => o.value)    .flat(Infinity)    .map((a) => {    return {      title: &#x60;${a.key} (${a.name})&#x60;,      value: a.type === &#x27;credit&#x27; ? ~~a.balances.current*-1 : a.balances.available || a.balances.current,    };    });  return payload;  }}"><div></div></button></div></figure></div>
<h2 id="indexmjs-so-far">index.mjs so far…</h2>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="js"><code><div class="ec-line"><div class="code"><span style="--0:#A2447B">import</span><span style="--0:#565869"> config </span><span style="--0:#A2447B">from</span><span style="--0:#565869"> </span><span style="--0:#646670">'</span><span style="--0:#816100">./config.mjs</span><span style="--0:#646670">'</span><span style="--0:#646670">;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#A2447B">import</span><span style="--0:#565869"> Api </span><span style="--0:#A2447B">from</span><span style="--0:#565869"> </span><span style="--0:#646670">'</span><span style="--0:#816100">./api.mjs</span><span style="--0:#646670">'</span><span style="--0:#646670">;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#A2447B">const</span><span style="--0:#565869"> api </span><span style="--0:#646670">=</span><span style="--0:#565869"> </span><span style="--0:#A2447B">new</span><span style="--0:#565869"> </span><span style="--0:#066C9F">Api</span><span style="--0:#646670">(</span><span style="--0:#565869">config</span><span style="--0:#646670">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#A2447B">const</span><span style="--0:#565869"> data </span><span style="--0:#646670">=</span><span style="--0:#565869"> </span><span style="--0:#A2447B">await</span><span style="--0:#565869"> api</span><span style="--0:#646670">.</span><span style="--0:#066C9F">formattedBalances</span><span style="--0:#646670">(</span><span style="--0:#565869">config</span><span style="--0:#646670">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#565869">console</span><span style="--0:#646670">.</span><span style="--0:#066C9F">log</span><span style="--0:#646670">(</span><span style="--0:#565869">JSON</span><span style="--0:#646670">.</span><span style="--0:#066C9F">stringify</span><span style="--0:#646670">(</span><span style="--0:#565869">data</span><span style="--0:#646670">,</span><span style="--0:#565869"> </span><span style="--0:#1E753B">null</span><span style="--0:#646670">,</span><span style="--0:#565869"> </span><span style="--0:#B1403C">2</span><span style="--0:#646670">));</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="import config from &#x27;./config.mjs&#x27;;import Api from &#x27;./api.mjs&#x27;;const api = new Api(config);const data = await api.formattedBalances(config);console.log(JSON.stringify(data, null, 2));"><div></div></button></div></figure></div>
<h2 id="result">Result</h2>
<div class="expressive-code"><figure class="frame is-terminal"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash"><code><div class="ec-line"><div class="code"><span style="--0:#646670">[</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#565869">  </span></span><span style="--0:#565869">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#646670">"</span><span style="--0:#816100">title</span><span style="--0:#646670">"</span><span style="--0:#565869">: </span><span style="--0:#646670">"</span><span style="--0:#816100">institution_1 (****nnnn)</span><span style="--0:#646670">"</span><span style="--0:#565869">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#646670">"</span><span style="--0:#816100">value</span><span style="--0:#646670">"</span><span style="--0:#565869">: </span><span style="--0:#B1403C">1.97</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#565869">  </span></span><span style="--0:#565869">},</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#565869">  </span></span><span style="--0:#565869">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#646670">"</span><span style="--0:#816100">title</span><span style="--0:#646670">"</span><span style="--0:#565869">: </span><span style="--0:#646670">"</span><span style="--0:#816100">institution_1 (**nnnn)</span><span style="--0:#646670">"</span><span style="--0:#565869">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#646670">"</span><span style="--0:#816100">value</span><span style="--0:#646670">"</span><span style="--0:#565869">: </span><span style="--0:#B1403C">2.69</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#565869">  </span></span><span style="--0:#565869">},</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#565869">  </span></span><span style="--0:#565869">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#646670">"</span><span style="--0:#816100">title</span><span style="--0:#646670">"</span><span style="--0:#565869">: </span><span style="--0:#646670">"</span><span style="--0:#816100">institution_2 (High Yield CD 12-Month)</span><span style="--0:#646670">"</span><span style="--0:#565869">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#646670">"</span><span style="--0:#816100">value</span><span style="--0:#646670">"</span><span style="--0:#565869">: </span><span style="--0:#B1403C">100</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#565869">  </span></span><span style="--0:#565869">},</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#565869">  </span></span><span style="--0:#565869">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#646670">"</span><span style="--0:#816100">title</span><span style="--0:#646670">"</span><span style="--0:#565869">: </span><span style="--0:#646670">"</span><span style="--0:#816100">institution_2 (Spending Account)</span><span style="--0:#646670">"</span><span style="--0:#565869">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#646670">"</span><span style="--0:#816100">value</span><span style="--0:#646670">"</span><span style="--0:#565869">: </span><span style="--0:#B1403C">50.46</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#565869">  </span></span><span style="--0:#565869">},</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#565869">  </span></span><span style="--0:#565869">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#646670">"</span><span style="--0:#816100">title</span><span style="--0:#646670">"</span><span style="--0:#565869">: </span><span style="--0:#646670">"</span><span style="--0:#816100">institution_2 (Savings Account)</span><span style="--0:#646670">"</span><span style="--0:#565869">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#646670">"</span><span style="--0:#816100">value</span><span style="--0:#646670">"</span><span style="--0:#565869">: </span><span style="--0:#B1403C">1500.58</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#565869">  </span></span><span style="--0:#565869">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#646670">]</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="[  {    &#x22;title&#x22;: &#x22;institution_1 (****nnnn)&#x22;,    &#x22;value&#x22;: 1.97  },  {    &#x22;title&#x22;: &#x22;institution_1 (**nnnn)&#x22;,    &#x22;value&#x22;: 2.69  },  {    &#x22;title&#x22;: &#x22;institution_2 (High Yield CD 12-Month)&#x22;,    &#x22;value&#x22;: 100  },  {    &#x22;title&#x22;: &#x22;institution_2 (Spending Account)&#x22;,    &#x22;value&#x22;: 50.46  },  {    &#x22;title&#x22;: &#x22;institution_2 (Savings Account)&#x22;,    &#x22;value&#x22;: 1500.58  }]"><div></div></button></div></figure></div>
<h2 id="make-things-a-tad-bit-prettier">Make things a tad bit prettier.</h2>
<p>Having the data in JSON is fine and all, but I kinda want something I can scan quickly as currency.  A total would be nice too.</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="js"><code><div class="ec-line"><div class="code"><span style="--0:#646670">/// formatPlaid.mjs</span></div></div><div class="ec-line"><div class="code"><span style="--0:#A2447B">const</span><span style="--0:#565869"> </span><span style="--0:#066C9F">formatPlaid</span><span style="--0:#565869"> </span><span style="--0:#646670">=</span><span style="--0:#565869"> </span><span style="--0:#646670">(</span><span style="--0:#565869">data</span><span style="--0:#646670">)</span><span style="--0:#565869"> </span><span style="--0:#646670">=></span><span style="--0:#565869"> </span><span style="--0:#646670">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#A2447B">const</span><span style="--0:#565869"> formatter </span><span style="--0:#646670">=</span><span style="--0:#565869"> </span><span style="--0:#A2447B">new</span><span style="--0:#565869"> Intl</span><span style="--0:#646670">.</span><span style="--0:#066C9F">NumberFormat</span><span style="--0:#646670">(</span><span style="--0:#646670">'</span><span style="--0:#816100">en-US</span><span style="--0:#646670">'</span><span style="--0:#646670">,</span><span style="--0:#565869"> </span><span style="--0:#646670">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#11658F">style</span><span style="--0:#646670">:</span><span style="--0:#565869"> </span><span style="--0:#646670">'</span><span style="--0:#816100">currency</span><span style="--0:#646670">'</span><span style="--0:#646670">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#11658F">currency</span><span style="--0:#646670">:</span><span style="--0:#565869"> </span><span style="--0:#646670">'</span><span style="--0:#816100">USD</span><span style="--0:#646670">'</span><span style="--0:#646670">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#646670">});</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#A2447B">const</span><span style="--0:#565869"> fields </span><span style="--0:#646670">=</span><span style="--0:#565869"> data</span><span style="--0:#646670">.</span><span style="--0:#066C9F">map</span><span style="--0:#646670">(</span><span style="--0:#565869">d </span><span style="--0:#646670">=></span><span style="--0:#565869"> </span><span style="--0:#646670">({</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#646670">...</span><span style="--0:#565869">d</span><span style="--0:#646670">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#646670">'</span><span style="--0:#11658F">value</span><span style="--0:#646670">'</span><span style="--0:#646670">:</span><span style="--0:#565869"> formatter</span><span style="--0:#646670">.</span><span style="--0:#066C9F">format</span><span style="--0:#646670">(</span><span style="--0:#565869">d</span><span style="--0:#646670">.</span><span style="--0:#565869">value</span><span style="--0:#646670">),</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#646670">}));</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#565869">  </span></span><span style="--0:#565869">fields</span><span style="--0:#646670">.</span><span style="--0:#066C9F">push</span><span style="--0:#646670">({</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#646670">'</span><span style="--0:#11658F">title</span><span style="--0:#646670">'</span><span style="--0:#646670">:</span><span style="--0:#565869"> </span><span style="--0:#646670">'</span><span style="--0:#816100">Total</span><span style="--0:#646670">'</span><span style="--0:#646670">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#646670">'</span><span style="--0:#11658F">value</span><span style="--0:#646670">'</span><span style="--0:#646670">:</span><span style="--0:#565869"> formatter</span><span style="--0:#646670">.</span><span style="--0:#066C9F">format</span><span style="--0:#646670">(</span><span style="--0:#565869">data</span><span style="--0:#646670">.</span><span style="--0:#066C9F">reduce</span><span style="--0:#646670">((</span><span style="--0:#565869">a</span><span style="--0:#646670">,</span><span style="--0:#565869"> b</span><span style="--0:#646670">)</span><span style="--0:#565869"> </span><span style="--0:#646670">=></span><span style="--0:#565869"> a </span><span style="--0:#646670">+</span><span style="--0:#565869"> b</span><span style="--0:#646670">.</span><span style="--0:#565869">value</span><span style="--0:#646670">,</span><span style="--0:#565869"> </span><span style="--0:#B1403C">0</span><span style="--0:#646670">)),</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#646670">})</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#A2447B">return</span><span style="--0:#565869"> fields</span><span style="--0:#646670">;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#646670">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#A2447B">export</span><span style="--0:#565869"> </span><span style="--0:#A2447B">default</span><span style="--0:#565869"> formatPlaid</span><span style="--0:#646670">;</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="/// formatPlaid.mjsconst formatPlaid = (data) => {  const formatter = new Intl.NumberFormat(&#x27;en-US&#x27;, {  style: &#x27;currency&#x27;,  currency: &#x27;USD&#x27;,  });  const fields = data.map(d => ({  ...d,  &#x27;value&#x27;: formatter.format(d.value),  }));  fields.push({  &#x27;title&#x27;: &#x27;Total&#x27;,  &#x27;value&#x27;: formatter.format(data.reduce((a, b) => a + b.value, 0)),  })  return fields;}export default formatPlaid;"><div></div></button></div></figure></div>
<h2 id="indexmjs-so-far-1">index.mjs so far…</h2>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="js"><code><div class="ec-line"><div class="code"><span style="--0:#A2447B">import</span><span style="--0:#565869"> config </span><span style="--0:#A2447B">from</span><span style="--0:#565869"> </span><span style="--0:#646670">'</span><span style="--0:#816100">./config.mjs</span><span style="--0:#646670">'</span><span style="--0:#646670">;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#A2447B">import</span><span style="--0:#565869"> Api </span><span style="--0:#A2447B">from</span><span style="--0:#565869"> </span><span style="--0:#646670">'</span><span style="--0:#816100">./api.mjs</span><span style="--0:#646670">'</span><span style="--0:#646670">;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#A2447B">import</span><span style="--0:#565869"> formatPlaid </span><span style="--0:#A2447B">from</span><span style="--0:#565869"> </span><span style="--0:#646670">'</span><span style="--0:#816100">./formatPlaid.mjs</span><span style="--0:#646670">'</span><span style="--0:#646670">;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#A2447B">const</span><span style="--0:#565869"> api </span><span style="--0:#646670">=</span><span style="--0:#565869"> </span><span style="--0:#A2447B">new</span><span style="--0:#565869"> </span><span style="--0:#066C9F">Api</span><span style="--0:#646670">(</span><span style="--0:#565869">config</span><span style="--0:#646670">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#A2447B">const</span><span style="--0:#565869"> data </span><span style="--0:#646670">=</span><span style="--0:#565869"> </span><span style="--0:#A2447B">await</span><span style="--0:#565869"> api</span><span style="--0:#646670">.</span><span style="--0:#066C9F">formattedBalances</span><span style="--0:#646670">(</span><span style="--0:#565869">config</span><span style="--0:#646670">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#565869">console</span><span style="--0:#646670">.</span><span style="--0:#066C9F">log</span><span style="--0:#646670">(</span><span style="--0:#066C9F">formatPlaid</span><span style="--0:#646670">(</span><span style="--0:#565869">data</span><span style="--0:#646670">))</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="import config from &#x27;./config.mjs&#x27;;import Api from &#x27;./api.mjs&#x27;;import formatPlaid from &#x27;./formatPlaid.mjs&#x27;;const api = new Api(config);const data = await api.formattedBalances(config);console.log(formatPlaid(data))"><div></div></button></div></figure></div>
<h2 id="result-1">Result</h2>
<div class="expressive-code"><figure class="frame is-terminal"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash"><code><div class="ec-line"><div class="code"><span style="--0:#646670">[</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#565869">  </span></span><span style="--0:#565869">{ title: </span><span style="--0:#646670">'</span><span style="--0:#816100">institution_1 (****nnnn)</span><span style="--0:#646670">'</span><span style="--0:#565869">, value: </span><span style="--0:#646670">'</span><span style="--0:#816100">$1.97</span><span style="--0:#646670">'</span><span style="--0:#565869"> },</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#565869">  </span></span><span style="--0:#565869">{ title: </span><span style="--0:#646670">'</span><span style="--0:#816100">institution_1 (**nnnn)</span><span style="--0:#646670">'</span><span style="--0:#565869">, value: </span><span style="--0:#646670">'</span><span style="--0:#816100">$2.69</span><span style="--0:#646670">'</span><span style="--0:#565869"> },</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#565869">  </span></span><span style="--0:#565869">{ title: </span><span style="--0:#646670">'</span><span style="--0:#816100">institution_2 (High Yield CD 12-Month)</span><span style="--0:#646670">'</span><span style="--0:#565869">, value: </span><span style="--0:#646670">'</span><span style="--0:#816100">$100.00</span><span style="--0:#646670">'</span><span style="--0:#565869"> },</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#565869">  </span></span><span style="--0:#565869">{ title: </span><span style="--0:#646670">'</span><span style="--0:#816100">institution_2 (Spending Account)</span><span style="--0:#646670">'</span><span style="--0:#565869">, value: </span><span style="--0:#646670">'</span><span style="--0:#816100">$50.46</span><span style="--0:#646670">'</span><span style="--0:#565869"> },</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#565869">  </span></span><span style="--0:#565869">{ title: </span><span style="--0:#646670">'</span><span style="--0:#816100">institution_2 (Savings Account)</span><span style="--0:#646670">'</span><span style="--0:#565869">, value: </span><span style="--0:#646670">'</span><span style="--0:#816100">$1,500.58</span><span style="--0:#646670">'</span><span style="--0:#565869"> },</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#565869">  </span></span><span style="--0:#565869">{ title: </span><span style="--0:#646670">'</span><span style="--0:#816100">Total</span><span style="--0:#646670">'</span><span style="--0:#565869">, value: </span><span style="--0:#646670">'</span><span style="--0:#816100">$1,655.70</span><span style="--0:#646670">'</span><span style="--0:#565869"> }</span></div></div><div class="ec-line"><div class="code"><span style="--0:#646670">]</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="[  { title: &#x27;institution_1 (****nnnn)&#x27;, value: &#x27;$1.97&#x27; },  { title: &#x27;institution_1 (**nnnn)&#x27;, value: &#x27;$2.69&#x27; },  { title: &#x27;institution_2 (High Yield CD 12-Month)&#x27;, value: &#x27;$100.00&#x27; },  { title: &#x27;institution_2 (Spending Account)&#x27;, value: &#x27;$50.46&#x27; },  { title: &#x27;institution_2 (Savings Account)&#x27;, value: &#x27;$1,500.58&#x27; },  { title: &#x27;Total&#x27;, value: &#x27;$1,655.70&#x27; }]"><div></div></button></div></figure></div>
<h2 id="slack">Slack</h2>
<p>I wanted to send this to my own slack channel so I followed the code <a href="https://blog.nodeswat.com/simple-node-js-and-slack-webhook-integration-d87c95aa9600">explained here</a>.</p>
<p>And here we go…</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="js"><code><div class="ec-line"><div class="code"><span style="--0:#A2447B">import</span><span style="--0:#565869"> https </span><span style="--0:#A2447B">from</span><span style="--0:#565869"> </span><span style="--0:#646670">'</span><span style="--0:#816100">https</span><span style="--0:#646670">'</span><span style="--0:#646670">;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#A2447B">const</span><span style="--0:#565869"> hookUrl </span><span style="--0:#646670">=</span><span style="--0:#565869"> </span><span style="--0:#646670">'</span><span style="--0:#816100">https://hooks.slack.com/services/nnn/nnn/nnn</span><span style="--0:#646670">'</span><span style="--0:#646670">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#A2447B">function</span><span style="--0:#565869"> </span><span style="--0:#066C9F">sendSlackMessage</span><span style="--0:#646670">(</span><span style="--0:#565869">fields</span><span style="--0:#646670">)</span><span style="--0:#565869"> </span><span style="--0:#646670">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#A2447B">const</span><span style="--0:#565869"> total </span><span style="--0:#646670">=</span><span style="--0:#565869"> fields</span><span style="--0:#646670">.</span><span style="--0:#066C9F">pop</span><span style="--0:#646670">()</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#A2447B">const</span><span style="--0:#565869"> userAccountNotification </span><span style="--0:#646670">=</span><span style="--0:#565869"> </span><span style="--0:#646670">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#646670">'</span><span style="--0:#11658F">username</span><span style="--0:#646670">'</span><span style="--0:#646670">:</span><span style="--0:#565869"> </span><span style="--0:#646670">'</span><span style="--0:#816100">Fin notifier</span><span style="--0:#646670">'</span><span style="--0:#646670">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#646670">'</span><span style="--0:#11658F">text</span><span style="--0:#646670">'</span><span style="--0:#646670">:</span><span style="--0:#565869"> </span><span style="--0:#646670">'</span><span style="--0:#816100">Here is your fin update</span><span style="--0:#646670">'</span><span style="--0:#646670">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#646670">'</span><span style="--0:#11658F">attachments</span><span style="--0:#646670">'</span><span style="--0:#646670">:</span><span style="--0:#565869"> </span><span style="--0:#646670">[{</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#646670">'</span><span style="--0:#11658F">color</span><span style="--0:#646670">'</span><span style="--0:#646670">:</span><span style="--0:#565869"> </span><span style="--0:#646670">'</span><span style="--0:#816100">#2eb886</span><span style="--0:#646670">'</span><span style="--0:#646670">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#646670">'</span><span style="--0:#11658F">fields</span><span style="--0:#646670">'</span><span style="--0:#646670">:</span><span style="--0:#565869"> fields</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#646670">},</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#646670">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#646670">'</span><span style="--0:#11658F">color</span><span style="--0:#646670">'</span><span style="--0:#646670">:</span><span style="--0:#565869"> </span><span style="--0:#646670">'</span><span style="--0:#816100">#ffff00</span><span style="--0:#646670">'</span><span style="--0:#646670">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#646670">'</span><span style="--0:#11658F">fields</span><span style="--0:#646670">'</span><span style="--0:#646670">:</span><span style="--0:#565869"> </span><span style="--0:#646670">[</span><span style="--0:#565869">total</span><span style="--0:#646670">]</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#646670">}]</span></div></div><div class="ec-line"><div class="code"><span style="--0:#646670">};</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#A2447B">return</span><span style="--0:#565869"> </span><span style="--0:#A2447B">new</span><span style="--0:#565869"> </span><span style="--0:#0C7270">Promise</span><span style="--0:#646670">((</span><span style="--0:#565869">resolve</span><span style="--0:#646670">,</span><span style="--0:#565869"> reject</span><span style="--0:#646670">)</span><span style="--0:#565869"> </span><span style="--0:#646670">=></span><span style="--0:#565869"> </span><span style="--0:#646670">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#A2447B">const</span><span style="--0:#565869"> requestOptions </span><span style="--0:#646670">=</span><span style="--0:#565869"> </span><span style="--0:#646670">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#11658F">method</span><span style="--0:#646670">:</span><span style="--0:#565869"> </span><span style="--0:#646670">'</span><span style="--0:#816100">POST</span><span style="--0:#646670">'</span><span style="--0:#646670">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#11658F">header</span><span style="--0:#646670">:</span><span style="--0:#565869"> </span><span style="--0:#646670">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#646670">'</span><span style="--0:#11658F">Content-Type</span><span style="--0:#646670">'</span><span style="--0:#646670">:</span><span style="--0:#565869"> </span><span style="--0:#646670">'</span><span style="--0:#816100">application/json</span><span style="--0:#646670">'</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#646670">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#646670">};</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#A2447B">const</span><span style="--0:#565869"> req </span><span style="--0:#646670">=</span><span style="--0:#565869"> https</span><span style="--0:#646670">.</span><span style="--0:#066C9F">request</span><span style="--0:#646670">(</span><span style="--0:#565869">hookUrl</span><span style="--0:#646670">,</span><span style="--0:#565869"> requestOptions</span><span style="--0:#646670">,</span><span style="--0:#565869"> </span><span style="--0:#646670">(</span><span style="--0:#565869">res</span><span style="--0:#646670">)</span><span style="--0:#565869"> </span><span style="--0:#646670">=></span><span style="--0:#565869"> </span><span style="--0:#646670">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#A2447B">let</span><span style="--0:#565869"> response </span><span style="--0:#646670">=</span><span style="--0:#565869"> </span><span style="--0:#646670">''</span><span style="--0:#646670">;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#565869">      </span></span><span style="--0:#565869">res</span><span style="--0:#646670">.</span><span style="--0:#066C9F">on</span><span style="--0:#646670">(</span><span style="--0:#646670">'</span><span style="--0:#816100">data</span><span style="--0:#646670">'</span><span style="--0:#646670">,</span><span style="--0:#565869"> </span><span style="--0:#646670">(</span><span style="--0:#565869">d</span><span style="--0:#646670">)</span><span style="--0:#565869"> </span><span style="--0:#646670">=></span><span style="--0:#565869"> </span><span style="--0:#646670">{</span><span style="--0:#565869"> response </span><span style="--0:#646670">+=</span><span style="--0:#565869"> d</span><span style="--0:#646670">;</span><span style="--0:#565869"> </span><span style="--0:#646670">});</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#565869">      </span></span><span style="--0:#565869">res</span><span style="--0:#646670">.</span><span style="--0:#066C9F">on</span><span style="--0:#646670">(</span><span style="--0:#646670">'</span><span style="--0:#816100">end</span><span style="--0:#646670">'</span><span style="--0:#646670">,</span><span style="--0:#565869"> </span><span style="--0:#646670">()</span><span style="--0:#565869"> </span><span style="--0:#646670">=></span><span style="--0:#565869"> </span><span style="--0:#646670">{</span><span style="--0:#565869"> </span><span style="--0:#066C9F">resolve</span><span style="--0:#646670">(</span><span style="--0:#565869">response</span><span style="--0:#646670">);</span><span style="--0:#565869"> </span><span style="--0:#646670">})</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#646670">});</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#565869">    </span></span><span style="--0:#565869">req</span><span style="--0:#646670">.</span><span style="--0:#066C9F">on</span><span style="--0:#646670">(</span><span style="--0:#646670">'</span><span style="--0:#816100">error</span><span style="--0:#646670">'</span><span style="--0:#646670">,</span><span style="--0:#565869"> </span><span style="--0:#646670">(</span><span style="--0:#565869">e</span><span style="--0:#646670">)</span><span style="--0:#565869"> </span><span style="--0:#646670">=></span><span style="--0:#565869"> </span><span style="--0:#646670">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#066C9F">reject</span><span style="--0:#646670">(</span><span style="--0:#565869">e</span><span style="--0:#646670">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#646670">});</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#565869">    </span></span><span style="--0:#565869">req</span><span style="--0:#646670">.</span><span style="--0:#066C9F">write</span><span style="--0:#646670">(</span><span style="--0:#565869">JSON</span><span style="--0:#646670">.</span><span style="--0:#066C9F">stringify</span><span style="--0:#646670">(</span><span style="--0:#565869">userAccountNotification</span><span style="--0:#646670">));</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#565869">    </span></span><span style="--0:#565869">req</span><span style="--0:#646670">.</span><span style="--0:#066C9F">end</span><span style="--0:#646670">();</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#646670">});</span></div></div><div class="ec-line"><div class="code"><span style="--0:#646670">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#A2447B">export</span><span style="--0:#565869"> </span><span style="--0:#A2447B">default</span><span style="--0:#565869"> sendSlackMessage</span><span style="--0:#646670">;</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="import https from &#x27;https&#x27;;const hookUrl = &#x27;https://hooks.slack.com/services/nnn/nnn/nnn&#x27;;function sendSlackMessage(fields) {  const total = fields.pop()  const userAccountNotification = {  &#x27;username&#x27;: &#x27;Fin notifier&#x27;,  &#x27;text&#x27;: &#x27;Here is your fin update&#x27;,  &#x27;attachments&#x27;: [{    &#x27;color&#x27;: &#x27;#2eb886&#x27;,    &#x27;fields&#x27;: fields  },  {    &#x27;color&#x27;: &#x27;#ffff00&#x27;,    &#x27;fields&#x27;: [total]  }]};  return new Promise((resolve, reject) => {    const requestOptions = {      method: &#x27;POST&#x27;,    header: {        &#x27;Content-Type&#x27;: &#x27;application/json&#x27;    }    };    const req = https.request(hookUrl, requestOptions, (res) => {      let response = &#x27;&#x27;;      res.on(&#x27;data&#x27;, (d) => { response += d; });      res.on(&#x27;end&#x27;, () => { resolve(response); })    });    req.on(&#x27;error&#x27;, (e) => {      reject(e);    });    req.write(JSON.stringify(userAccountNotification));    req.end();  });}export default sendSlackMessage;"><div></div></button></div></figure></div>
<h2 id="indexmjs-so-far-2">index.mjs so far…</h2>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="js"><code><div class="ec-line"><div class="code"><span style="--0:#A2447B">import</span><span style="--0:#565869"> config </span><span style="--0:#A2447B">from</span><span style="--0:#565869"> </span><span style="--0:#646670">'</span><span style="--0:#816100">./config.mjs</span><span style="--0:#646670">'</span><span style="--0:#646670">;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#A2447B">import</span><span style="--0:#565869"> Api </span><span style="--0:#A2447B">from</span><span style="--0:#565869"> </span><span style="--0:#646670">'</span><span style="--0:#816100">./api.mjs</span><span style="--0:#646670">'</span><span style="--0:#646670">;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#A2447B">import</span><span style="--0:#565869"> formatPlaid </span><span style="--0:#A2447B">from</span><span style="--0:#565869"> </span><span style="--0:#646670">'</span><span style="--0:#816100">./formatPlaid.mjs</span><span style="--0:#646670">'</span><span style="--0:#646670">;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#A2447B">import</span><span style="--0:#565869"> sendSlackMessage </span><span style="--0:#A2447B">from</span><span style="--0:#565869"> </span><span style="--0:#646670">'</span><span style="--0:#816100">./sendSlack.mjs</span><span style="--0:#646670">'</span><span style="--0:#646670">;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#A2447B">const</span><span style="--0:#565869"> api </span><span style="--0:#646670">=</span><span style="--0:#565869"> </span><span style="--0:#A2447B">new</span><span style="--0:#565869"> </span><span style="--0:#066C9F">Api</span><span style="--0:#646670">(</span><span style="--0:#565869">config</span><span style="--0:#646670">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#A2447B">const</span><span style="--0:#565869"> data </span><span style="--0:#646670">=</span><span style="--0:#565869"> </span><span style="--0:#A2447B">await</span><span style="--0:#565869"> api</span><span style="--0:#646670">.</span><span style="--0:#066C9F">formattedBalances</span><span style="--0:#646670">(</span><span style="--0:#565869">config</span><span style="--0:#646670">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#A2447B">try</span><span style="--0:#565869"> </span><span style="--0:#646670">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#A2447B">const</span><span style="--0:#565869"> slackResponse </span><span style="--0:#646670">=</span><span style="--0:#565869"> </span><span style="--0:#A2447B">await</span><span style="--0:#565869"> </span><span style="--0:#066C9F">sendSlackMessage</span><span style="--0:#646670">(</span><span style="--0:#066C9F">formatPlaid</span><span style="--0:#646670">(</span><span style="--0:#565869">data</span><span style="--0:#646670">));</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#565869">  </span></span><span style="--0:#565869">console</span><span style="--0:#646670">.</span><span style="--0:#066C9F">log</span><span style="--0:#646670">(</span><span style="--0:#646670">'</span><span style="--0:#816100">Message response</span><span style="--0:#646670">'</span><span style="--0:#646670">,</span><span style="--0:#565869"> slackResponse</span><span style="--0:#646670">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#646670">}</span><span style="--0:#565869"> </span><span style="--0:#A2447B">catch</span><span style="--0:#565869"> </span><span style="--0:#646670">(</span><span style="--0:#565869">e</span><span style="--0:#646670">)</span><span style="--0:#565869"> </span><span style="--0:#646670">{</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#565869">  </span></span><span style="--0:#565869">console</span><span style="--0:#646670">.</span><span style="--0:#066C9F">error</span><span style="--0:#646670">(</span><span style="--0:#646670">'</span><span style="--0:#816100">There was a error with the request</span><span style="--0:#646670">'</span><span style="--0:#646670">,</span><span style="--0:#565869"> e</span><span style="--0:#646670">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#646670">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="import config from &#x27;./config.mjs&#x27;;import Api from &#x27;./api.mjs&#x27;;import formatPlaid from &#x27;./formatPlaid.mjs&#x27;;import sendSlackMessage from &#x27;./sendSlack.mjs&#x27;;const api = new Api(config);const data = await api.formattedBalances(config);try {  const slackResponse = await sendSlackMessage(formatPlaid(data));  console.log(&#x27;Message response&#x27;, slackResponse);} catch (e) {  console.error(&#x27;There was a error with the request&#x27;, e);}"><div></div></button></div></figure></div>
<h2 id="result-2">Result</h2>
<div class="ui large bordered image ma2">
<p><img alt="finslack" loading="lazy" decoding="async" fetchpriority="auto" width="909" height="593" src="/_astro/finSlack.DUn8T2_c_1qeWiL.webp" ></p>
</div>
<h2 id="next-up">Next up</h2>
<p>I got this running on a cron schedule in <a href="https://github.com/OliveTin/OliveTin">OliveTin</a>.  I explain it a bit <a href="/olivetin-node/">here</a>:</p>   </div> </div>  <footer class="content-container page-footer"> <div class="border-t-1 border-gray-200 flex justify-between pt-6 pb-6 text-xs"> <div>I'm Joe Maddalone</div> <div><i>This is not a blog, these pages are changed all the time.</i></div> </div> </footer> </body></html>