<!DOCTYPE html><meta charset="utf-8"><hgroup>
	<h1>DupliBalance Disorder</h1>
	<p>Dumb app + automation I did today</p>
</hgroup>
<p>I hate most financial snapshot apps… eventually.</p>
<p>So, I started off using PersonalCapital, then it turned into Empower. After that, I switched to Mint, and now it’s Credit Karma. The funny thing is, all these apps seem to suffer from what I call “DupliBalance Disorder.” You know, the classic scenario where you check your financial data, and suddenly, an account decides to clone itself, messing up all your totals. You try to fix it by kicking out the extra account, but whoops, it ends up deleting both. Add it back, and now you’ve got three.</p>
<p>Honestly, I don’t need the whole everyday budgeting and tracking thing and other apps do a great job of that. I just wanted something that could give me real-time info on my money situation. I’m mostly looking for my bottom line. (cash + investments) - debt.</p>
<p>So…</p>
<h2 id="access">Access</h2>
<p>I signed up for <a href="https://plaid.com/pricing/">Plaid’s free plan</a>.  Then used <a href="https://github.com/kevinschaich/mintable">mintable</a> to easily get the keys I needed.</p>
<p>Now I have a <code>config</code> like this,</p>
<pre class="astro-code snazzy-light" style="background-color:#FAFBFC;color:#565869; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#ADB1C2">{</span></span>
<span class="line"><span style="color:#ADB1C2">	"</span><span style="color:#CF9C00">plaid</span><span style="color:#ADB1C2">"</span><span style="color:#565869">: </span><span style="color:#ADB1C2">{</span></span>
<span class="line"><span style="color:#ADB1C2">		"</span><span style="color:#11658F">PLAID-CLIENT-ID</span><span style="color:#ADB1C2">"</span><span style="color:#ADB1C2">:</span><span style="color:#ADB1C2"> "</span><span style="color:#CF9C00">xoxoxoxoxoxoxoxoxo</span><span style="color:#ADB1C2">"</span><span style="color:#ADB1C2">,</span></span>
<span class="line"><span style="color:#ADB1C2">		"</span><span style="color:#11658F">PLAID-SECRET</span><span style="color:#ADB1C2">"</span><span style="color:#ADB1C2">:</span><span style="color:#ADB1C2"> "</span><span style="color:#CF9C00">xoxoxoxoxoxoxoxoxo</span><span style="color:#ADB1C2">"</span><span style="color:#ADB1C2">,</span></span>
<span class="line"><span style="color:#ADB1C2">		"</span><span style="color:#11658F">Plaid-Version</span><span style="color:#ADB1C2">"</span><span style="color:#ADB1C2">:</span><span style="color:#ADB1C2"> "</span><span style="color:#CF9C00">nnnn-nn-nn</span><span style="color:#ADB1C2">"</span></span>
<span class="line"><span style="color:#ADB1C2">	},</span></span>
<span class="line"><span style="color:#ADB1C2">	"</span><span style="color:#CF9C00">accounts</span><span style="color:#ADB1C2">"</span><span style="color:#565869">: </span><span style="color:#ADB1C2">{</span></span>
<span class="line"><span style="color:#ADB1C2">		"</span><span style="color:#11658F">institution_1</span><span style="color:#ADB1C2">"</span><span style="color:#ADB1C2">:</span><span style="color:#ADB1C2"> "</span><span style="color:#CF9C00">access-development-xoxoxoxoxoxoxoxoxo</span><span style="color:#ADB1C2">"</span><span style="color:#ADB1C2">,</span></span>
<span class="line"><span style="color:#ADB1C2">		"</span><span style="color:#11658F">institution_2</span><span style="color:#ADB1C2">"</span><span style="color:#ADB1C2">:</span><span style="color:#ADB1C2"> "</span><span style="color:#CF9C00">access-development-xoxoxoxoxoxoxoxoxo</span><span style="color:#ADB1C2">"</span></span>
<span class="line"><span style="color:#ADB1C2">	}</span></span>
<span class="line"><span style="color:#ADB1C2">}</span></span></code></pre>
<h2 id="plaid">Plaid</h2>
<p>The plaid npm package is great, but I really only need to do a few things, so adding my own wrapper seemed like a good idea.</p>
<pre class="astro-code snazzy-light" style="background-color:#FAFBFC;color:#565869; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#ADB1C2">// api.mjs</span></span>
<span class="line"><span style="color:#F767BB">import</span><span style="color:#ADB1C2"> {</span><span style="color:#565869"> Configuration</span><span style="color:#ADB1C2">,</span><span style="color:#565869"> PlaidApi</span><span style="color:#ADB1C2">,</span><span style="color:#565869"> PlaidEnvironments </span><span style="color:#ADB1C2">}</span><span style="color:#F767BB"> from</span><span style="color:#ADB1C2"> "</span><span style="color:#CF9C00">plaid</span><span style="color:#ADB1C2">"</span><span style="color:#ADB1C2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F767BB">export</span><span style="color:#F767BB"> default</span><span style="color:#F767BB"> class</span><span style="color:#13BBB7"> Api</span><span style="color:#ADB1C2"> {</span></span>
<span class="line"><span style="color:#F767BB">  constructor</span><span style="color:#ADB1C2">(</span><span style="color:#565869">config</span><span style="color:#ADB1C2">)</span><span style="color:#ADB1C2"> {</span></span>
<span class="line"><span style="color:#13BBB7">    this</span><span style="color:#ADB1C2">.</span><span style="color:#565869">plaidClient </span><span style="color:#ADB1C2">=</span><span style="color:#2DAE58"> null</span><span style="color:#ADB1C2">;</span></span>
<span class="line"><span style="color:#13BBB7">    this</span><span style="color:#ADB1C2">.</span><span style="color:#565869">config </span><span style="color:#ADB1C2">=</span><span style="color:#565869"> config</span><span style="color:#ADB1C2">;</span></span>
<span class="line"><span style="color:#13BBB7">    this</span><span style="color:#ADB1C2">.</span><span style="color:#09A1ED">makeClient</span><span style="color:#ADB1C2">();</span></span>
<span class="line"><span style="color:#ADB1C2">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#09A1ED">  makeClient</span><span style="color:#ADB1C2">()</span><span style="color:#ADB1C2"> {</span></span>
<span class="line"><span style="color:#F767BB">    if</span><span style="color:#ADB1C2"> (!</span><span style="color:#13BBB7">this</span><span style="color:#ADB1C2">.</span><span style="color:#565869">plaidClient</span><span style="color:#ADB1C2">)</span><span style="color:#ADB1C2"> {</span></span>
<span class="line"><span style="color:#F767BB">      const</span><span style="color:#565869"> configuration </span><span style="color:#ADB1C2">=</span><span style="color:#F767BB"> new</span><span style="color:#09A1ED"> Configuration</span><span style="color:#ADB1C2">({</span></span>
<span class="line"><span style="color:#11658F">        basePath</span><span style="color:#ADB1C2">:</span><span style="color:#565869"> PlaidEnvironments</span><span style="color:#ADB1C2">.</span><span style="color:#565869">development</span><span style="color:#ADB1C2">,</span></span>
<span class="line"><span style="color:#11658F">        baseOptions</span><span style="color:#ADB1C2">:</span><span style="color:#ADB1C2"> {</span></span>
<span class="line"><span style="color:#11658F">          headers</span><span style="color:#ADB1C2">:</span><span style="color:#ADB1C2"> {</span><span style="color:#ADB1C2"> ...</span><span style="color:#13BBB7">this</span><span style="color:#ADB1C2">.</span><span style="color:#565869">config</span><span style="color:#ADB1C2">.</span><span style="color:#565869">plaid </span><span style="color:#ADB1C2">},</span></span>
<span class="line"><span style="color:#ADB1C2">        },</span></span>
<span class="line"><span style="color:#ADB1C2">      });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#13BBB7">      this</span><span style="color:#ADB1C2">.</span><span style="color:#565869">plaidClient </span><span style="color:#ADB1C2">=</span><span style="color:#F767BB"> new</span><span style="color:#09A1ED"> PlaidApi</span><span style="color:#ADB1C2">(</span><span style="color:#565869">configuration</span><span style="color:#ADB1C2">);</span></span>
<span class="line"><span style="color:#ADB1C2">    }</span></span>
<span class="line"><span style="color:#ADB1C2">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F767BB">  async</span><span style="color:#09A1ED"> balance</span><span style="color:#ADB1C2">(</span><span style="color:#565869">access_token</span><span style="color:#ADB1C2">)</span><span style="color:#ADB1C2"> {</span></span>
<span class="line"><span style="color:#F767BB">    try</span><span style="color:#ADB1C2"> {</span></span>
<span class="line"><span style="color:#F767BB">      const</span><span style="color:#565869"> accounts_response </span><span style="color:#ADB1C2">=</span><span style="color:#F767BB"> await</span><span style="color:#13BBB7"> this</span><span style="color:#ADB1C2">.</span><span style="color:#565869">plaidClient</span><span style="color:#ADB1C2">.</span><span style="color:#09A1ED">accountsBalanceGet</span><span style="color:#ADB1C2">({</span></span>
<span class="line"><span style="color:#565869">        access_token</span><span style="color:#ADB1C2">,</span></span>
<span class="line"><span style="color:#ADB1C2">      });</span></span>
<span class="line"><span style="color:#F767BB">      return</span><span style="color:#565869"> accounts_response</span><span style="color:#ADB1C2">;</span></span>
<span class="line"><span style="color:#ADB1C2">    }</span><span style="color:#F767BB"> catch</span><span style="color:#ADB1C2"> (</span><span style="color:#565869">error</span><span style="color:#ADB1C2">)</span><span style="color:#ADB1C2"> {</span></span>
<span class="line"><span style="color:#ADB1C2">      // console.error(error);</span></span>
<span class="line"><span style="color:#ADB1C2">    }</span></span>
<span class="line"><span style="color:#ADB1C2">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F767BB">  async</span><span style="color:#09A1ED"> balances</span><span style="color:#ADB1C2">()</span><span style="color:#ADB1C2"> {</span></span>
<span class="line"><span style="color:#F767BB">	const</span><span style="color:#565869"> accounts </span><span style="color:#ADB1C2">=</span><span style="color:#13BBB7"> this</span><span style="color:#ADB1C2">.</span><span style="color:#565869">config</span><span style="color:#ADB1C2">.</span><span style="color:#565869">accounts</span></span>
<span class="line"><span style="color:#F767BB">    const</span><span style="color:#565869"> accountBalances </span><span style="color:#ADB1C2">=</span><span style="color:#565869"> Object</span><span style="color:#ADB1C2">.</span><span style="color:#09A1ED">keys</span><span style="color:#ADB1C2">(</span><span style="color:#565869">accounts</span><span style="color:#ADB1C2">).</span><span style="color:#09A1ED">map</span><span style="color:#ADB1C2">(</span><span style="color:#F767BB">async</span><span style="color:#ADB1C2"> (</span><span style="color:#565869">key</span><span style="color:#ADB1C2">)</span><span style="color:#ADB1C2"> =></span><span style="color:#ADB1C2"> {</span></span>
<span class="line"><span style="color:#F767BB">      const</span><span style="color:#565869"> acc </span><span style="color:#ADB1C2">=</span><span style="color:#F767BB"> await</span><span style="color:#13BBB7"> this</span><span style="color:#ADB1C2">.</span><span style="color:#09A1ED">balance</span><span style="color:#ADB1C2">(</span><span style="color:#565869">accounts</span><span style="color:#ADB1C2">[</span><span style="color:#565869">key</span><span style="color:#ADB1C2">]);</span></span>
<span class="line"><span style="color:#F767BB">      return</span><span style="color:#565869"> acc</span><span style="color:#ADB1C2">.</span><span style="color:#565869">data</span><span style="color:#ADB1C2">.</span><span style="color:#565869">accounts</span><span style="color:#ADB1C2">.</span><span style="color:#09A1ED">map</span><span style="color:#ADB1C2">((</span><span style="color:#565869">a</span><span style="color:#ADB1C2">)</span><span style="color:#ADB1C2"> =></span><span style="color:#ADB1C2"> ({</span><span style="color:#ADB1C2"> ...</span><span style="color:#565869">a</span><span style="color:#ADB1C2">,</span><span style="color:#565869"> key </span><span style="color:#ADB1C2">}));</span></span>
<span class="line"><span style="color:#ADB1C2">    });</span></span>
<span class="line"><span style="color:#F767BB">    return</span><span style="color:#13BBB7"> Promise</span><span style="color:#ADB1C2">.</span><span style="color:#09A1ED">allSettled</span><span style="color:#ADB1C2">(</span><span style="color:#565869">accountBalances</span><span style="color:#ADB1C2">);</span></span>
<span class="line"><span style="color:#ADB1C2">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ADB1C2">  // The part I really care about.</span></span>
<span class="line"><span style="color:#F767BB">  async</span><span style="color:#09A1ED"> formattedBalances</span><span style="color:#ADB1C2">()</span><span style="color:#ADB1C2"> {</span></span>
<span class="line"><span style="color:#F767BB">	const</span><span style="color:#565869"> accountBalances </span><span style="color:#ADB1C2">=</span><span style="color:#F767BB"> await</span><span style="color:#13BBB7"> this</span><span style="color:#ADB1C2">.</span><span style="color:#09A1ED">balances</span><span style="color:#ADB1C2">();</span></span>
<span class="line"><span style="color:#F767BB">	const</span><span style="color:#565869"> payload </span><span style="color:#ADB1C2">=</span><span style="color:#565869"> accountBalances</span></span>
<span class="line"><span style="color:#ADB1C2">	  .</span><span style="color:#09A1ED">filter</span><span style="color:#ADB1C2">((</span><span style="color:#565869">o</span><span style="color:#ADB1C2">)</span><span style="color:#ADB1C2"> =></span><span style="color:#565869"> o</span><span style="color:#ADB1C2">.</span><span style="color:#565869">status </span><span style="color:#ADB1C2">===</span><span style="color:#ADB1C2"> "</span><span style="color:#CF9C00">fulfilled</span><span style="color:#ADB1C2">"</span><span style="color:#ADB1C2">)</span></span>
<span class="line"><span style="color:#ADB1C2">	  .</span><span style="color:#09A1ED">map</span><span style="color:#ADB1C2">((</span><span style="color:#565869">o</span><span style="color:#ADB1C2">)</span><span style="color:#ADB1C2"> =></span><span style="color:#565869"> o</span><span style="color:#ADB1C2">.</span><span style="color:#565869">value</span><span style="color:#ADB1C2">)</span></span>
<span class="line"><span style="color:#ADB1C2">	  .</span><span style="color:#09A1ED">flat</span><span style="color:#ADB1C2">(</span><span style="color:#2DAE58">Infinity</span><span style="color:#ADB1C2">)</span></span>
<span class="line"><span style="color:#ADB1C2">	  .</span><span style="color:#09A1ED">map</span><span style="color:#ADB1C2">((</span><span style="color:#565869">a</span><span style="color:#ADB1C2">)</span><span style="color:#ADB1C2"> =></span><span style="color:#ADB1C2"> {</span></span>
<span class="line"><span style="color:#F767BB">		return</span><span style="color:#ADB1C2"> {</span></span>
<span class="line"><span style="color:#11658F">		  title</span><span style="color:#ADB1C2">:</span><span style="color:#ADB1C2"> `${</span><span style="color:#565869">a</span><span style="color:#ADB1C2">.</span><span style="color:#565869">key</span><span style="color:#ADB1C2">}</span><span style="color:#CF9C00"> (</span><span style="color:#ADB1C2">${</span><span style="color:#565869">a</span><span style="color:#ADB1C2">.</span><span style="color:#565869">name</span><span style="color:#ADB1C2">}</span><span style="color:#CF9C00">)</span><span style="color:#ADB1C2">`</span><span style="color:#ADB1C2">,</span></span>
<span class="line"><span style="color:#11658F">		  value</span><span style="color:#ADB1C2">:</span><span style="color:#565869"> a</span><span style="color:#ADB1C2">.</span><span style="color:#565869">type </span><span style="color:#ADB1C2">===</span><span style="color:#ADB1C2"> '</span><span style="color:#CF9C00">credit</span><span style="color:#ADB1C2">'</span><span style="color:#ADB1C2"> ?</span><span style="color:#ADB1C2"> ~~</span><span style="color:#565869">a</span><span style="color:#ADB1C2">.</span><span style="color:#565869">balances</span><span style="color:#ADB1C2">.</span><span style="color:#565869">current</span><span style="color:#ADB1C2">*-</span><span style="color:#FF5C57">1</span><span style="color:#ADB1C2"> :</span><span style="color:#565869"> a</span><span style="color:#ADB1C2">.</span><span style="color:#565869">balances</span><span style="color:#ADB1C2">.</span><span style="color:#565869">available </span><span style="color:#ADB1C2">||</span><span style="color:#565869"> a</span><span style="color:#ADB1C2">.</span><span style="color:#565869">balances</span><span style="color:#ADB1C2">.</span><span style="color:#565869">current</span><span style="color:#ADB1C2">,</span></span>
<span class="line"><span style="color:#ADB1C2">		};</span></span>
<span class="line"><span style="color:#ADB1C2">	  });</span></span>
<span class="line"><span style="color:#F767BB">	return</span><span style="color:#565869"> payload</span><span style="color:#ADB1C2">;</span></span>
<span class="line"><span style="color:#ADB1C2">  }</span></span>
<span class="line"><span style="color:#ADB1C2">}</span></span></code></pre>
<h2 id="indexmjs-so-far">index.mjs so far…</h2>
<pre class="astro-code snazzy-light" style="background-color:#FAFBFC;color:#565869; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#F767BB">import</span><span style="color:#565869"> config </span><span style="color:#F767BB">from</span><span style="color:#ADB1C2"> '</span><span style="color:#CF9C00">./config.mjs</span><span style="color:#ADB1C2">'</span><span style="color:#ADB1C2">;</span></span>
<span class="line"><span style="color:#F767BB">import</span><span style="color:#565869"> Api </span><span style="color:#F767BB">from</span><span style="color:#ADB1C2"> '</span><span style="color:#CF9C00">./api.mjs</span><span style="color:#ADB1C2">'</span><span style="color:#ADB1C2">;</span></span>
<span class="line"><span style="color:#F767BB">const</span><span style="color:#565869"> api </span><span style="color:#ADB1C2">=</span><span style="color:#F767BB"> new</span><span style="color:#09A1ED"> Api</span><span style="color:#ADB1C2">(</span><span style="color:#565869">config</span><span style="color:#ADB1C2">);</span></span>
<span class="line"><span style="color:#F767BB">const</span><span style="color:#565869"> data </span><span style="color:#ADB1C2">=</span><span style="color:#F767BB"> await</span><span style="color:#565869"> api</span><span style="color:#ADB1C2">.</span><span style="color:#09A1ED">formattedBalances</span><span style="color:#ADB1C2">(</span><span style="color:#565869">config</span><span style="color:#ADB1C2">);</span></span>
<span class="line"><span style="color:#565869">console</span><span style="color:#ADB1C2">.</span><span style="color:#09A1ED">log</span><span style="color:#ADB1C2">(</span><span style="color:#565869">JSON</span><span style="color:#ADB1C2">.</span><span style="color:#09A1ED">stringify</span><span style="color:#ADB1C2">(</span><span style="color:#565869">data</span><span style="color:#ADB1C2">,</span><span style="color:#2DAE58"> null</span><span style="color:#ADB1C2">,</span><span style="color:#FF5C57"> 2</span><span style="color:#ADB1C2">));</span></span></code></pre>
<h2 id="result">Result</h2>
<pre class="astro-code snazzy-light" style="background-color:#FAFBFC;color:#565869; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#ADB1C2">[</span></span>
<span class="line"><span style="color:#565869">  {</span></span>
<span class="line"><span style="color:#ADB1C2">    "</span><span style="color:#CF9C00">title</span><span style="color:#ADB1C2">"</span><span style="color:#565869">: </span><span style="color:#ADB1C2">"</span><span style="color:#CF9C00">institution_1 (****nnnn)</span><span style="color:#ADB1C2">"</span><span style="color:#565869">,</span></span>
<span class="line"><span style="color:#ADB1C2">    "</span><span style="color:#CF9C00">value</span><span style="color:#ADB1C2">"</span><span style="color:#565869">: </span><span style="color:#FF5C57">1.97</span></span>
<span class="line"><span style="color:#565869">  },</span></span>
<span class="line"><span style="color:#565869">  {</span></span>
<span class="line"><span style="color:#ADB1C2">    "</span><span style="color:#CF9C00">title</span><span style="color:#ADB1C2">"</span><span style="color:#565869">: </span><span style="color:#ADB1C2">"</span><span style="color:#CF9C00">institution_1 (**nnnn)</span><span style="color:#ADB1C2">"</span><span style="color:#565869">,</span></span>
<span class="line"><span style="color:#ADB1C2">    "</span><span style="color:#CF9C00">value</span><span style="color:#ADB1C2">"</span><span style="color:#565869">: </span><span style="color:#FF5C57">2.69</span></span>
<span class="line"><span style="color:#565869">  },</span></span>
<span class="line"><span style="color:#565869">  {</span></span>
<span class="line"><span style="color:#ADB1C2">    "</span><span style="color:#CF9C00">title</span><span style="color:#ADB1C2">"</span><span style="color:#565869">: </span><span style="color:#ADB1C2">"</span><span style="color:#CF9C00">institution_2 (High Yield CD 12-Month)</span><span style="color:#ADB1C2">"</span><span style="color:#565869">,</span></span>
<span class="line"><span style="color:#ADB1C2">    "</span><span style="color:#CF9C00">value</span><span style="color:#ADB1C2">"</span><span style="color:#565869">: </span><span style="color:#FF5C57">100</span></span>
<span class="line"><span style="color:#565869">  },</span></span>
<span class="line"><span style="color:#565869">  {</span></span>
<span class="line"><span style="color:#ADB1C2">    "</span><span style="color:#CF9C00">title</span><span style="color:#ADB1C2">"</span><span style="color:#565869">: </span><span style="color:#ADB1C2">"</span><span style="color:#CF9C00">institution_2 (Spending Account)</span><span style="color:#ADB1C2">"</span><span style="color:#565869">,</span></span>
<span class="line"><span style="color:#ADB1C2">    "</span><span style="color:#CF9C00">value</span><span style="color:#ADB1C2">"</span><span style="color:#565869">: </span><span style="color:#FF5C57">50.46</span></span>
<span class="line"><span style="color:#565869">  },</span></span>
<span class="line"><span style="color:#565869">  {</span></span>
<span class="line"><span style="color:#ADB1C2">    "</span><span style="color:#CF9C00">title</span><span style="color:#ADB1C2">"</span><span style="color:#565869">: </span><span style="color:#ADB1C2">"</span><span style="color:#CF9C00">institution_2 (Savings Account)</span><span style="color:#ADB1C2">"</span><span style="color:#565869">,</span></span>
<span class="line"><span style="color:#ADB1C2">    "</span><span style="color:#CF9C00">value</span><span style="color:#ADB1C2">"</span><span style="color:#565869">: </span><span style="color:#FF5C57">1500.58</span></span>
<span class="line"><span style="color:#565869">  }</span></span>
<span class="line"><span style="color:#ADB1C2">]</span></span></code></pre>
<h2 id="make-things-a-tad-bit-prettier">Make things a tad bit prettier.</h2>
<p>Having the data in JSON is fine and all, but I kinda want something I can scan quickly as currency.  A total would be nice too.</p>
<pre class="astro-code snazzy-light" style="background-color:#FAFBFC;color:#565869; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#ADB1C2">/// formatPlaid.mjs</span></span>
<span class="line"><span style="color:#F767BB">const</span><span style="color:#09A1ED"> formatPlaid</span><span style="color:#ADB1C2"> =</span><span style="color:#ADB1C2"> (</span><span style="color:#565869">data</span><span style="color:#ADB1C2">)</span><span style="color:#ADB1C2"> =></span><span style="color:#ADB1C2"> {</span></span>
<span class="line"><span style="color:#F767BB">  const</span><span style="color:#565869"> formatter </span><span style="color:#ADB1C2">=</span><span style="color:#F767BB"> new</span><span style="color:#565869"> Intl</span><span style="color:#ADB1C2">.</span><span style="color:#09A1ED">NumberFormat</span><span style="color:#ADB1C2">(</span><span style="color:#ADB1C2">'</span><span style="color:#CF9C00">en-US</span><span style="color:#ADB1C2">'</span><span style="color:#ADB1C2">,</span><span style="color:#ADB1C2"> {</span></span>
<span class="line"><span style="color:#11658F">	style</span><span style="color:#ADB1C2">:</span><span style="color:#ADB1C2"> '</span><span style="color:#CF9C00">currency</span><span style="color:#ADB1C2">'</span><span style="color:#ADB1C2">,</span></span>
<span class="line"><span style="color:#11658F">	currency</span><span style="color:#ADB1C2">:</span><span style="color:#ADB1C2"> '</span><span style="color:#CF9C00">USD</span><span style="color:#ADB1C2">'</span><span style="color:#ADB1C2">,</span></span>
<span class="line"><span style="color:#ADB1C2">  });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F767BB">  const</span><span style="color:#565869"> fields </span><span style="color:#ADB1C2">=</span><span style="color:#565869"> data</span><span style="color:#ADB1C2">.</span><span style="color:#09A1ED">map</span><span style="color:#ADB1C2">(</span><span style="color:#565869">d </span><span style="color:#ADB1C2">=></span><span style="color:#ADB1C2"> ({</span></span>
<span class="line"><span style="color:#ADB1C2">	...</span><span style="color:#565869">d</span><span style="color:#ADB1C2">,</span></span>
<span class="line"><span style="color:#ADB1C2">	'</span><span style="color:#11658F">value</span><span style="color:#ADB1C2">'</span><span style="color:#ADB1C2">:</span><span style="color:#565869"> formatter</span><span style="color:#ADB1C2">.</span><span style="color:#09A1ED">format</span><span style="color:#ADB1C2">(</span><span style="color:#565869">d</span><span style="color:#ADB1C2">.</span><span style="color:#565869">value</span><span style="color:#ADB1C2">),</span></span>
<span class="line"><span style="color:#ADB1C2">  }));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#565869">  fields</span><span style="color:#ADB1C2">.</span><span style="color:#09A1ED">push</span><span style="color:#ADB1C2">({</span></span>
<span class="line"><span style="color:#ADB1C2">	'</span><span style="color:#11658F">title</span><span style="color:#ADB1C2">'</span><span style="color:#ADB1C2">:</span><span style="color:#ADB1C2"> '</span><span style="color:#CF9C00">Total</span><span style="color:#ADB1C2">'</span><span style="color:#ADB1C2">,</span></span>
<span class="line"><span style="color:#ADB1C2">	'</span><span style="color:#11658F">value</span><span style="color:#ADB1C2">'</span><span style="color:#ADB1C2">:</span><span style="color:#565869"> formatter</span><span style="color:#ADB1C2">.</span><span style="color:#09A1ED">format</span><span style="color:#ADB1C2">(</span><span style="color:#565869">data</span><span style="color:#ADB1C2">.</span><span style="color:#09A1ED">reduce</span><span style="color:#ADB1C2">((</span><span style="color:#565869">a</span><span style="color:#ADB1C2">,</span><span style="color:#565869"> b</span><span style="color:#ADB1C2">)</span><span style="color:#ADB1C2"> =></span><span style="color:#565869"> a </span><span style="color:#ADB1C2">+</span><span style="color:#565869"> b</span><span style="color:#ADB1C2">.</span><span style="color:#565869">value</span><span style="color:#ADB1C2">,</span><span style="color:#FF5C57"> 0</span><span style="color:#ADB1C2">)),</span></span>
<span class="line"><span style="color:#ADB1C2">  })</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F767BB">  return</span><span style="color:#565869"> fields</span><span style="color:#ADB1C2">;</span></span>
<span class="line"><span style="color:#ADB1C2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F767BB">export</span><span style="color:#F767BB"> default</span><span style="color:#565869"> formatPlaid</span><span style="color:#ADB1C2">;</span></span></code></pre>
<h2 id="indexmjs-so-far-1">index.mjs so far…</h2>
<pre class="astro-code snazzy-light" style="background-color:#FAFBFC;color:#565869; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#F767BB">import</span><span style="color:#565869"> config </span><span style="color:#F767BB">from</span><span style="color:#ADB1C2"> '</span><span style="color:#CF9C00">./config.mjs</span><span style="color:#ADB1C2">'</span><span style="color:#ADB1C2">;</span></span>
<span class="line"><span style="color:#F767BB">import</span><span style="color:#565869"> Api </span><span style="color:#F767BB">from</span><span style="color:#ADB1C2"> '</span><span style="color:#CF9C00">./api.mjs</span><span style="color:#ADB1C2">'</span><span style="color:#ADB1C2">;</span></span>
<span class="line"><span style="color:#F767BB">import</span><span style="color:#565869"> formatPlaid </span><span style="color:#F767BB">from</span><span style="color:#ADB1C2"> '</span><span style="color:#CF9C00">./formatPlaid.mjs</span><span style="color:#ADB1C2">'</span><span style="color:#ADB1C2">;</span></span>
<span class="line"><span style="color:#F767BB">const</span><span style="color:#565869"> api </span><span style="color:#ADB1C2">=</span><span style="color:#F767BB"> new</span><span style="color:#09A1ED"> Api</span><span style="color:#ADB1C2">(</span><span style="color:#565869">config</span><span style="color:#ADB1C2">);</span></span>
<span class="line"><span style="color:#F767BB">const</span><span style="color:#565869"> data </span><span style="color:#ADB1C2">=</span><span style="color:#F767BB"> await</span><span style="color:#565869"> api</span><span style="color:#ADB1C2">.</span><span style="color:#09A1ED">formattedBalances</span><span style="color:#ADB1C2">(</span><span style="color:#565869">config</span><span style="color:#ADB1C2">);</span></span>
<span class="line"><span style="color:#565869">console</span><span style="color:#ADB1C2">.</span><span style="color:#09A1ED">log</span><span style="color:#ADB1C2">(</span><span style="color:#09A1ED">formatPlaid</span><span style="color:#ADB1C2">(</span><span style="color:#565869">data</span><span style="color:#ADB1C2">))</span></span></code></pre>
<h2 id="result-1">Result</h2>
<pre class="astro-code snazzy-light" style="background-color:#FAFBFC;color:#565869; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#ADB1C2">[</span></span>
<span class="line"><span style="color:#565869">  { title: </span><span style="color:#ADB1C2">'</span><span style="color:#CF9C00">institution_1 (****nnnn)</span><span style="color:#ADB1C2">'</span><span style="color:#565869">, value: </span><span style="color:#ADB1C2">'</span><span style="color:#CF9C00">$1.97</span><span style="color:#ADB1C2">'</span><span style="color:#565869"> },</span></span>
<span class="line"><span style="color:#565869">  { title: </span><span style="color:#ADB1C2">'</span><span style="color:#CF9C00">institution_1 (**nnnn)</span><span style="color:#ADB1C2">'</span><span style="color:#565869">, value: </span><span style="color:#ADB1C2">'</span><span style="color:#CF9C00">$2.69</span><span style="color:#ADB1C2">'</span><span style="color:#565869"> },</span></span>
<span class="line"><span style="color:#565869">  { title: </span><span style="color:#ADB1C2">'</span><span style="color:#CF9C00">institution_2 (High Yield CD 12-Month)</span><span style="color:#ADB1C2">'</span><span style="color:#565869">, value: </span><span style="color:#ADB1C2">'</span><span style="color:#CF9C00">$100.00</span><span style="color:#ADB1C2">'</span><span style="color:#565869"> },</span></span>
<span class="line"><span style="color:#565869">  { title: </span><span style="color:#ADB1C2">'</span><span style="color:#CF9C00">institution_2 (Spending Account)</span><span style="color:#ADB1C2">'</span><span style="color:#565869">, value: </span><span style="color:#ADB1C2">'</span><span style="color:#CF9C00">$50.46</span><span style="color:#ADB1C2">'</span><span style="color:#565869"> },</span></span>
<span class="line"><span style="color:#565869">  { title: </span><span style="color:#ADB1C2">'</span><span style="color:#CF9C00">institution_2 (Savings Account)</span><span style="color:#ADB1C2">'</span><span style="color:#565869">, value: </span><span style="color:#ADB1C2">'</span><span style="color:#CF9C00">$1,500.58</span><span style="color:#ADB1C2">'</span><span style="color:#565869"> },</span></span>
<span class="line"><span style="color:#565869">  { title: </span><span style="color:#ADB1C2">'</span><span style="color:#CF9C00">Total</span><span style="color:#ADB1C2">'</span><span style="color:#565869">, value: </span><span style="color:#ADB1C2">'</span><span style="color:#CF9C00">$1,655.70</span><span style="color:#ADB1C2">'</span><span style="color:#565869"> }</span></span>
<span class="line"><span style="color:#ADB1C2">]</span></span></code></pre>
<h2 id="slack">Slack</h2>
<p>I wanted to send this to my own slack channel so I followed the code <a href="https://blog.nodeswat.com/simple-node-js-and-slack-webhook-integration-d87c95aa9600">explained here</a>.</p>
<p>And here we go…</p>
<pre class="astro-code snazzy-light" style="background-color:#FAFBFC;color:#565869; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#F767BB">import</span><span style="color:#565869"> https </span><span style="color:#F767BB">from</span><span style="color:#ADB1C2"> '</span><span style="color:#CF9C00">https</span><span style="color:#ADB1C2">'</span><span style="color:#ADB1C2">;</span></span>
<span class="line"><span style="color:#F767BB">const</span><span style="color:#565869"> hookUrl </span><span style="color:#ADB1C2">=</span><span style="color:#ADB1C2"> '</span><span style="color:#CF9C00">https://hooks.slack.com/services/nnn/nnn/nnn</span><span style="color:#ADB1C2">'</span><span style="color:#ADB1C2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F767BB">function</span><span style="color:#09A1ED"> sendSlackMessage</span><span style="color:#ADB1C2">(</span><span style="color:#565869">fields</span><span style="color:#ADB1C2">)</span><span style="color:#ADB1C2"> {</span></span>
<span class="line"><span style="color:#F767BB">  const</span><span style="color:#565869"> total </span><span style="color:#ADB1C2">=</span><span style="color:#565869"> fields</span><span style="color:#ADB1C2">.</span><span style="color:#09A1ED">pop</span><span style="color:#ADB1C2">()</span></span>
<span class="line"><span style="color:#F767BB">  const</span><span style="color:#565869"> userAccountNotification </span><span style="color:#ADB1C2">=</span><span style="color:#ADB1C2"> {</span></span>
<span class="line"><span style="color:#ADB1C2">	'</span><span style="color:#11658F">username</span><span style="color:#ADB1C2">'</span><span style="color:#ADB1C2">:</span><span style="color:#ADB1C2"> '</span><span style="color:#CF9C00">Fin notifier</span><span style="color:#ADB1C2">'</span><span style="color:#ADB1C2">,</span></span>
<span class="line"><span style="color:#ADB1C2">	'</span><span style="color:#11658F">text</span><span style="color:#ADB1C2">'</span><span style="color:#ADB1C2">:</span><span style="color:#ADB1C2"> '</span><span style="color:#CF9C00">Here is your fin update</span><span style="color:#ADB1C2">'</span><span style="color:#ADB1C2">,</span></span>
<span class="line"><span style="color:#ADB1C2">	'</span><span style="color:#11658F">attachments</span><span style="color:#ADB1C2">'</span><span style="color:#ADB1C2">:</span><span style="color:#ADB1C2"> [{</span></span>
<span class="line"><span style="color:#ADB1C2">	  '</span><span style="color:#11658F">color</span><span style="color:#ADB1C2">'</span><span style="color:#ADB1C2">:</span><span style="color:#ADB1C2"> '</span><span style="color:#CF9C00">#2eb886</span><span style="color:#ADB1C2">'</span><span style="color:#ADB1C2">,</span></span>
<span class="line"><span style="color:#ADB1C2">	  '</span><span style="color:#11658F">fields</span><span style="color:#ADB1C2">'</span><span style="color:#ADB1C2">:</span><span style="color:#565869"> fields</span></span>
<span class="line"><span style="color:#ADB1C2">  },</span></span>
<span class="line"><span style="color:#ADB1C2">  {</span></span>
<span class="line"><span style="color:#ADB1C2">    '</span><span style="color:#11658F">color</span><span style="color:#ADB1C2">'</span><span style="color:#ADB1C2">:</span><span style="color:#ADB1C2"> '</span><span style="color:#CF9C00">#ffff00</span><span style="color:#ADB1C2">'</span><span style="color:#ADB1C2">,</span></span>
<span class="line"><span style="color:#ADB1C2">    '</span><span style="color:#11658F">fields</span><span style="color:#ADB1C2">'</span><span style="color:#ADB1C2">:</span><span style="color:#ADB1C2"> [</span><span style="color:#565869">total</span><span style="color:#ADB1C2">]</span></span>
<span class="line"><span style="color:#ADB1C2">  }]</span></span>
<span class="line"><span style="color:#ADB1C2">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F767BB">  return</span><span style="color:#F767BB"> new</span><span style="color:#13BBB7"> Promise</span><span style="color:#ADB1C2">((</span><span style="color:#565869">resolve</span><span style="color:#ADB1C2">,</span><span style="color:#565869"> reject</span><span style="color:#ADB1C2">)</span><span style="color:#ADB1C2"> =></span><span style="color:#ADB1C2"> {</span></span>
<span class="line"><span style="color:#F767BB">    const</span><span style="color:#565869"> requestOptions </span><span style="color:#ADB1C2">=</span><span style="color:#ADB1C2"> {</span></span>
<span class="line"><span style="color:#11658F">  	  method</span><span style="color:#ADB1C2">:</span><span style="color:#ADB1C2"> '</span><span style="color:#CF9C00">POST</span><span style="color:#ADB1C2">'</span><span style="color:#ADB1C2">,</span></span>
<span class="line"><span style="color:#11658F">	  header</span><span style="color:#ADB1C2">:</span><span style="color:#ADB1C2"> {</span></span>
<span class="line"><span style="color:#ADB1C2">  	    '</span><span style="color:#11658F">Content-Type</span><span style="color:#ADB1C2">'</span><span style="color:#ADB1C2">:</span><span style="color:#ADB1C2"> '</span><span style="color:#CF9C00">application/json</span><span style="color:#ADB1C2">'</span></span>
<span class="line"><span style="color:#ADB1C2">	  }</span></span>
<span class="line"><span style="color:#ADB1C2">    };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F767BB">    const</span><span style="color:#565869"> req </span><span style="color:#ADB1C2">=</span><span style="color:#565869"> https</span><span style="color:#ADB1C2">.</span><span style="color:#09A1ED">request</span><span style="color:#ADB1C2">(</span><span style="color:#565869">hookUrl</span><span style="color:#ADB1C2">,</span><span style="color:#565869"> requestOptions</span><span style="color:#ADB1C2">,</span><span style="color:#ADB1C2"> (</span><span style="color:#565869">res</span><span style="color:#ADB1C2">)</span><span style="color:#ADB1C2"> =></span><span style="color:#ADB1C2"> {</span></span>
<span class="line"><span style="color:#F767BB">      let</span><span style="color:#565869"> response </span><span style="color:#ADB1C2">=</span><span style="color:#ADB1C2"> ''</span><span style="color:#ADB1C2">;</span></span>
<span class="line"><span style="color:#565869">      res</span><span style="color:#ADB1C2">.</span><span style="color:#09A1ED">on</span><span style="color:#ADB1C2">(</span><span style="color:#ADB1C2">'</span><span style="color:#CF9C00">data</span><span style="color:#ADB1C2">'</span><span style="color:#ADB1C2">,</span><span style="color:#ADB1C2"> (</span><span style="color:#565869">d</span><span style="color:#ADB1C2">)</span><span style="color:#ADB1C2"> =></span><span style="color:#ADB1C2"> {</span><span style="color:#565869"> response </span><span style="color:#ADB1C2">+=</span><span style="color:#565869"> d</span><span style="color:#ADB1C2">;</span><span style="color:#ADB1C2"> });</span></span>
<span class="line"><span style="color:#565869">      res</span><span style="color:#ADB1C2">.</span><span style="color:#09A1ED">on</span><span style="color:#ADB1C2">(</span><span style="color:#ADB1C2">'</span><span style="color:#CF9C00">end</span><span style="color:#ADB1C2">'</span><span style="color:#ADB1C2">,</span><span style="color:#ADB1C2"> ()</span><span style="color:#ADB1C2"> =></span><span style="color:#ADB1C2"> {</span><span style="color:#09A1ED"> resolve</span><span style="color:#ADB1C2">(</span><span style="color:#565869">response</span><span style="color:#ADB1C2">);</span><span style="color:#ADB1C2"> })</span></span>
<span class="line"><span style="color:#ADB1C2">    });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#565869">    req</span><span style="color:#ADB1C2">.</span><span style="color:#09A1ED">on</span><span style="color:#ADB1C2">(</span><span style="color:#ADB1C2">'</span><span style="color:#CF9C00">error</span><span style="color:#ADB1C2">'</span><span style="color:#ADB1C2">,</span><span style="color:#ADB1C2"> (</span><span style="color:#565869">e</span><span style="color:#ADB1C2">)</span><span style="color:#ADB1C2"> =></span><span style="color:#ADB1C2"> {</span></span>
<span class="line"><span style="color:#09A1ED">      reject</span><span style="color:#ADB1C2">(</span><span style="color:#565869">e</span><span style="color:#ADB1C2">);</span></span>
<span class="line"><span style="color:#ADB1C2">    });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#565869">    req</span><span style="color:#ADB1C2">.</span><span style="color:#09A1ED">write</span><span style="color:#ADB1C2">(</span><span style="color:#565869">JSON</span><span style="color:#ADB1C2">.</span><span style="color:#09A1ED">stringify</span><span style="color:#ADB1C2">(</span><span style="color:#565869">userAccountNotification</span><span style="color:#ADB1C2">));</span></span>
<span class="line"><span style="color:#565869">    req</span><span style="color:#ADB1C2">.</span><span style="color:#09A1ED">end</span><span style="color:#ADB1C2">();</span></span>
<span class="line"><span style="color:#ADB1C2">  });</span></span>
<span class="line"><span style="color:#ADB1C2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F767BB">export</span><span style="color:#F767BB"> default</span><span style="color:#565869"> sendSlackMessage</span><span style="color:#ADB1C2">;</span></span></code></pre>
<h2 id="indexmjs-so-far-2">index.mjs so far…</h2>
<pre class="astro-code snazzy-light" style="background-color:#FAFBFC;color:#565869; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#F767BB">import</span><span style="color:#565869"> config </span><span style="color:#F767BB">from</span><span style="color:#ADB1C2"> '</span><span style="color:#CF9C00">./config.mjs</span><span style="color:#ADB1C2">'</span><span style="color:#ADB1C2">;</span></span>
<span class="line"><span style="color:#F767BB">import</span><span style="color:#565869"> Api </span><span style="color:#F767BB">from</span><span style="color:#ADB1C2"> '</span><span style="color:#CF9C00">./api.mjs</span><span style="color:#ADB1C2">'</span><span style="color:#ADB1C2">;</span></span>
<span class="line"><span style="color:#F767BB">import</span><span style="color:#565869"> formatPlaid </span><span style="color:#F767BB">from</span><span style="color:#ADB1C2"> '</span><span style="color:#CF9C00">./formatPlaid.mjs</span><span style="color:#ADB1C2">'</span><span style="color:#ADB1C2">;</span></span>
<span class="line"><span style="color:#F767BB">import</span><span style="color:#565869"> sendSlackMessage </span><span style="color:#F767BB">from</span><span style="color:#ADB1C2"> '</span><span style="color:#CF9C00">./sendSlack.mjs</span><span style="color:#ADB1C2">'</span><span style="color:#ADB1C2">;</span></span>
<span class="line"><span style="color:#F767BB">const</span><span style="color:#565869"> api </span><span style="color:#ADB1C2">=</span><span style="color:#F767BB"> new</span><span style="color:#09A1ED"> Api</span><span style="color:#ADB1C2">(</span><span style="color:#565869">config</span><span style="color:#ADB1C2">);</span></span>
<span class="line"><span style="color:#F767BB">const</span><span style="color:#565869"> data </span><span style="color:#ADB1C2">=</span><span style="color:#F767BB"> await</span><span style="color:#565869"> api</span><span style="color:#ADB1C2">.</span><span style="color:#09A1ED">formattedBalances</span><span style="color:#ADB1C2">(</span><span style="color:#565869">config</span><span style="color:#ADB1C2">);</span></span>
<span class="line"><span style="color:#F767BB">try</span><span style="color:#ADB1C2"> {</span></span>
<span class="line"><span style="color:#F767BB">  const</span><span style="color:#565869"> slackResponse </span><span style="color:#ADB1C2">=</span><span style="color:#F767BB"> await</span><span style="color:#09A1ED"> sendSlackMessage</span><span style="color:#ADB1C2">(</span><span style="color:#09A1ED">formatPlaid</span><span style="color:#ADB1C2">(</span><span style="color:#565869">data</span><span style="color:#ADB1C2">));</span></span>
<span class="line"><span style="color:#565869">  console</span><span style="color:#ADB1C2">.</span><span style="color:#09A1ED">log</span><span style="color:#ADB1C2">(</span><span style="color:#ADB1C2">'</span><span style="color:#CF9C00">Message response</span><span style="color:#ADB1C2">'</span><span style="color:#ADB1C2">,</span><span style="color:#565869"> slackResponse</span><span style="color:#ADB1C2">);</span></span>
<span class="line"><span style="color:#ADB1C2">}</span><span style="color:#F767BB"> catch</span><span style="color:#ADB1C2"> (</span><span style="color:#565869">e</span><span style="color:#ADB1C2">)</span><span style="color:#ADB1C2"> {</span></span>
<span class="line"><span style="color:#565869">  console</span><span style="color:#ADB1C2">.</span><span style="color:#09A1ED">error</span><span style="color:#ADB1C2">(</span><span style="color:#ADB1C2">'</span><span style="color:#CF9C00">There was a error with the request</span><span style="color:#ADB1C2">'</span><span style="color:#ADB1C2">,</span><span style="color:#565869"> e</span><span style="color:#ADB1C2">);</span></span>
<span class="line"><span style="color:#ADB1C2">}</span></span></code></pre>
<h2 id="result-2">Result</h2>
<div class="ui large bordered image ma2">
<p><img  src="/_astro/finSlack.DUn8T2_c_1qeWiL.webp" alt="finslack" loading="lazy" decoding="async" fetchpriority="auto" width="909" height="593"></p>
</div>
<h2 id="next-up">Next up</h2>
<p>I got this running on a cron schedule in <a href="https://github.com/OliveTin/OliveTin">OliveTin</a>.  I explain it a bit <a href="/olivetin-node/">here</a>:</p>